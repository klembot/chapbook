window.storyFormat({"source":"<!doctype html><html><head><title>{{STORY_NAME}}</title><meta charset=\"utf-8\"/><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/><script type=\"module\" crossorigin>\nvar Jn=Object.defineProperty;var Xn=(n,e,t)=>e in n?Jn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var U=(n,e,t)=>(Xn(n,typeof e!=\"symbol\"?e+\"\":e,t),t),Et=(n,e,t)=>{if(!e.has(n))throw TypeError(\"Cannot \"+t)};var pe=(n,e,t)=>(Et(n,e,\"read from private field\"),t?t.call(n):e.get(n)),Ct=(n,e,t)=>{if(e.has(n))throw TypeError(\"Cannot add the same private member more than once\");e instanceof WeakSet?e.add(n):e.set(n,t)},_t=(n,e,t,i)=>(Et(n,e,\"write to private field\"),i?i.call(n,t):e.set(n,t),t);(function(){const e=document.createElement(\"link\").relList;if(e&&e.supports&&e.supports(\"modulepreload\"))return;for(const r of document.querySelectorAll('link[rel=\"modulepreload\"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type===\"childList\")for(const a of s.addedNodes)a.tagName===\"LINK\"&&a.rel===\"modulepreload\"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin===\"use-credentials\"?s.credentials=\"include\":r.crossOrigin===\"anonymous\"?s.credentials=\"omit\":s.credentials=\"same-origin\",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();const Qn={\"config.logger.show.parse\":!1,\"config.logger.show.render\":!1,\"config.logger.show.sound\":!1,\"config.logger.show.state\":!1,\"config.logger.show.story\":!1,\"config.logger.show.style\":!1};function Xt(n){return n+\": \"}const Ne={inserts:!0};function Kn(n){Ne[n]=!1}function Yn(n){Ne[n]=!0}function Qt(n,e){Ne[n]&&(console.log(Xt(n)+e),window.dispatchEvent(new CustomEvent(\"log-info\",{detail:{message:e,source:n}})))}function Kt(n,e){Ne[n]&&(console.warn(Xt(n)+e),window.dispatchEvent(new CustomEvent(\"log-warning\",{detail:{message:e,source:n}})))}function F(n){return{log(e){Qt(n,e)},warn(e){Kt(n,e)}}}function ei(){window.addEventListener(\"state-change\",n=>{const e=/^config\\.logger\\.show\\.(.+)$/.exec(n.detail.name);e&&e[1]&&(n.detail.value?Yn(e[1]):Kn(e[1]))})}var ti=typeof global==\"object\"&&global&&global.Object===Object&&global;const ni=ti;var ii=typeof self==\"object\"&&self&&self.Object===Object&&self,ri=ni||ii||Function(\"return this\")();const rt=ri;var si=rt.Symbol;const le=si;var Yt=Object.prototype,oi=Yt.hasOwnProperty,ai=Yt.toString,ge=le?le.toStringTag:void 0;function li(n){var e=oi.call(n,ge),t=n[ge];try{n[ge]=void 0;var i=!0}catch{}var r=ai.call(n);return i&&(e?n[ge]=t:delete n[ge]),r}var ci=Object.prototype,ui=ci.toString;function di(n){return ui.call(n)}var fi=\"[object Null]\",hi=\"[object Undefined]\",Tt=le?le.toStringTag:void 0;function en(n){return n==null?n===void 0?hi:fi:Tt&&Tt in Object(n)?li(n):di(n)}function pi(n){return n!=null&&typeof n==\"object\"}var gi=\"[object Symbol]\";function st(n){return typeof n==\"symbol\"||pi(n)&&en(n)==gi}function mi(n,e){for(var t=-1,i=n==null?0:n.length,r=Array(i);++t<i;)r[t]=e(n[t],t,n);return r}var bi=Array.isArray;const ot=bi;var yi=1/0,At=le?le.prototype:void 0,Lt=At?At.toString:void 0;function tn(n){if(typeof n==\"string\")return n;if(ot(n))return mi(n,tn)+\"\";if(st(n))return Lt?Lt.call(n):\"\";var e=n+\"\";return e==\"0\"&&1/n==-yi?\"-0\":e}function Pe(n){var e=typeof n;return n!=null&&(e==\"object\"||e==\"function\")}var wi=\"[object AsyncFunction]\",ki=\"[object Function]\",xi=\"[object GeneratorFunction]\",vi=\"[object Proxy]\";function $i(n){if(!Pe(n))return!1;var e=en(n);return e==ki||e==xi||e==wi||e==vi}var Si=rt[\"__core-js_shared__\"];const Fe=Si;var zt=function(){var n=/[^.]+$/.exec(Fe&&Fe.keys&&Fe.keys.IE_PROTO||\"\");return n?\"Symbol(src)_1.\"+n:\"\"}();function Ei(n){return!!zt&&zt in n}var Ci=Function.prototype,_i=Ci.toString;function Ti(n){if(n!=null){try{return _i.call(n)}catch{}try{return n+\"\"}catch{}}return\"\"}var Ai=/[\\\\^$.*+?()[\\]{}|]/g,Li=/^\\[object .+?Constructor\\]$/,zi=Function.prototype,Pi=Object.prototype,Oi=zi.toString,Ii=Pi.hasOwnProperty,Mi=RegExp(\"^\"+Oi.call(Ii).replace(Ai,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\");function Ni(n){if(!Pe(n)||Ei(n))return!1;var e=$i(n)?Mi:Li;return e.test(Ti(n))}function Ri(n,e){return n==null?void 0:n[e]}function at(n,e){var t=Ri(n,e);return Ni(t)?t:void 0}var Di=function(){try{var n=at(Object,\"defineProperty\");return n({},\"\",{}),n}catch{}}();const Pt=Di;var ji=9007199254740991,Hi=/^(?:0|[1-9]\\d*)$/;function qi(n,e){var t=typeof n;return e=e??ji,!!e&&(t==\"number\"||t!=\"symbol\"&&Hi.test(n))&&n>-1&&n%1==0&&n<e}function Fi(n,e,t){e==\"__proto__\"&&Pt?Pt(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}function nn(n,e){return n===e||n!==n&&e!==e}var Bi=Object.prototype,Ui=Bi.hasOwnProperty;function Vi(n,e,t){var i=n[e];(!(Ui.call(n,e)&&nn(i,t))||t===void 0&&!(e in n))&&Fi(n,e,t)}var Wi=/\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,Zi=/^\\w*$/;function Gi(n,e){if(ot(n))return!1;var t=typeof n;return t==\"number\"||t==\"symbol\"||t==\"boolean\"||n==null||st(n)?!0:Zi.test(n)||!Wi.test(n)||e!=null&&n in Object(e)}var Ji=at(Object,\"create\");const we=Ji;function Xi(){this.__data__=we?we(null):{},this.size=0}function Qi(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var Ki=\"__lodash_hash_undefined__\",Yi=Object.prototype,er=Yi.hasOwnProperty;function tr(n){var e=this.__data__;if(we){var t=e[n];return t===Ki?void 0:t}return er.call(e,n)?e[n]:void 0}var nr=Object.prototype,ir=nr.hasOwnProperty;function rr(n){var e=this.__data__;return we?e[n]!==void 0:ir.call(e,n)}var sr=\"__lodash_hash_undefined__\";function or(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=we&&e===void 0?sr:e,this}function ee(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}ee.prototype.clear=Xi;ee.prototype.delete=Qi;ee.prototype.get=tr;ee.prototype.has=rr;ee.prototype.set=or;function ar(){this.__data__=[],this.size=0}function Re(n,e){for(var t=n.length;t--;)if(nn(n[t][0],e))return t;return-1}var lr=Array.prototype,cr=lr.splice;function ur(n){var e=this.__data__,t=Re(e,n);if(t<0)return!1;var i=e.length-1;return t==i?e.pop():cr.call(e,t,1),--this.size,!0}function dr(n){var e=this.__data__,t=Re(e,n);return t<0?void 0:e[t][1]}function fr(n){return Re(this.__data__,n)>-1}function hr(n,e){var t=this.__data__,i=Re(t,n);return i<0?(++this.size,t.push([n,e])):t[i][1]=e,this}function de(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}de.prototype.clear=ar;de.prototype.delete=ur;de.prototype.get=dr;de.prototype.has=fr;de.prototype.set=hr;var pr=at(rt,\"Map\");const gr=pr;function mr(){this.size=0,this.__data__={hash:new ee,map:new(gr||de),string:new ee}}function br(n){var e=typeof n;return e==\"string\"||e==\"number\"||e==\"symbol\"||e==\"boolean\"?n!==\"__proto__\":n===null}function De(n,e){var t=n.__data__;return br(e)?t[typeof e==\"string\"?\"string\":\"hash\"]:t.map}function yr(n){var e=De(this,n).delete(n);return this.size-=e?1:0,e}function wr(n){return De(this,n).get(n)}function kr(n){return De(this,n).has(n)}function xr(n,e){var t=De(this,n),i=t.size;return t.set(n,e),this.size+=t.size==i?0:1,this}function ie(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}ie.prototype.clear=mr;ie.prototype.delete=yr;ie.prototype.get=wr;ie.prototype.has=kr;ie.prototype.set=xr;var vr=\"Expected a function\";function lt(n,e){if(typeof n!=\"function\"||e!=null&&typeof e!=\"function\")throw new TypeError(vr);var t=function(){var i=arguments,r=e?e.apply(this,i):i[0],s=t.cache;if(s.has(r))return s.get(r);var a=n.apply(this,i);return t.cache=s.set(r,a)||s,a};return t.cache=new(lt.Cache||ie),t}lt.Cache=ie;var $r=500;function Sr(n){var e=lt(n,function(i){return t.size===$r&&t.clear(),i}),t=e.cache;return e}var Er=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g,Cr=/\\\\(\\\\)?/g,_r=Sr(function(n){var e=[];return n.charCodeAt(0)===46&&e.push(\"\"),n.replace(Er,function(t,i,r,s){e.push(r?s.replace(Cr,\"$1\"):i||t)}),e});const Tr=_r;function ct(n){return n==null?\"\":tn(n)}function ut(n,e){return ot(n)?n:Gi(n,e)?[n]:Tr(ct(n))}var Ar=1/0;function dt(n){if(typeof n==\"string\"||st(n))return n;var e=n+\"\";return e==\"0\"&&1/n==-Ar?\"-0\":e}function rn(n,e){e=ut(e,n);for(var t=0,i=e.length;n!=null&&t<i;)n=n[dt(e[t++])];return t&&t==i?n:void 0}function Be(n,e,t){var i=n==null?void 0:rn(n,e);return i===void 0?t:i}function Lr(n,e,t){var i=-1,r=n.length;e<0&&(e=-e>r?0:r+e),t=t>r?r:t,t<0&&(t+=r),r=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(r);++i<r;)s[i]=n[i+e];return s}function sn(n){return function(e){return n==null?void 0:n[e]}}function zr(n){var e=n==null?0:n.length;return e?n[e-1]:void 0}var Pr={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\"},Or=sn(Pr);const Ir=Or;var on=/[&<>\"']/g,Mr=RegExp(on.source);function q(n){return n=ct(n),n&&Mr.test(n)?n.replace(on,Ir):n}function Nr(n,e){return e.length<2?n:rn(n,Lr(e,0,-1))}function Rr(n,e){return e=ut(e,n),n=Nr(n,e),n==null||delete n[dt(zr(e))]}function Dr(n,e,t,i){if(!Pe(n))return n;e=ut(e,n);for(var r=-1,s=e.length,a=s-1,l=n;l!=null&&++r<s;){var o=dt(e[r]),u=t;if(o===\"__proto__\"||o===\"constructor\"||o===\"prototype\")return n;if(r!=a){var c=l[o];u=i?i(c,o,l):void 0,u===void 0&&(u=Pe(c)?c:qi(e[r+1])?[]:{})}Vi(l,o,u),l=l[o]}return n}function ft(n,e,t){return n==null?n:Dr(n,e,t)}var jr={\"&amp;\":\"&\",\"&lt;\":\"<\",\"&gt;\":\">\",\"&quot;\":'\"',\"&#39;\":\"'\"},Hr=sn(jr);const qr=Hr;var an=/&(?:amp|lt|gt|quot|#39);/g,Fr=RegExp(an.source);function Br(n){return n=ct(n),n&&Fr.test(n)?n.replace(an,qr):n}function Ur(n,e){return n==null?!0:Rr(n,e)}const ln=F(\"story\"),P={customScripts:[],customStyles:[],passages:[]};function cn(n){for(const i of[\"name\",\"creator\",\"ifid\",\"options\"])P[i]=n.getAttribute(i)??void 0;const e=parseInt(n.getAttribute(\"startnode\")??\"\");isNaN(e)||(P.startNode=e),P.creatorVersion=n.getAttribute(\"creator-version\")??void 0;const t=i=>[...i].map(r=>r.textContent??\"\");P.customScripts=t(n.querySelectorAll('[type=\"text/twine-javascript\"]')),P.customStyles=t(n.querySelectorAll('[type=\"text/twine-css\"]')),P.passages=[...n.querySelectorAll(\"tw-passagedata\")].map(i=>{const r=parseInt(i.getAttribute(\"pid\")??\"\"),s=i.getAttribute(\"tags\");return{id:isNaN(r)?void 0:r,name:i.getAttribute(\"name\")??void 0,source:i.textContent??\"\",tags:s?s.split(\" \"):[]}})}function un(){const n=pt();if(!n||!n.name)throw new Error(\"There is no starting passage for this story, or it has no name.\");re({trail:[n.name],\"config.testing\":typeof P.options==\"string\"&&P.options.indexOf(\"debug\")!==-1||!1}),P.name&&(document.title=P.name)}function dn(){ln.log(`Running custom scripts (${P.customScripts.length})`);for(const n of P.customScripts)new Function(n).apply(window)}function fn(){ln.log(`Adding custom styles (${P.customStyles.length})`);for(const n of P.customStyles){const e=document.createElement(\"style\");e.innerHTML=n,document.head.appendChild(e)}}function hn(){return P.ifid}function ht(){return P.name}function Vr(){return P.passages}function pt(){return P.passages.find(n=>n.id===P.startNode)}function Se(n){return P.passages.find(e=>e.name===n)}function Wr(n){return P.passages.find(e=>e.id===n)}function pn(n){let e=[],t=!1;return async(...i)=>{t||(t=!0,Promise.resolve().then(()=>{try{n(e),e=[],t=!1}catch(r){window.setTimeout(()=>{throw r})}})),e.push(i)}}function ke(n,e,t=[]){const i=document.createElement(n);if(e)for(const r of Object.keys(e))e[r]!==void 0&&i.setAttribute(r,e[r]);for(const r of t)typeof r==\"string\"||typeof r==\"number\"?i.appendChild(document.createTextNode(r.toString())):i.appendChild(r);return i}function N(...n){return ke(...n).outerHTML}function Je(n){return Array.isArray(n)?n.every(Je):n===null?!0:typeof n==\"object\"?Object.getPrototypeOf(n)!==Object.prototype?!1:Object.values(n).every(Je):typeof n==\"number\"?isFinite(n)&&!isNaN(n):[\"boolean\",\"string\",\"undefined\"].includes(typeof n)}const{log:Q,warn:Zr}=F(\"state\");let te;const gt={},gn={},ce={};function mt(n,e){if(n[e])return;Object.defineProperty(n,e,{get(){return p(e)},set(i){$(e,i)},configurable:!0});const t=e.split(\".\");t.length>1&&(t.pop(),mt(n,t.join(\".\")))}function Gr(n,e){if(n[e])return;const t=e.split(\".\"),i=t[t.length-1];for(let r=0;r<t.length-1;r++)n[t[r]]=n[t[r]]||{},n=n[t[r]];Object.defineProperty(n,i,{get(){return p(e)},set(){throw new Error(\"Chapbook lookup variables may only be read.\")},configurable:!0})}function Jr(n,e){Ur(n,e)}function mn(){const n=hn(),e=ht();if(e===void 0)throw new Error(\"Cannot set up state: the story has no name\");te=`chapbook-${e}-${n}`,je(\"config.state.autosave\",!0)}function bt(){function n(e,t){Object.keys(e).forEach(i=>{const r=t===\"\"?i:`${t}.${i}`;if(typeof e[i]==\"object\"&&!Array.isArray(e[i]))n(e[i],r);else{const s=e[i];delete e[i],Jr(window,t),window.dispatchEvent(new CustomEvent(\"state-change\",{detail:{name:r,value:p(r),previous:s}}))}})}n(ce,\"\"),window.dispatchEvent(new CustomEvent(\"state-reset\")),p(\"config.state.autosave\")&&yt()}function $(n,e){const t=p(n);Je(e)||Zr(`Setting ${n} to ${JSON.stringify(e)} can't be saved permanently. This will work in the current session, but will not persist between sessions.`),ft(ce,n,e),mt(window,n),e!==t&&window.dispatchEvent(new CustomEvent(\"state-change\",{detail:{previous:t,name:n,value:e}})),p(\"config.state.autosave\")&&yt()}function je(n,e){const t=p(n);Q(`Defaulting \"${n}\" to ${JSON.stringify(e)}`),ft(gt,n,e),mt(window,n),t==null&&window.dispatchEvent(new CustomEvent(\"state-change\",{detail:{previous:t,name:n,value:e}}))}function re(n){for(const e in n)je(e,n[e])}function C(n,e){const t=p(n);Q(`Adding lookup variable ${n}`),ft(gn,n,e),Gr(window,n),t==null&&window.dispatchEvent(new CustomEvent(\"state-change\",{detail:{previous:t,name:n,value:p(n)}}))}function p(n){const e=Be(gn,n);if(typeof e==\"function\")return e(p,$);const t=Be(ce,n),i=Be(gt,n);if(t==null)return i;if(typeof t==\"object\"&&t!==null&&!Array.isArray(t)&&typeof i==\"object\"&&i!==null&&!Array.isArray(i)){const r={},s=[...Object.keys(i),...Object.keys(t)];for(const a of s)Object.defineProperty(r,a,{get(){return p(n+\".\"+a)},set(l){$(n+\".\"+a,l)},configurable:!0,enumerable:!0});return r}return t}function xe(){return{...ce}}function Ee(n){bt();for(const e in n)$(e,n[e])}function bn(){try{return window.localStorage.setItem(\"chapbook-test\",\"a\"),window.localStorage.removeItem(\"chapbook-test\"),!0}catch{return!1}}function yt(){Q(\"Saving to local storage: \"+JSON.stringify(xe())),window.localStorage.setItem(te,JSON.stringify(xe())),Q(\"Save complete\")}function yn(){return bn()&&window.localStorage.getItem(te)!==null}function wn(){Q(\"Restoring variables from local storage\");const n=window.localStorage.getItem(te);if(!n)throw new Error(`No value is set in local storage at \"${te}\"`);Ee(JSON.parse(n)),Q(\"Restore complete\")}function kn(n){n||Q(\"Purging variables from local storage\");const e=window.localStorage.getItem(te);if(!e)throw new Error(`No value is set in local storage at \"${te}\"`);Ee(JSON.parse(e)),n||Q(\"Purge complete\")}function He(n){function e(t,i,r=[]){return Object.keys(t).reduce((s,a)=>{if(typeof t[a]==\"object\"&&t[a]&&!Array.isArray(t[a]))e(t[a],i?`${i}.${a}`:a,s);else{const l=i?`${i}.${a}`:a;s.includes(l)||s.push(l)}return s},r)}return n?e(gt,void 0,e(ce)).sort():e(ce).sort()}const Xr=Object.freeze(Object.defineProperty({__proto__:null,canRestoreFromStorage:yn,canSaveToStorage:bn,get:p,initState:mn,purgeFromStorage:kn,reset:bt,restoreFromObject:Ee,restoreFromStorage:wn,saveToObject:xe,saveToStorage:yt,set:$,setDefault:je,setDefaults:re,setLookup:C,varNames:He},Symbol.toStringTag,{value:\"Module\"})),Qr=Object.freeze(Object.defineProperty({__proto__:null,addCustomStyles:fn,ifid:hn,initStory:un,loadFromData:cn,name:ht,passageNamed:Se,passageWithId:Wr,passages:Vr,runCustomScripts:dn,startPassage:pt},Symbol.toStringTag,{value:\"Module\"})),{log:xn}=F(\"actions\");function vn(n){xn(`Going to passage \"${n}\"`);const e=Se(n);if(!e)throw new Error(`There is no passage with the name \"${n}\"`);document.activeElement instanceof HTMLElement&&document.activeElement.blur();const t=p(\"trail\");if(!Array.isArray(t))throw new Error(`The trail variable has been set to a ${typeof t}, not an array.`);$(\"trail\",[...t,e.name])}function $n(){xn(\"Restarting\"),bt(),window.location.reload()}let X=[],Oe=!0;function Kr(){Oe&&(X=[],window.dispatchEvent(new CustomEvent(\"backstage-state-recorder-update\")))}function Yr({detail:n}){if(!Oe)return;X.length===p(\"config.backstage.trail.maxLength\")&&X.shift();const{name:e,value:t}=n;X.push({change:{name:e,value:t},state:xe()}),window.dispatchEvent(new CustomEvent(\"backstage-state-recorder-update\"))}function es(){return[...X]}function ts(n){if(!X[n])throw new Error(`There is no history at index ${n} to rewind to.`);Oe=!1,Ee(X[n].state),X.length=n+1,Oe=!0,window.dispatchEvent(new CustomEvent(\"backstage-state-recorder-update\"))}function ns(){je(\"config.backstage.trail.maxLength\",100),window.addEventListener(\"state-change\",Yr),window.addEventListener(\"state-reset\",Kr)}let V=[];function is(n){V.push({name:n,state:xe()}),Sn(),window.dispatchEvent(new CustomEvent(\"backstage-state-snapshots-update\"))}function rs(n){const e=V.find(t=>t.name===n);if(!e)throw new Error(`There is no snapshot named \"${n}\".`);Ee(e.state)}function ss(n){V=V.filter(({name:e})=>n!==e),Sn(),window.dispatchEvent(new CustomEvent(\"backstage-state-snapshots-update\"))}function os(){try{V=JSON.parse(window.localStorage.getItem(`chapbookbackstage-snapshots-${p(\"config.state.saveKey\")}`)),Array.isArray(V)||(V=[])}catch{V=[]}}function Sn(){window.localStorage.setItem(`chapbookbackstage-snapshots-${p(\"config.state.saveKey\")}`,JSON.stringify(V))}function Ot(){return V.map(({name:n})=>n)}function as(){os()}function wt(n){for(const e in n)window.customElements.get(e)||window.customElements.define(e,n[e])}class z extends HTMLElement{defaultHtml(e){this.innerHTML.trim()===\"\"&&(this.innerHTML=e)}delegate(e,t,i){this.addEventListener(e,r=>{if(!r.target)return;const s=r.target.closest(t);s&&i(r,s)})}query(e){const t=this.querySelector(e);if(!t)throw new Error(`Couldn't find element matching \"${e}\"`);return t}queryAll(e){return[...this.querySelectorAll(e)]}}class En extends z{constructor(){super(),this.addEventListener(\"click\",e=>{e.target.closest(\"[data-toggle-collapsed]\")&&(this.hasAttribute(\"collapsed\")?this.removeAttribute(\"collapsed\"):this.setAttribute(\"collapsed\",\"\"))})}connectedCallback(){this.innerHTML=`\n\t\t\t<button data-toggle-collapsed></button>\n\t\t\t<div class=\"content\">\n\t\t\t\t<backstage-tabs aria-label=\"Backstage\">\n\t\t\t\t<backstage-tab\n\t\t\t\t\taria-controls=\"backstage-state-tab-panel\"\n\t\t\t\t\tid=\"backstage-state-tab\"\n\t\t\t\t>\n\t\t\t\t\tState\n\t\t\t\t</backstage-tab>\n\t\t\t\t<backstage-tab\n\t\t\t\t\taria-controls=\"backstage-history-tab-panel\"\n\t\t\t\t\tid=\"backstage-history-tab\"\n\t\t\t\t>\n\t\t\t\t\tHistory\n\t\t\t\t</backstage-tab>\n\t\t\t\t<backstage-tab\n\t\t\t\t\taria-controls=\"backstage-style-tab-panel\"\n\t\t\t\t\tid=\"backstage-style-tab\"\n\t\t\t\t>\n\t\t\t\t\tStyle\n\t\t\t\t</backstage-tab>\n\t\t\t\t<backstage-tab\n\t\t\t\t\taria-controls=\"backstage-notes-tab-panel\"\n\t\t\t\t\tid=\"backstage-notes-tab\"\n\t\t\t\t>\n\t\t\t\t\tNotes\n\t\t\t\t</backstage-tab>\n\t\t\t</backstage-tabs>\n\t\t\t<backstage-tab-panel\n\t\t\t\taria-labelledby=\"backstage-state-tab\"\n\t\t\t\tid=\"backstage-state-tab-panel\"\n\t\t\t>\n\t\t\t\t<backstage-state-variables></backstage-state-variables>\n\t\t\t\t<backstage-state-snapshots></backstage-state-snapshots>\n\t\t\t</backstage-tab-panel>\n\t\t\t<backstage-tab-panel\n\t\t\t\taria-labelledby=\"backstage-history-tab\"\n\t\t\t\tid=\"backstage-history-tab-panel\"\n\t\t\t>\n\t\t\t\t<backstage-history-table></backstage-history-table>\n\t\t\t</backstage-tab-panel>\n\t\t\t<backstage-tab-panel\n\t\t\t\taria-labelledby=\"backstage-style-tab\"\n\t\t\t\tid=\"backstage-style-tab-panel\"\n\t\t\t>\n\t\t\t\t<backstage-style-theme></backstage-style-theme>\n\t\t\t\t<backstage-style-config></backstage-style-config>\n\t\t\t\t<backstage-style-group title=\"Page\" prefix=\"page\"></backstage-style-group>\n\t\t\t\t<backstage-style-group title=\"Header\"></backstage-style-group>\n\t\t\t\t<backstage-style-group title=\"Footer\"></backstage-style-group>\n\t\t\t</backstage-tab-panel>\n\t\t\t<backstage-tab-panel\n\t\t\t\taria-labelledby=\"backstage-notes-tab\"\n\t\t\t\tid=\"backstage-notes-tab-panel\"\n\t\t\t>\n\t\t\t\t<backstage-notes></backstage-notes>\n\t\t\t</backstage-tab-panel>\n\t\t</div>`,this.update()}attributeChangedCallback(){this.update()}update(){const e=this.querySelectorAll(\"[data-toggle-collapsed]\");if(this.hasAttribute(\"collapsed\")){for(const t of e)t.innerHTML=\"&larr;\",t.setAttribute(\"aria-label\",\"Show Backstage\");document.body.classList.remove(\"backstage-visible\")}else{for(const t of e)t.innerHTML=\"&rarr;\",t.setAttribute(\"aria-label\",\"Hide Backstage\");document.body.classList.add(\"backstage-visible\")}}}U(En,\"observedAttributes\",[\"collapsed\"]);function ls(n){const e=[];let t=[],i;return n.forEach(({change:r},s)=>{if(r.name===\"trail\"){const a=r.value;e.push({historyIndex:s-1,passage:i,varChanges:t}),t=[],i=a[a.length-1]}else t.push({name:r.name,value:r.value})}),e.push({historyIndex:n.length-1,passage:i,varChanges:t}),e}class cs extends z{constructor(){super();U(this,\"root\",document.createElement(\"div\"));this.delegate(\"click\",\"button[data-rewind]\",(t,i)=>{const r=parseInt(i.dataset.rewind??\"\");isNaN(r)||ts(r)})}connectedCallback(){window.addEventListener(\"backstage-state-recorder-update\",this),this.update()}disconnectedCallback(){window.removeEventListener(\"backstage-state-recorder-update\",this)}handleEvent(){this.update()}update(){this.innerHTML=ls(es()).reduce((t,{historyIndex:i,passage:r,varChanges:s})=>{t+=`\n\t\t\t\t\t<button\n\t\t\t\t\t\tdata-rewind=\"${i}\"\n\t\t\t\t\t\taria-label=\"Rewind to ${r?q(r):\"Startup\"}\">&#x21aa;\n\t\t\t\t\t${r?q(r):\"<em>Startup</em>\"}</button><table><thead><tr><th>Variable</th><th>Value</th></thead><tbody>`;for(const a of s)t+=`\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>${q(a.name)}</td><td>${q(JSON.stringify(a.value))}</td>\n\t\t\t\t\t\t</tr>`;return t+\"</tbody></table>\"},\"\")}}let M={};function us(){M={},kt()}function ds(){const n=Object.keys(M).reduce((t,i)=>t+`<li class=\"note\"><span class=\"passage\">${q(i)}</span><pre>${q(M[i])}</pre></li>`,\"\");let e=p(\"story.name\");return typeof e!=\"string\"&&(e=\"Story\"),`<h1>Notes for &ldquo;${q(e)}&rdquo;</h1><ul data-cb-backstage-notes data-cb-version=\"${p(\"engine.version\")}\">${n}</ul>`}function fs(n){return M[n]}function hs(n){const e=document.createElement(\"div\"),t={...M};let i=0;e.innerHTML=n;for(const r of e.querySelectorAll(\"ul[data-cb-backstage-notes] li\")){const s=r.querySelector(\"span.passage\"),a=r.querySelector(\"pre\");s!=null&&s.textContent&&(a!=null&&a.textContent)&&(t[s.textContent]?t[s.textContent]=`${t[s.textContent]??\"\"}\n\n${a.textContent}`:t[s.textContent]=a.textContent,i++)}return M=t,kt(),i}function ps(){const n=window.localStorage.getItem(`chapbookbackstage-passage-notes-${p(\"config.state.saveKey\")}`);try{n&&(M=JSON.parse(n),(typeof M!=\"object\"||Array.isArray(M))&&(M={}))}catch{M={}}}function kt(){window.localStorage.setItem(`chapbookbackstage-passage-notes-${p(\"config.state.saveKey\")}`,JSON.stringify(M))}function gs(n,e){M[n]=e,kt()}function ms(){ps()}function It(){const n=p(\"trail\");if(Array.isArray(n))return n[n.length-1]}class bs extends z{constructor(){super(),this.delegate(\"change\",'input[type=\"file\"]',e=>{var i;const t=(i=e.target.files)==null?void 0:i[0];if(t){const r=new FileReader;r.onload=s=>{const a=hs(s.target.result);window.alert(`${a} note(s) were imported.`)},r.readAsText(t)}}),this.delegate(\"change\",\"textarea\",e=>{const t=It();t&&gs(t,e.target.value)}),this.delegate(\"click\",\"[data-export]\",()=>{const e=ds(),t=document.createElement(\"a\");p(\"story.name\"),t.setAttribute(\"download\",`${p(\"story.name\")} Notes - ${new Date().toDateString()} ${new Date().toTimeString()}.html`),t.setAttribute(\"href\",\"data:text/html;base64,\"+window.btoa(e)),document.body.appendChild(t),t.click(),document.body.removeChild(t)}),this.delegate(\"click\",\"[data-import]\",()=>{this.query('input[type=\"file\"]').click()}),this.delegate(\"click\",\"[data-reset]\",()=>{window.confirm(\"Are you sure? This will delete all text entered in the Notes panel of Backstage, and cannot be undone.\")&&us()})}connectedCallback(){this.defaultHtml(`\n\t\t\t<label for=\"backstage-notes-textarea\"></label>\n\t\t\t\t<textarea id=\"backstage-notes-textarea\"></textarea>\n\t\t\t\t<div class=\"actions\">\n\t\t\t\t\t<button data-export>Export All Notes</button>\n\t\t\t\t\t<button data-import>Import Notes</button>\n\t\t\t\t\t<button data-reset>Delete All Notes</button>\n\t\t\t\t</div>\n\t\t\t\t<input type=\"file\" hidden />\n\t\t`),window.addEventListener(\"state-change\",this),this.update()}disconnectedCallback(){window.removeEventListener(\"state-change\",this)}handleEvent(e){e.detail.name===\"trail\"&&this.update()}update(){const e=It();e&&(this.query(\"#backstage-notes-textarea\").value=fs(e)??\"\",this.query('label[for=\"backstage-notes-textarea\"]').textContent=`Notes on \"${e}\"`)}}class ys extends z{constructor(){super(),this.delegate(\"click\",\"[data-add-snapshot]\",()=>{const e=window.prompt(\"Enter a name for this snapshot:\");e&&(Ot().includes(e)?window.alert(\"A snapshot already exists with this name.\"):is(e))}),this.delegate(\"click\",\"[data-remove]\",({target:e})=>{const t=e.dataset.remove;t&&window.confirm(`Are you sure you want to delete the snapshot \"${t}\"? This cannot be undone.`)&&ss(t)}),this.delegate(\"click\",\"[data-restore]\",({target:e})=>{rs(e.dataset.restore)})}connectedCallback(){this.defaultHtml(`\n\t\t\t<details open>\n\t\t\t\t<summary>Snapshots</summary>\n\t\t\t\t<div class=\"snapshots\"></div>\n\t\t\t\t<button data-add-snapshot>Add Snapshot</button>\n\t\t\t</details>\n\t\t`),window.addEventListener(\"backstage-state-snapshots-update\",this),this.update()}disconnectedCallback(){window.removeEventListener(\"backstage-state-snapshots-update\",this)}handleEvent(){this.update()}update(){const e=this.querySelector(\".snapshots\");e&&(e.innerHTML=Ot().map(t=>{const i=q(t);return`\n\t\t\t\t\t<div class=\"snapshot-button\">\n\t\t\t\t\t\t<button data-restore=\"${i}\" aria-label=\"Restore '${i}' snapshot\">\n\t\t\t\t\t\t\t${i}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button data-remove=\"${i}\" aria-label=\"Remove '${i}' snapshot\">\n\t\t\t\t\t\t\t&times;\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div class=\"snapshot-button\">\n\t\t\t\t`}).join(\"\"))}}const ws=[\"config.random.privateState\"];class ks extends z{constructor(){super();U(this,\"showDefaults\",!1);this.delegate(\"change\",'input[type=\"checkbox\"]',t=>{this.showDefaults=t.target.checked,this.update()})}connectedCallback(){this.defaultHtml(`\n\t\t\t<details open>\n\t\t\t\t<summary>Variables</summary>\n\t\t\t\t<label>\n\t\t\t\t\t<input type=\"checkbox\" />\n\t\t\t\t\tShow Defaults\n\t\t\t\t</label>\n\t\t\t\t<div class=\"variables\"></div>\n\t\t\t</details>\n\t\t`),this.update(),window.addEventListener(\"state-change\",this)}disconnectedCallback(){window.removeEventListener(\"state-change\",this)}handleEvent(){this.update()}update(){this.query(\".variables\").innerHTML=He(this.showDefaults).filter(t=>!ws.some(i=>t.startsWith(i))).map(t=>`<div><label><span>${q(t)}</span><backstage-variable-input name=\"${q(t)}\"></backstage-variable-input></label></div>`).join(\"\")}}const xs=[\"config.style.page.theme.override\"];class vs extends z{connectedCallback(){this.defaultHtml(`\n\t\t\t<details open>\n\t\t\t\t<summary>Config</summary>\n\t\t\t\t<label for=\"cb-backstage-style-config\">\n\t\t\t\t\tEnter this code into your first passage&rsquo;s variables section to\n\t\t\t\t\tpermanently use this style:\n\t\t\t\t</label>\n\t\t\t\t<textarea\n\t\t\t\t\treadonly\n\t\t\t\t\tid=\"cb-backstage-style-config\"\n\t\t\t\t></textarea>\n\t\t\t</details>\n\t\t`),window.addEventListener(\"state-change\",this),this.update()}disconnectedCallback(){window.removeEventListener(\"state-change\",this)}handleEvent(){this.update()}update(){this.query(\"textarea\").value=He(!1).reduce((e,t)=>!/^config.style/.test(t)||xs.includes(t)||p(t)===void 0?e:e+`${t}: ${JSON.stringify(p(t))}\n`,\"\").trim()}}const $s=[{name:\"Font\",suffix:\"font\"},{name:\"Color\",suffix:\"color\"},{name:\"Link Font\",suffix:\"link.font\"},{name:\"Link Color\",suffix:\"link.color\"},{name:\"Link Line Color\",suffix:\"link.lineColor\"},{name:\"Active Link Font\",suffix:\"link.active.font\"},{name:\"Active Link Color\",suffix:\"link.active.color\"},{name:\"Active Link Line Color\",suffix:\"link.active.lineColor\"}];class Cn extends z{connectedCallback(){const e=this.getAttribute(\"prefix\"),t=this.getAttribute(\"title\");this.defaultHtml(`\n\t\t\t<details open>\n\t\t\t\t<summary>${t}</summary>\n\t\t\t\t${$s.map(({name:i,suffix:r})=>`\n\t\t\t\t\t\t<label data-prefix=\"%.${r}\">\n\t\t\t\t\t\t\t${i}\n\t\t\t\t\t\t\t<backstage-variable-input name=\"${e}.${r}\" string />\n\t\t\t\t\t\t</label>\n\t\t\t\t\t`).join(\"\")}\n\t\t\t</details>\n\t\t`),window.addEventListener(\"state-change\",this),window.addEventListener(\"system-theme-change\",this),this.updateInputs()}updateInputs(){var r;const e=this.getAttribute(\"prefix\")??\"\",t=p(\"browser.darkTheme\");let i=\"config.style.\";t&&(i+=\"dark.\");for(const s of this.queryAll(\"backstage-variable-input\")){const a=(r=s.closest(\"[data-prefix]\"))==null?void 0:r.dataset.prefix;if(a&&(s.setAttribute(\"name\",i+a.replace(\"%\",e)),s.removeAttribute(\"placeholder\"),t)){const l=p(`config.style.${a.replace(\"%\",e)}`);typeof l==\"string\"&&s.setAttribute(\"placeholder\",l)}}}attributeChangedCallback(e,t,i){if(this.innerHTML!==\"\")switch(e){case\"title\":this.query(\"summary\").innerText=i;break;case\"prefix\":this.updateInputs();break}}handleEvent(e){(e.type===\"system-theme-change\"||e.detail.name===\"config.style.page.theme.override\")&&this.updateInputs()}}U(Cn,\"observedAttributes\",[\"prefix\",\"title\"]);class Ss extends z{connectedCallback(){this.defaultHtml(`\n      <details open>\n      <summary>Theme</summary>\n      <p>The <strong data-theme-name></strong> theme is active. <button>Switch Theme</button></p>\n      <p>\n      <label><input type=\"checkbox\"> Theme switching</label>\n      </p>\n      </details>\n    `),this.update(),this.query(\"button\").addEventListener(\"click\",()=>this.switchTheme()),this.query(\"input\").addEventListener(\"change\",()=>this.toggleThemeSwitching()),window.addEventListener(\"system-theme-change\",this),window.addEventListener(\"state-change\",this),this.update()}disconnectedCallback(){window.removeEventListener(\"system-theme-change\",this)}handleEvent(e){(e.type===\"system-theme-change\"||[\"config.style.page.theme.override\",\"config.style.page.theme.enableSwitching\"].includes(e.detail.name))&&this.update()}switchTheme(){$(\"config.style.page.theme.override\",p(\"browser.darkTheme\")?\"light\":\"dark\")}toggleThemeSwitching(){$(\"config.style.page.theme.enableSwitching\",!p(\"config.style.page.theme.enableSwitching\")),this.update()}update(){const e=!!p(\"config.style.page.theme.enableSwitching\");this.query(\"input\").checked=e,this.query(\"button\").disabled=!e,this.query(\"[data-theme-name]\").innerHTML=p(\"browser.darkTheme\")?\"dark\":\"light\"}}class Es extends z{constructor(){super(),this.addEventListener(\"click\",()=>{var e;this.textContent&&((e=this.closest(\"backstage-tabs\"))==null||e.selectTab(this.textContent))})}connectedCallback(){this.setAttribute(\"role\",\"tab\")}}class Cs extends z{connectedCallback(){this.setAttribute(\"role\",\"tabpanel\")}}class _s extends z{connectedCallback(){this.setAttribute(\"role\",\"tablist\"),window.setTimeout(()=>this.selectTab(0))}selectTab(e){[...this.children].filter(t=>t.getAttribute(\"role\")===\"tab\").forEach((t,i)=>{var a,l;const r=t.getAttribute(\"aria-controls\"),s=typeof e==\"number\"?i==e:t.textContent===e;t.setAttribute(\"aria-selected\",s.toString()),r&&(s?(a=document.getElementById(r))==null||a.removeAttribute(\"hidden\"):(l=document.getElementById(r))==null||l.setAttribute(\"hidden\",\"\"))})}}class _n extends z{constructor(){super(),this.addEventListener(\"input\",e=>{const t=this.getAttribute(\"name\");if(!t||!e.target)return;const i=e.target.value;try{this.hasAttribute(\"string\")?$(t,i):$(t,JSON.parse(i))}catch{}})}attributeChangedCallback(){const e=this.getAttribute(\"name\");if(!e)return;const t=p(e);let i=JSON.stringify(t);this.hasAttribute(\"string\")&&(t==null?i=\"\":i=t.toString()),this.innerHTML=`<input type=\"text\" placeholder=\"${this.getAttribute(\"placeholder\")??\"\"}\" value=\"${q(i)}\" />`}}U(_n,\"observedAttributes\",[\"name\",\"placeholder\",\"string\"]);function Ts(){wt({\"backstage-history-table\":cs,\"backstage-notes\":bs,\"backstage-sidebar\":En,\"backstage-state-snapshots\":ys,\"backstage-state-variables\":ks,\"backstage-style-config\":vs,\"backstage-style-group\":Cn,\"backstage-style-theme\":Ss,\"backstage-tab\":Es,\"backstage-tab-panel\":Cs,\"backstage-tabs\":_s,\"backstage-variable-input\":_n})}function As(){ms(),ns(),as(),Ts(),document.body.appendChild(document.createElement(\"backstage-sidebar\"))}var se=typeof globalThis<\"u\"?globalThis:typeof window<\"u\"?window:typeof global<\"u\"?global:typeof self<\"u\"?self:{};function Ls(n){if(n.__esModule)return n;var e=n.default;if(typeof e==\"function\"){var t=function i(){if(this instanceof i){var r=[null];r.push.apply(r,arguments);var s=Function.bind.apply(e,r);return new s}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,\"__esModule\",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),t}var ve=Ps;const zs={hoursPerDay:24,daysPerWeek:7,weeksPerMonth:4,monthsPerYear:12,daysPerYear:365.25},Mt={ms:[\"ms\",\"milli\",\"millisecond\",\"milliseconds\"],s:[\"s\",\"sec\",\"secs\",\"second\",\"seconds\"],m:[\"m\",\"min\",\"mins\",\"minute\",\"minutes\"],h:[\"h\",\"hr\",\"hrs\",\"hour\",\"hours\"],d:[\"d\",\"day\",\"days\"],w:[\"w\",\"week\",\"weeks\"],mth:[\"mon\",\"mth\",\"mths\",\"month\",\"months\"],y:[\"y\",\"yr\",\"yrs\",\"year\",\"years\"]};function Ps(n,e,t){t=Object.assign({},zs,t||{});let i=0,r=Os(t),s=n.toLowerCase().replace(/[^.\\w+-]+/g,\"\").match(/[-+]?[0-9.]+[a-z]+/g);if(s===null)throw new Error(`The string [${n}] could not be parsed by timestring`);return s.forEach(a=>{let l=a.match(/[0-9.]+/g)[0],o=a.match(/[a-z]+/g)[0];i+=Is(l,o,r)}),e?Ms(i,e,r):i}function Os(n){let e={ms:.001,s:1,m:60,h:3600};return e.d=n.hoursPerDay*e.h,e.w=n.daysPerWeek*e.d,e.mth=n.daysPerYear/n.monthsPerYear*e.d,e.y=n.daysPerYear*e.d,e}function Tn(n){for(let e of Object.keys(Mt))if(Mt[e].indexOf(n)>-1)return e;throw new Error(`The unit [${n}] is not supported by timestring`)}function Is(n,e,t){return n*t[Tn(e)]}function Ms(n,e,t){return n/t[Tn(e)]}function xt(n,e){return new Promise(t=>{n.innerHTML=e,t()})}function Ns(n,e,t){const i=ve(t,\"s\")/2;return i===0?xt(n,e):new Promise(r=>{const s=n.style.animationDuration,a=n.style.pointerEvents,l=n.style.visibility;n.style.pointerEvents=\"none\";function o(){n.removeEventListener(\"animationend\",o),n.classList.remove(\"fade-in\"),n.style.animationDuration=s,n.style.pointerEvents=a,r()}n.innerHTML.trim()!==\"\"?(n.style.animationDuration=`${i}s`,n.addEventListener(\"animationend\",async function u(){n.removeEventListener(\"animationend\",u),n.classList.remove(\"fade-out\"),n.style.visibility=\"hidden\",window.setTimeout(()=>{n.addEventListener(\"animationend\",o),n.innerHTML=e,n.style.visibility=l,n.classList.add(\"fade-in\")},0)}),n.classList.add(\"fade-out\")):(n.innerHTML=e,n.style.animationDuration=`${i*2}s`,n.classList.add(\"fade-in\"),n.addEventListener(\"animationend\",o))})}function Rs(n,e,t){const i=ve(t,\"s\");return i===0?xt(n,e):new Promise((r,s)=>{const a=n.style.animationDuration,l=n.style.pointerEvents;if(n.innerHTML.trim()!==\"\"){if(!n.parentNode){s(new Error(\"This element must have a parent element.\"));return}const o=n.cloneNode(!0);n.parentNode.appendChild(o),o.setAttribute(\"aria-hidden\",\"\"),o.classList.add(\"fade-out\"),o.style.animationDuration=`${i}s`,o.addEventListener(\"animationend\",()=>o.remove())}n.innerHTML=e,n.classList.add(\"fade-in\"),n.style.animationDuration=`${i}s`,n.style.pointerEvents=\"none\",n.addEventListener(\"animationend\",function o(){n.removeEventListener(\"animationend\",o),n.style.animationDuration=a,n.style.pointerEvents=l,n.classList.remove(\"fade-in\"),r()})})}function Ds(n){return typeof n==\"string\"&&[\"crossfade\",\"fadeInOut\",\"none\"].includes(n)}function An(n,e,t,i){const r=typeof i==\"string\"?i:\"0s\";switch(Ds(t)?t:\"none\"){case\"crossfade\":return Rs(n,e,r);case\"fadeInOut\":return Ns(n,e,r);case\"none\":return xt(n,e)}}class Ln extends z{allChildInputsValid(){let e=!0;for(const t of this.querySelectorAll(\"input, select\"))e=e&&t.reportValidity();return e}moveContentsOffscreen(){const e=this.innerHTML,t=document.createElement(\"div\");for(;this.firstChild;)t.appendChild(this.firstChild);return this.innerHTML=e,t}}class js extends Ln{connectedCallback(){window.addEventListener(\"display-change\",this)}disconnectedCallback(){window.removeEventListener(\"display-change\",this)}async changeContent(e){const t=super.moveContentsOffscreen();await e(t),await An(this,t.innerHTML,p(\"config.body.transition.name\"),p(\"config.body.transition.duration\")),this.dispatchEvent(new CustomEvent(\"body-content-change\",{bubbles:!0}))}handleEvent({detail:e}){this.changeContent(t=>{t.innerHTML=e.body}),this.getAttribute(\"disablescroll\")===null&&window.scrollTo(0,0)}}class Hs extends z{constructor(){super(),this.delegate(\"click\",\"[data-back]\",()=>{const e=p(\"trail\");this.classList.remove(\"active\"),Array.isArray(e)?$(\"trail\",e.slice(0,e.length-1)):window.alert(\"Sorry, going back was not successful. Please try hard restarting.\")}),this.delegate(\"click\",\"[data-refresh]\",()=>{var t;const e=p(\"trail\");this.classList.remove(\"active\"),Array.isArray(e)?$(\"trail\",[...e]):$(\"trail\",[(t=pt())==null?void 0:t.name])}),this.delegate(\"click\",\"[data-hard-restart]\",()=>{kn(!0),window.location.reload()})}connectedCallback(){window.addEventListener(\"error\",this),window.addEventListener(\"unhandledrejection\",this)}disconnectedCallback(){window.removeEventListener(\"error\",this),window.removeEventListener(\"unhandledrejection\",this)}handleEvent(e){const t=`\nPlease report this to https://github.com/markedjs/marked.`,i=e.type===\"unhandledrejection\"?e.reason:e.error;try{let r=\"\";i!=null&&i.stack?r=`${i.message}\n\nStack trace:\n${i.stack}`:r=`${i.message}\n\n[No stack trace available]`,r=r.replace(t,\"\");const s=p(\"trail\");this.classList.add(\"active\"),this.innerHTML=`\n\t\t\t<p>\n\t\t\tAn unexpected error has occurred.\n\t\t\t</p>\n\t\t\t<pre>${p(\"config.testing\")?r:\"\"}</pre>\n\t\t\t<ul>\n\t\t\t\t<li>\n\t\t\t\t\t<inline-button class=\"link\" ${Array.isArray(s)&&s.length>1?\"data-back\":\"data-refresh\"}>Go back</inline-button> to the previous passage.\n\t\t\t\t</li>\n\t\t\t\t<li>\n\t\t\t\t\t<inline-button class=\"link\" data-hard-restart>Hard restart</inline-button>, clearing all progress and beginning from the start.\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t`}catch(r){console.error(r)}}}const{log:_e}=F(\"display\");class qs extends z{connectedCallback(){window.addEventListener(\"state-change\",this),this.defaultHtml(\"<div data-google></div><div data-typekit></div>\")}disconnectedCallback(){window.removeEventListener(\"state-change\",this)}handleEvent({detail:e}){if([\"config\",\"config.style\",\"config.style.fonts\"].includes(e.name)){const r=p(\"config.style.fonts\");if(!r)return;for(const s in r){const a=r[s].name,l=r[s].url;typeof a==\"string\"&&typeof l==\"string\"&&this.loadUrlFont(s,l,a)}return}const i=e.name.match(/^config\\.style\\.fonts\\.([^.]+)/i);if(i){const r=i[1],s=p(`config.style.fonts.${r}.name`),a=p(`config.style.fonts.${r}.url`);typeof a==\"string\"&&typeof s==\"string\"&&(_e(`Adding font from URL (${s})`),this.loadUrlFont(r,a,s));return}e.name===\"config.style.googleFont\"&&typeof e.value==\"string\"?this.loadGoogleFont(e.value):e.name===\"config.style.typekitFont\"&&typeof e.value==\"string\"&&this.loadTypekitFont(e.value)}loadGoogleFont(e){_e(\"Adding Google font\"),this.query(\"[data-google]\").innerHTML=e}loadTypekitFont(e){_e(\"Adding Typekit font\"),this.query(\"[data-typekit]\").innerHTML=e}loadUrlFont(e,t,i){_e(\"Adding font from URL\");const r=t.match(/\\.(.+)$/);if(!r||!r[1])return;const s=r[1],a=this.querySelector(`[data-url-${e}]`)??document.createElement(\"style\");a.setAttribute(`data-url-${e}`,\"\"),a.innerHTML=`@font-face { font-family: \"${i}\"; src: url(\"${t}\") format(\"${s}\"); }`,a.parentNode||this.appendChild(a)}}class Fs extends Ln{get validatedType(){const e=this.getAttribute(\"type\")??\"\";if(![\"footer\",\"header\"].includes(e))throw new Error(`Don't know how to update marginal content with type \"${e}\".`);return e}connectedCallback(){window.addEventListener(\"display-change\",this)}disconnectedCallback(){window.removeEventListener(\"display-change\",this)}async changeContent(e){const t=super.moveContentsOffscreen();await e(t);let i=!1;for(const r of[\"left\",\"center\",\"right\"]){const s=t.querySelector(`.${r}`);if((s==null?void 0:s.innerHTML.trim())!==\"\"){i=!0;break}}if(i)return this.removeAttribute(\"hidden\"),An(this,t.innerHTML,p(`config.${this.validatedType}.transition.name`),p(`config.${this.validatedType}.transition.duration`));this.setAttribute(\"hidden\",\"\")}handleEvent({detail:e}){this.changeContent(t=>{t.innerHTML=[\"left\",\"center\",\"right\"].reduce((i,r)=>i+`<div class=\"${r}\">${e[this.validatedType][r]}</div>`,\"\")})}}class Bs extends HTMLElement{constructor(){super(),this.addEventListener(\"body-content-change\",this)}handleEvent({target:e}){if(!e)return;const t=[...e.querySelectorAll(\"[skippable-delay]\")].map(l=>{const o={delay:0,el:l};try{o.delay=parseInt(l.getAttribute(\"skippable-delay\")??\"0\")}catch{}return o}).filter(({delay:l})=>!!l).sort((l,o)=>l.delay-o.delay);if(t.length===0)return;let i=Date.now(),r;const s=()=>{var u;const l=Date.now()-i,o=(u=t.find(({delay:c})=>c>l))==null?void 0:u.delay;if(!o){this.dispatchEvent(new CustomEvent(\"page-skip-indicator-hide\"));return}for(const c of t)c.delay<=0||(c.delay<=o?(c.delay=0,c.el.setAttribute(\"skippable-delay\",\"0\")):(c.delay-=o,c.el.setAttribute(\"skippable-delay\",c.delay.toString())));i=Date.now(),window.clearTimeout(r),a()},a=()=>{r&&window.clearTimeout(r),r=window.setTimeout(()=>{window.removeEventListener(\"click\",s),window.removeEventListener(\"keyup\",s),this.dispatchEvent(new CustomEvent(\"page-skip-indicator-hide\"))},t[t.length-1].delay)};window.addEventListener(\"click\",s),window.addEventListener(\"keyup\",s),a(),this.dispatchEvent(new CustomEvent(\"page-skip-indicator-show\"))}}class Us extends z{connectedCallback(){var e,t;(e=this.closest(\"page-skip\"))==null||e.addEventListener(\"page-skip-indicator-hide\",this),(t=this.closest(\"page-skip\"))==null||t.addEventListener(\"page-skip-indicator-show\",this)}disconnectedCallback(){var e,t;(e=this.closest(\"page-skip\"))==null||e.removeEventListener(\"page-skip-indicator-hide\",this),(t=this.closest(\"page-skip\"))==null||t.removeEventListener(\"page-skip-indicator-show\",this)}handleEvent(e){switch(e.type){case\"page-skip-indicator-hide\":this.removeAttribute(\"active\");break;case\"page-skip-indicator-show\":this.setAttribute(\"active\",\"\");break}}}const Nt=[\"gray\",\"red\",\"pink\",\"grape\",\"violet\",\"indigo\",\"blue\",\"cyan\",\"teal\",\"green\",\"lime\",\"yellow\",\"orange\"].map(n=>`oc-${n}`),Vs=[\"gray\",\"rose\",\"raspberry\",\"red\",\"orange\",\"cinnamon\",\"amber\",\"yellow\",\"lime\",\"chartreuse\",\"green\",\"emerald\",\"aquamarine\",\"teal\",\"cyan\",\"powder\",\"sky\",\"cerulean\",\"azure\",\"blue\",\"indigo\",\"violet\",\"purple\",\"magenta\",\"pink\"];function Rt(n){if(typeof n!=\"string\")throw new Error(\"Only strings can be parsed as color values.\");if(Nt.includes(n))return`var(--${n}-9)`;const e=/^(oc-\\w+)-\\d$/.exec(n);if(e&&Nt.includes(e[1]))return`var(--${n})`;const t=/^(\\w+)-([1-6])$/.exec(n);return t&&Vs.includes(t[1])?`var(--color-${n})`:n}function me(n){const e={backgroundColor:\"inherit\",color:\"inherit\"};if(n===void 0)return e;if(typeof n!=\"string\")throw new Error(\"Only strings can be parsed as colors.\");const t=n.split(/ on /i);return e.color=Rt(t[0].trim().toLowerCase()),e.color===\"\"&&(e.color=\"inherit\"),t.length===2&&(e.backgroundColor=Rt(t[1].trim().toLowerCase())),e}function Ws(n,{scaling:e}){const t={fontFamily:\"inherit\",fontSize:\"inherit\",fontStyle:\"inherit\",fontVariant:\"inherit\",fontWeight:\"inherit\",textDecoration:\"inherit\",textTransform:\"inherit\"};if(n===void 0)return t;if(typeof n!=\"string\")throw new Error(\"Only strings can be parsed as fonts.\");function i(c,d){c.fontFamily=d.split(\"/\").map(f=>{let h=f;return[\"monospace\",\"sans-serif\",\"serif\"].includes(h)||(h[0]!=='\"'&&(h='\"'+h),h[h.length-1]!=='\"'&&(h=h+'\"')),h}).join(\",\")}function r(c){c.fontWeight=\"bold\"}function s(c){c.fontStyle=\"italic\"}function a(c){c.fontStyle=\"none\",c.fontWeight=\"normal\",c.textDecoration=\"none\",c.textTransform=\"none\"}function l(c){c.fontVariant=\"small-caps\",c.textTransform=\"lowercase\"}function o(c){c.textDecoration=\"underline\"}const u=/\\b\\d+(?:\\.\\d+)?(ch|cm|ex|in|mm|pc|pt|px|r?em|vh|vmax|vmin|vw|%)?/i.exec(n);if(u){t.fontSize=u[0],/^\\d+$/.test(u[0])&&(t.fontSize=`${u[0]}px`),e&&(t.fontSize=`calc(${t.fontSize} + max(${e.addAtDoubleWidth} * (100vw - ${e.baseViewportWidth}px) / ${e.baseViewportWidth}, 0px))`,e.maximumSize&&(t.fontSize=`min(${t.fontSize}, ${e.maximumSize})`)),u.index!==0&&i(t,n.substring(0,u.index).trim());const c=n.substring(u.index);/\\bregular\\b/i.test(c)?a(t):(/\\bbold\\b/.test(c)&&r(t),/\\bitalics?\\b/.test(c)&&s(t),/\\bunderlined?/.test(c)&&o(t),/\\bsmall caps?\\b/.test(c)&&l(t))}else{let c,d=n;for(;c=/(bold|italics?|regular|small caps|underlined?)$/.exec(d);){switch(c[0]){case\"bold\":r(t);break;case\"italic\":case\"italics\":s(t);break;case\"regular\":a(t);break;case\"small caps\":l(t);break;case\"underline\":case\"underlined\":o(t);break}d=d.substring(0,c.index).trim()}d.trim()!==\"\"&&i(t,d)}return t}const Zs={\"config.style.dark.backdrop\":\"hsl(0, 0%, 10%)\",\"config.style.dark.page.footer.border\":\"thin-line\",\"config.style.dark.page.footer.borderColor\":\"white\",\"config.style.dark.page.footer.link.active.color\":\"raspberry-3 on raspberry-6\",\"config.style.dark.page.fork.divider.color\":\"gray-5\",\"config.style.dark.page.color\":\"white on gray-6\",\"config.style.dark.page.header.border\":\"thin-line\",\"config.style.dark.page.header.borderColor\":\"white\",\"config.style.dark.page.header.link.active.color\":\"raspberry-3 on raspberry-6\",\"config.style.dark.page.link.color\":\"white\",\"config.style.dark.page.link.lineColor\":\"raspberry-4\",\"config.style.dark.page.link.active.color\":\"raspberry-3 on raspberry-6\",\"config.style.backdrop\":\"gray-1\",\"config.style.fontScaling.enabled\":!0,\"config.style.fontScaling.baseViewportWidth\":1e3,\"config.style.fontScaling.addAtDoubleWidth\":6,\"config.style.page.style.border\":\"shadow\",\"config.style.page.style.borderColor\":\"gray-2\",\"config.style.page.font\":\"Iowan Old Style/Constantia/Georgia/serif 18\",\"config.style.page.color\":\"gray-6 on white\",\"config.style.page.fork.divider.color\":\"gray-2\",\"config.style.page.fork.divider.style\":\"dashed\",\"config.style.page.fork.divider.size\":1,\"config.style.page.link.color\":\"gray-6\",\"config.style.page.link.lineColor\":\"raspberry-4\",\"config.style.page.link.font\":\"underline\",\"config.style.page.link.active.color\":\"raspberry-4 on raspberry-1\",\"config.style.page.verticalAlign\":\"center\",\"config.style.page.header.border\":\"thin-line\",\"config.style.page.header.borderColor\":\"gray-6\",\"config.style.page.header.font\":\"16\",\"config.style.page.header.link.font\":\"small caps underlined\",\"config.style.page.header.link.lineColor\":\"raspberry-4\",\"config.style.page.header.link.active.color\":\"raspberry-4 on raspberry-1\",\"config.style.page.header.link.active.font\":\"small caps underlined\",\"config.style.page.header.link.active.lineColor\":\"raspberry-4\",\"config.style.page.footer.border\":\"thin-line\",\"config.style.page.footer.borderColor\":\"gray-6\",\"config.style.page.footer.font\":\"16\",\"config.style.page.footer.link.font\":\"small caps underlined\",\"config.style.page.footer.link.lineColor\":\"raspberry-4\",\"config.style.page.footer.link.active.color\":\"raspberry-4 on raspberry-1\",\"config.style.page.footer.link.active.font\":\"small caps underlined\",\"config.style.page.footer.link.active.lineColor\":\"raspberry-4\",\"config.style.page.theme.override\":void 0,\"config.style.page.theme.enableSwitching\":!0};function Gs(){re(Zs)}class Js extends z{connectedCallback(){window.addEventListener(\"state-change\",this)}disconnectedCallback(){window.removeEventListener(\"state-change\",this)}handleEvent(e){const{name:t,value:i}=e.detail;if(!t.startsWith(\"config.style.\"))return;const r=`--${t.replace(/^config\\.style\\./,\"\").replace(/\\./g,\"-\")}`;if(typeof i==\"string\"&&r.endsWith(\"-color\")){this.updateColor(r.replace(/-color$/,\"\"),i);return}if(typeof i==\"string\"&&r.endsWith(\"-lineColor\")){this.updateLineColor(r.replace(/-lineColor$/,\"\"),i);return}if(typeof i==\"string\"&&r.endsWith(\"-font\")){this.updateFont(r.replace(/-font$/,\"\"),i);return}switch(r){case\"--backdrop\":case\"--dark-backdrop\":{const{color:s}=me(i);this.style.setProperty(`${r}-color`,s);break}case\"--fontScaling-enabled\":case\"--fontScaling-baseViewportWidth\":case\"--fontScaling-addAtDoubleWidth\":case\"--fontScaling-maximumSize\":this.recalculateFontSizes();break;case\"--page-fork-divider-size\":case\"--dark-page-fork-divider-size\":(typeof i==\"string\"||typeof i==\"number\")&&this.style.setProperty(r,`${i}px`);break;case\"--page-fork-divider-style\":case\"--dark-page-fork-divider-style\":typeof i==\"string\"&&this.style.setProperty(r,i);break;case\"--page-verticalAlign\":case\"--dark-page-verticalAlign\":{if(typeof i!=\"string\")break;const s=r.replace(/-verticalAlign$/,\"\");switch(i){case\"top\":this.style.setProperty(`${s}-current-passage-justify-content`,\"flex-start\");break;case\"center\":this.style.setProperty(`${s}-current-passage-justify-content`,\"center\");break;case\"bottom\":this.style.setProperty(`${s}-current-passage-justify-content`,\"flex-end\");break}break}case\"--page-footer-border\":case\"--page-footer-borderColor\":case\"--page-header-border\":case\"--page-header-borderColor\":case\"--dark-page-footer-border\":case\"--dark-page-footer-borderColor\":case\"--dark-page-header-border\":case\"--dark-page-header-borderColor\":case\"--page-style-border\":case\"--dark-page-style-border\":case\"--page-style-borderColor\":case\"--dark-page-style-borderColor\":{const s=r.replace(/-style-[^-]*?$/,\"\").replace(/-border(Color)?$/,\"\"),a=t.replace(/\\.[^.]*?$/,\"\"),l=p(`${a}.border`),o=p(`${a}.borderColor`);switch(l){case\"none\":this.style.setProperty(`${s}-border`,\"none\"),this.style.setProperty(`${s}-box-shadow`,\"none\");break;case\"shadow\":this.style.setProperty(`${s}-border`,\"none\"),this.style.setProperty(`${s}-box-shadow`,\"inset 0 0 2px 2px hsla(0, 0%, 100%, 0.05), 0 0 0 1px hsla(0, 0%, 0%, 0.05), 0 2px 2px hsla(0, 0%, 0%, 0.05), 0 4px 4px hsla(0, 0%, 0%, 0.05), 0 8px 8px hsla(0, 0%, 0%, 0.05), 0 16px 16px hsla(0, 0%, 0%, 0.05)\");break;case\"thick-line\":this.style.setProperty(`${s}-border`,`4px solid ${me(o).color}`),this.style.setProperty(`${s}-box-shadow`,\"none\");break;case\"thin-line\":this.style.setProperty(`${s}-border`,`1px solid ${me(o).color}`),this.style.setProperty(`${s}-box-shadow`,\"none\");break}}}}recalculateFontSizes(){for(const e of He(!0)){const t=/^config\\.style\\.(.*)\\.font$/.exec(e);if(t){const i=p(e);typeof i==\"string\"&&this.updateFont(`--${t[1].replace(/\\./g,\"-\")}`,i)}}}updateColor(e,t){const{backgroundColor:i,color:r}=me(t);this.style.setProperty(`${e}-background-color`,i),this.style.setProperty(`${e}-color`,r)}updateFont(e,t){const i=p(\"config.style.fontScaling.enabled\"),r={};if(i){const a=p(\"config.style.fontScaling.baseViewportWidth\"),l=p(\"config.style.fontScaling.addAtDoubleWidth\"),o=p(\"config.style.fontScaling.maximumSize\");typeof a==\"number\"&&typeof l==\"number\"&&(r.scaling={baseViewportWidth:a,addAtDoubleWidth:l},typeof o==\"string\"&&(r.scaling.maximumSize=o))}const s=Ws(t,r);this.style.setProperty(`${e}-font-family`,s.fontFamily),this.style.setProperty(`${e}-font-size`,s.fontSize),this.style.setProperty(`${e}-font-style`,s.fontStyle),this.style.setProperty(`${e}-font-variant`,s.fontVariant),this.style.setProperty(`${e}-font-weight`,s.fontWeight),this.style.setProperty(`${e}-text-decoration`,s.textDecoration),this.style.setProperty(`${e}-text-transform`,s.textTransform)}updateLineColor(e,t){const{color:i}=me(t);this.style.setProperty(`${e}-text-decoration-color`,i)}}class Xs extends z{connectedCallback(){window.addEventListener(\"state-change\",this),window.addEventListener(\"system-theme-change\",this),Promise.resolve().then(()=>this.update())}disconnectedCallback(){window.removeEventListener(\"state-change\",this),window.removeEventListener(\"system-theme-change\",this)}update(){p(\"browser.darkTheme\")?this.enable():this.disable()}disable(){this.style.cssText=\"\"}enable(){const e=this.closest(\"state-css-variables\");if(e){this.style.cssText=\"\";for(let t=0;t<e.style.length;t++){const i=/^--dark-(.*)/.exec(e.style.item(t));i!=null&&i[1]&&this.style.setProperty(`--${i[1]}`,`var(--dark-${i[1]})`)}}}handleEvent(e){if(e.type===\"system-theme-change\")this.update();else{const{name:t}=e.detail;([\"config.style.page.theme.enableSwitching\",\"config.style.page.theme.override\"].includes(t)||t.startsWith(\"config.style.dark\"))&&this.update()}}}var J;class Qs extends z{constructor(){super();U(this,\"warnings\");Ct(this,J,void 0);this.warnings=[]}connectedCallback(){window.addEventListener(\"state-change\",this),this.spyOnWarnings(),this.update()}disconnectedCallback(){window.removeEventListener(\"state-change\",this),this.unspyOnWarnings()}handleEvent(t){t.type===\"state-change\"&&t.detail.name===\"trail\"&&(this.warnings=[],this.update())}spyOnWarnings(){_t(this,J,console.warn),console.warn=(...t)=>{this.warnings.push(...t),this.update(),pe(this,J).apply(pe(this,J),t)}}unspyOnWarnings(){pe(this,J)&&(console.warn=pe(this,J))}update(){this.isConnected&&(this.warnings.length>0&&p(\"config.testing\")?(this.removeAttribute(\"hidden\"),this.innerHTML=`<ul>${this.warnings.map(t=>`<li>Warning: ${t}</li>`).join(\"\")}</ul>`):this.setAttribute(\"hidden\",\"\"))}}J=new WeakMap;function Ks(){wt({\"body-content\":js,\"error-handler\":Hs,\"external-fonts\":qs,\"marginal-content\":Fs,\"page-skip\":Bs,\"page-skip-indicator\":Us,\"state-css-variables\":Js,\"state-dark-theme-css-overrides\":Xs,\"warning-list\":Qs})}class fe extends z{constructor(){super(),this.addEventListener(\"keydown\",e=>{(e.key===\" \"||e.key===\"Enter\")&&(e.preventDefault(),this.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0})))})}connectedCallback(){this.setAttribute(\"tabindex\",\"0\"),this.hasAttribute(\"role\")||this.setAttribute(\"role\",\"button\")}}const{warn:Dt}=F(\"inserts\");class Ys extends fe{constructor(){super(),this.addEventListener(\"click\",()=>{const e=this.getAttribute(\"choices\");if(e){let t;try{t=JSON.parse(e)}catch{Dt(`The choices attribute, \"${e}\" couldn't be parsed.`);return}if(!Array.isArray(t)){Dt(\"The choices attribute of this cycling link doesn't deserialize to an array.\");return}let i=t.map(a=>typeof a==\"string\"?a:a.toString()).indexOf((this.textContent??\"\").trim())+1;i===t.length&&(i=0);const r=this.closest(\"body-content, marginal-content\");if(!r)throw new Error(\"Couldn't find suitable parent element to do a cycle link transition on.\");r.changeContent(()=>{this.textContent=t[i].toString()});const s=this.getAttribute(\"set\");s&&$(s,t[i])}})}}class eo extends fe{constructor(){super(),this.addEventListener(\"click\",()=>{const e=this.getAttribute(\"to\"),t=this.closest(\"body-content, marginal-content\");t&&!t.allChildInputsValid()||e&&(this.dispatchEvent(new CustomEvent(\"passage-navigate\",{bubbles:!0})),vn(e))})}connectedCallback(){this.setAttribute(\"role\",\"link\")}}class to extends fe{constructor(){super(),this.addEventListener(\"click\",$n)}}const no={match:/^(no )?ambient\\s+sound/i,render(n,{volume:e}){const t=p(\"sound.ambient\");if(t)for(const r in t)r!==n&&t[r].playing&&$(`sound.ambient.${r}.playing`,!1);if(!n)return;const i=p(`sound.ambient.${n}.description`)??\"\";return e&&$(`sound.ambient.${n}.volume`,e),$(`sound.ambient.${n}.playing`,!0),`<audio>${i}</audio>`}};function vt(n,e){return/^\\w+:\\/\\/\\/?\\w/i.test(n)?N(\"a\",{class:\"link\",href:n},[e??n]):N(\"passage-link\",{class:\"link\",to:n},[e??n])}function io(n){return n.replace(/\\[\\[(.*?)\\]\\]/g,(e,t)=>{let i=t;const r=t.indexOf(\"|\");if(r!==-1)i=t.substring(0,r),t=t.substring(r+1);else{const s=t.indexOf(\"->\");if(s!==-1)i=t.substring(0,s),t=t.substring(s+2);else{const a=t.indexOf(\"<-\");a!==-1&&(i=t.substring(a+2),t=t.substring(0,a))}}return i===\"\"||t===\"\"?e:vt(t,i??t)})}const ro={match:/^back\\s+link/i,render(n,e){const t=p(\"trail\");if(!(!Array.isArray(t)||t.length===0))return vt(t.length>1?t[t.length-2]:t[0],e.label??\"Back\")}},so={match:/^cycling\\s+link(\\s+for)?/i,render(n,{choices:e}){let t=\"\";if(n){const i=p(n);i===void 0?($(n,e[0]),t=e[0].toString()):t=i.toString()}else t=e[0].toString();return N(\"cycling-link\",{class:\"link\",set:n??void 0,choices:JSON.stringify(e)},[t])}},oo={match:/^dropdown menu(\\s+for)?/i,render(n,e){let t;return n&&(t=p(n),t===void 0&&($(n,e.choices[0]),t=e.choices[0])),N(\"variable-binding\",{name:n??void 0},[ke(\"select\",{},e.choices.map(i=>{const r=i.toString(),s={\"data-json-value\":JSON.stringify(i)};return n&&t===i&&(s.selected=\"\"),ke(\"option\",s,[r])}))])}},ao={match:/^embed\\s+flickr(\\s+image)?/i,render(n,e){var t;if(n)return N(\"img\",{...e,src:(t=/img src=\"(.+?)\"/.exec(n))==null?void 0:t[1]})}},lo={match:/^embed\\s+image/i,render(n,e){return N(\"img\",{...e,src:n??\"\"})}},co={match:/^embed\\s+passage(\\s+named)?/i,render(n){if(!n)return\"\";const e=Se(n);return e?$e(e.source):\"\"}},uo={match:/^embed\\s+unsplash(\\s+image)?/i,render(n,e){if(n)return N(\"img\",{...e,src:`https://source.unsplash.com/${n.replace(/.*\\//,\"\")}/${e.width}x${e.height}`})}},fo={match:/^embed\\s+youtube(\\s+video)?/i,render(n,e){if(!n)return;let t=`https://www.youtube-nocookie.com/embed/${n.replace(/.*\\?v=/,\"\")}?modestbranding=1&rel=0&controls=${e.controls?1:0}&`;return e.autoplay&&(t+=\"autoplay=1&\"),e.loop&&(t+=\"loop=1&\"),N(\"div\",{style:\"position: relative; height: 0; padding-bottom: 56.25%; margin-bottom: 1em\"},[ke(\"iframe\",{src:t,frameBorder:\"0\",style:\"position: absolute; top: 0; left: 0; width: 100%; height: 100%\"})])}},ho={match:/^link\\s+to/i,render(n,{label:e}){if(n)return vt(n,e)}},po={match:/^restart\\s+link/i,render(n,{label:e}){return N(\"restart-link\",{class:\"link\"},[e??\"Restart\"])}},go={match:/^reveal\\s+link/i,render(n,e){if(n){if(e.text)return N(\"reveal-link\",{class:\"link\",text:e.text},[n]);if(e.passage)return N(\"reveal-link\",{class:\"link\",passage:e.passage},[n])}}},mo={match:/^sound\\s+effect/i,render(n,{volume:e}){const t=p(`sound.effect.${n}.description`)??\"\";return e&&$(`sound.effect.${n}.volume`,e),$(`sound.effect.${n}.playing`,!0),`<audio>${t}</audio>`}},bo={match:/^text\\s+input(\\s+for)?/i,render(n,e){return N(\"variable-binding\",{name:n??void 0},[ke(\"input\",{type:\"text\",value:n?(p(n)??\"\").toString():\"\",required:e.required!==!1?\"\":void 0})])}},yo={match:/^theme\\s+switcher$/i,render(n,{darkLabel:e,lightLabel:t,prefix:i,suffix:r}){return N(\"theme-switcher\",{prefix:i,suffix:r,class:\"link\",\"dark-label\":e,\"light-label\":t},[])}},zn=[no,ro,so,oo,ao,lo,co,uo,fo,ho,po,go,mo,bo,yo];let ue=[...zn];function Pn(){return ue}function wo(n){ue=[...ue,n]}function ko(n){ue=ue.filter(e=>e!==n)}function xo(){ue=[...zn]}const vo=Object.freeze(Object.defineProperty({__proto__:null,add:wo,all:Pn,remove:ko,reset:xo},Symbol.toStringTag,{value:\"Module\"}));function On(n,e,t={}){const i=`<${e}`+Object.keys(t).reduce((s,a)=>`${s} ${a}=\"${t[a]}\"`,\"\")+\">\";let r=i+n.replace(/[\\r\\n]{2,}/g,`</${e}>$&${i}`)+`</${e}>`;return r=r.replace(/(<span.*?>)\\s*(#+)/gi,\"$2 $1\"),r}const $o={match:/^after\\s/i,process(n,{invocation:e}){const t=ve(e.replace(/^after\\s/i,\"\"),\"ms\");n.text=On(n.text,\"skippable-animation\",{\"skippable-delay\":t.toString(),class:\"fade-in\"})}},So={match:/^align\\s+(left|right|center)/i,process(n,{invocation:e}){const t=e.replace(/^align\\s+/i,\"\");n.text=On(n.text,\"span\",{style:`display: block; text-align: ${t}`})}},Eo={match:/^append$/i,process(n){n.startsNewParagraph=!1}},Co={match:/^if(always|never)?\\s|else$|unless\\s/i,processRaw(n,{invocation:e,state:t}){const i=e.replace(/\\s.*/,\"\").toLowerCase(),r=()=>new Function(\"return \"+e.replace(/.*?\\s/,\"\")).apply(window);switch(i){case\"if\":t.conditionEval=r();break;case\"ifalways\":t.conditionEval=!0;break;case\"ifnever\":t.conditionEval=!1;break;case\"unless\":t.conditionEval=!r();break;case\"else\":if(t.conditionEval===void 0)throw new Error(\"There was no matching if modifier for an else modifier.\");t.conditionEval=!t.conditionEval;break}t.conditionEval||(n.text=\"\")}},_o={match:/^continued?|cont('d)?$/i,process(){}},To={match:/^css$/i,processRaw(n){n.text=`<style>${n.text}</style>`}},Ao={match:/^javascript$/i,processRaw(n){try{const e=new Function(`\n\t\t\t\t\t\tfunction write() { write.__out += write.__join.call(arguments, ''); }\n\t\t\t\t\t\twrite.__out = '';\n\t\t\t\t\t\twrite.__join = Array.prototype.join;\n\t\t\t\t\t\t${Br(n.text)};\n\t\t\t\t\t\treturn write.__out;\n\t\t\t\t\t`);n.text=e.apply(window)}catch(e){if(p(\"config.testing\")){const t=e;let i=\"unknown error\";t.stack?i=t.stack:i=t.message+`\n[No stack trace available]`,n.text=`<div class=\"error\">An error occurred evaluating:<pre>${n.text}</pre><p><pre>${i}</pre></p></div>`}else throw e}}},Lo={match:/^(note(\\s+to\\s+myself)?|n\\.?b\\.?|todo|fixme)$/i,process(n){n.text=\"\"}},In=[$o,So,Eo,Co,_o,To,Ao,Lo];let ne=[...In];function Mn(){return ne}function zo(n){ne=[...ne,n]}function Po(n){ne=ne.filter(e=>e!==n)}function Oo(){ne=[...In]}const Io=Object.freeze(Object.defineProperty({__proto__:null,add:zo,all:Mn,get modifiers(){return ne},remove:Po,reset:Oo},Symbol.toStringTag,{value:\"Module\"})),{log:be,warn:Mo}=F(\"parse\"),No={varsSep:/^--$/m,modifierPattern:/^\\[([^[].+[^\\]])\\]$/gm};function Ro(n,e=No){const t={vars:[],blocks:[]},i=n.split(e.varsSep,2);let r,s;i.length===2?(be(\"Detected vars section\"),[r,s]=i,r.split(/\\r?\\n/).forEach(c=>{if(c.trim()===\"\")return;const d=c.indexOf(\":\");if(d!==-1){const f=c.substring(0,d).trim(),h=c.substring(d+1).trim(),m={name:f,value:new Function(`return (${h})`)},v=f.match(/\\(.+\\)/);if(v){if(!v.index)throw new Error(`A condition was found in \"${f}\", but no index was present in the regular expression match.`);m.condition=new Function(`return !!(${v[0]})`),m.name=m.name.substring(0,v.index).trim(),be(`Setting variable \"${m.name}\" to \"${h}\" with condition (${v[0]})`)}else be(`Setting variable \"${f}\" to \"${h}\" without condition`);t.vars.push(m)}else Mo(`The line \"${c}\" in the vars section is missing a colon. It was ignored.`)})):(be(\"No vars section detected\"),s=i[0]);function a(c,d){const f=d.trim();f!==\"\"&&(be(`Creating '${c}' block with content: \"${f}\"`),t.blocks.push({type:c,content:f}))}const l=new RegExp(e.modifierPattern);let o=0,u=l.exec(s);for(;u;){a(\"text\",s.substring(o,u.index));const c=u[1];let d=\"\";for(let f=0;f<c.length;f++)switch(c[f]){case'\"':for(d+='\"',f=f+1;f<c.length&&(d+=c[f],!(c[f]==='\"'&&c[f-1]!==\"\\\\\"));f++);break;case\";\":a(\"modifier\",d),d=\"\";break;default:d+=c[f]}a(\"modifier\",d),o=l.lastIndex,u=l.exec(s)}return a(\"text\",s.substring(o)),t}function Nn(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:\"\",highlight:null,hooks:null,langPrefix:\"language-\",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let oe=Nn();function Do(n){oe=n}const Rn=/[&<>\"']/,jo=new RegExp(Rn.source,\"g\"),Dn=/[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/,Ho=new RegExp(Dn.source,\"g\"),qo={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\"},jt=n=>qo[n];function I(n,e){if(e){if(Rn.test(n))return n.replace(jo,jt)}else if(Dn.test(n))return n.replace(Ho,jt);return n}const Fo=/&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/ig;function jn(n){return n.replace(Fo,(e,t)=>(t=t.toLowerCase(),t===\"colon\"?\":\":t.charAt(0)===\"#\"?t.charAt(1)===\"x\"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):\"\"))}const Bo=/(^|[^\\[])\\^/g;function E(n,e){n=typeof n==\"string\"?n:n.source,e=e||\"\";const t={replace:(i,r)=>(r=r.source||r,r=r.replace(Bo,\"$1\"),n=n.replace(i,r),t),getRegex:()=>new RegExp(n,e)};return t}const Uo=/[^\\w:]/g,Vo=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function Ht(n,e,t){if(n){let i;try{i=decodeURIComponent(jn(t)).replace(Uo,\"\").toLowerCase()}catch{return null}if(i.indexOf(\"javascript:\")===0||i.indexOf(\"vbscript:\")===0||i.indexOf(\"data:\")===0)return null}e&&!Vo.test(t)&&(t=Jo(e,t));try{t=encodeURI(t).replace(/%25/g,\"%\")}catch{return null}return t}const Te={},Wo=/^[^:]+:\\/*[^/]*$/,Zo=/^([^:]+:)[\\s\\S]*$/,Go=/^([^:]+:\\/*[^/]*)[\\s\\S]*$/;function Jo(n,e){Te[\" \"+n]||(Wo.test(n)?Te[\" \"+n]=n+\"/\":Te[\" \"+n]=ze(n,\"/\",!0)),n=Te[\" \"+n];const t=n.indexOf(\":\")===-1;return e.substring(0,2)===\"//\"?t?e:n.replace(Zo,\"$1\")+e:e.charAt(0)===\"/\"?t?e:n.replace(Go,\"$1\")+e:n+e}const Ie={exec:function(){}};function qt(n,e){const t=n.replace(/\\|/g,(s,a,l)=>{let o=!1,u=a;for(;--u>=0&&l[u]===\"\\\\\";)o=!o;return o?\"|\":\" |\"}),i=t.split(/ \\|/);let r=0;if(i[0].trim()||i.shift(),i.length>0&&!i[i.length-1].trim()&&i.pop(),i.length>e)i.splice(e);else for(;i.length<e;)i.push(\"\");for(;r<i.length;r++)i[r]=i[r].trim().replace(/\\\\\\|/g,\"|\");return i}function ze(n,e,t){const i=n.length;if(i===0)return\"\";let r=0;for(;r<i;){const s=n.charAt(i-r-1);if(s===e&&!t)r++;else if(s!==e&&t)r++;else break}return n.slice(0,i-r)}function Xo(n,e){if(n.indexOf(e[1])===-1)return-1;const t=n.length;let i=0,r=0;for(;r<t;r++)if(n[r]===\"\\\\\")r++;else if(n[r]===e[0])i++;else if(n[r]===e[1]&&(i--,i<0))return r;return-1}function Qo(n){n&&n.sanitize&&!n.silent&&console.warn(\"marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options\")}function Ft(n,e){if(e<1)return\"\";let t=\"\";for(;e>1;)e&1&&(t+=n),e>>=1,n+=n;return t+n}function Bt(n,e,t,i){const r=e.href,s=e.title?I(e.title):null,a=n[1].replace(/\\\\([\\[\\]])/g,\"$1\");if(n[0].charAt(0)!==\"!\"){i.state.inLink=!0;const l={type:\"link\",raw:t,href:r,title:s,text:a,tokens:i.inlineTokens(a)};return i.state.inLink=!1,l}return{type:\"image\",raw:t,href:r,title:s,text:I(a)}}function Ko(n,e){const t=n.match(/^(\\s+)(?:```)/);if(t===null)return e;const i=t[1];return e.split(`\n`).map(r=>{const s=r.match(/^\\s+/);if(s===null)return r;const[a]=s;return a.length>=i.length?r.slice(i.length):r}).join(`\n`)}class $t{constructor(e){this.options=e||oe}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:\"space\",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const i=t[0].replace(/^ {1,4}/gm,\"\");return{type:\"code\",raw:t[0],codeBlockStyle:\"indented\",text:this.options.pedantic?i:ze(i,`\n`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const i=t[0],r=Ko(i,t[3]||\"\");return{type:\"code\",raw:i,lang:t[2]?t[2].trim().replace(this.rules.inline._escapes,\"$1\"):t[2],text:r}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let i=t[2].trim();if(/#$/.test(i)){const r=ze(i,\"#\");(this.options.pedantic||!r||/ $/.test(r))&&(i=r.trim())}return{type:\"heading\",raw:t[0],depth:t[1].length,text:i,tokens:this.lexer.inline(i)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:\"hr\",raw:t[0]}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){const i=t[0].replace(/^ *>[ \\t]?/gm,\"\"),r=this.lexer.state.top;this.lexer.state.top=!0;const s=this.lexer.blockTokens(i);return this.lexer.state.top=r,{type:\"blockquote\",raw:t[0],tokens:s,text:i}}}list(e){let t=this.rules.block.list.exec(e);if(t){let i,r,s,a,l,o,u,c,d,f,h,m,v=t[1].trim();const O=v.length>1,x={type:\"list\",raw:\"\",ordered:O,start:O?+v.slice(0,-1):\"\",loose:!1,items:[]};v=O?`\\\\d{1,9}\\\\${v.slice(-1)}`:`\\\\${v}`,this.options.pedantic&&(v=O?v:\"[*+-]\");const A=new RegExp(`^( {0,3}${v})((?:[\t ][^\\\\n]*)?(?:\\\\n|$))`);for(;e&&(m=!1,!(!(t=A.exec(e))||this.rules.block.hr.test(e)));){if(i=t[0],e=e.substring(i.length),c=t[2].split(`\n`,1)[0].replace(/^\\t+/,w=>\" \".repeat(3*w.length)),d=e.split(`\n`,1)[0],this.options.pedantic?(a=2,h=c.trimLeft()):(a=t[2].search(/[^ ]/),a=a>4?1:a,h=c.slice(a),a+=t[1].length),o=!1,!c&&/^ *$/.test(d)&&(i+=d+`\n`,e=e.substring(d.length+1),m=!0),!m){const w=new RegExp(`^ {0,${Math.min(3,a-1)}}(?:[*+-]|\\\\d{1,9}[.)])((?:[ \t][^\\\\n]*)?(?:\\\\n|$))`),k=new RegExp(`^ {0,${Math.min(3,a-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$)`),_=new RegExp(`^ {0,${Math.min(3,a-1)}}(?:\\`\\`\\`|~~~)`),T=new RegExp(`^ {0,${Math.min(3,a-1)}}#`);for(;e&&(f=e.split(`\n`,1)[0],d=f,this.options.pedantic&&(d=d.replace(/^ {1,4}(?=( {4})*[^ ])/g,\"  \")),!(_.test(d)||T.test(d)||w.test(d)||k.test(e)));){if(d.search(/[^ ]/)>=a||!d.trim())h+=`\n`+d.slice(a);else{if(o||c.search(/[^ ]/)>=4||_.test(c)||T.test(c)||k.test(c))break;h+=`\n`+d}!o&&!d.trim()&&(o=!0),i+=f+`\n`,e=e.substring(f.length+1),c=d.slice(a)}}x.loose||(u?x.loose=!0:/\\n *\\n *$/.test(i)&&(u=!0)),this.options.gfm&&(r=/^\\[[ xX]\\] /.exec(h),r&&(s=r[0]!==\"[ ] \",h=h.replace(/^\\[[ xX]\\] +/,\"\"))),x.items.push({type:\"list_item\",raw:i,task:!!r,checked:s,loose:!1,text:h}),x.raw+=i}x.items[x.items.length-1].raw=i.trimRight(),x.items[x.items.length-1].text=h.trimRight(),x.raw=x.raw.trimRight();const R=x.items.length;for(l=0;l<R;l++)if(this.lexer.state.top=!1,x.items[l].tokens=this.lexer.blockTokens(x.items[l].text,[]),!x.loose){const w=x.items[l].tokens.filter(_=>_.type===\"space\"),k=w.length>0&&w.some(_=>/\\n.*\\n/.test(_.raw));x.loose=k}if(x.loose)for(l=0;l<R;l++)x.items[l].loose=!0;return x}}html(e){const t=this.rules.block.html.exec(e);if(t){const i={type:\"html\",raw:t[0],pre:!this.options.sanitizer&&(t[1]===\"pre\"||t[1]===\"script\"||t[1]===\"style\"),text:t[0]};if(this.options.sanitize){const r=this.options.sanitizer?this.options.sanitizer(t[0]):I(t[0]);i.type=\"paragraph\",i.text=r,i.tokens=this.lexer.inline(r)}return i}}def(e){const t=this.rules.block.def.exec(e);if(t){const i=t[1].toLowerCase().replace(/\\s+/g,\" \"),r=t[2]?t[2].replace(/^<(.*)>$/,\"$1\").replace(this.rules.inline._escapes,\"$1\"):\"\",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline._escapes,\"$1\"):t[3];return{type:\"def\",tag:i,raw:t[0],href:r,title:s}}}table(e){const t=this.rules.block.table.exec(e);if(t){const i={type:\"table\",header:qt(t[1]).map(r=>({text:r})),align:t[2].replace(/^ *|\\| *$/g,\"\").split(/ *\\| */),rows:t[3]&&t[3].trim()?t[3].replace(/\\n[ \\t]*$/,\"\").split(`\n`):[]};if(i.header.length===i.align.length){i.raw=t[0];let r=i.align.length,s,a,l,o;for(s=0;s<r;s++)/^ *-+: *$/.test(i.align[s])?i.align[s]=\"right\":/^ *:-+: *$/.test(i.align[s])?i.align[s]=\"center\":/^ *:-+ *$/.test(i.align[s])?i.align[s]=\"left\":i.align[s]=null;for(r=i.rows.length,s=0;s<r;s++)i.rows[s]=qt(i.rows[s],i.header.length).map(u=>({text:u}));for(r=i.header.length,a=0;a<r;a++)i.header[a].tokens=this.lexer.inline(i.header[a].text);for(r=i.rows.length,a=0;a<r;a++)for(o=i.rows[a],l=0;l<o.length;l++)o[l].tokens=this.lexer.inline(o[l].text);return i}}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:\"heading\",raw:t[0],depth:t[2].charAt(0)===\"=\"?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const i=t[1].charAt(t[1].length-1)===`\n`?t[1].slice(0,-1):t[1];return{type:\"paragraph\",raw:t[0],text:i,tokens:this.lexer.inline(i)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:\"text\",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:\"escape\",raw:t[0],text:I(t[1])}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&/^<a /i.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\\/a>/i.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\\s|>)/i.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\\/(pre|code|kbd|script)(\\s|>)/i.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?\"text\":\"html\",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(t[0]):I(t[0]):t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const i=t[2].trim();if(!this.options.pedantic&&/^</.test(i)){if(!/>$/.test(i))return;const a=ze(i.slice(0,-1),\"\\\\\");if((i.length-a.length)%2===0)return}else{const a=Xo(t[2],\"()\");if(a>-1){const o=(t[0].indexOf(\"!\")===0?5:4)+t[1].length+a;t[2]=t[2].substring(0,a),t[0]=t[0].substring(0,o).trim(),t[3]=\"\"}}let r=t[2],s=\"\";if(this.options.pedantic){const a=/^([^'\"]*[^\\s])\\s+(['\"])(.*)\\2/.exec(r);a&&(r=a[1],s=a[3])}else s=t[3]?t[3].slice(1,-1):\"\";return r=r.trim(),/^</.test(r)&&(this.options.pedantic&&!/>$/.test(i)?r=r.slice(1):r=r.slice(1,-1)),Bt(t,{href:r&&r.replace(this.rules.inline._escapes,\"$1\"),title:s&&s.replace(this.rules.inline._escapes,\"$1\")},t[0],this.lexer)}}reflink(e,t){let i;if((i=this.rules.inline.reflink.exec(e))||(i=this.rules.inline.nolink.exec(e))){let r=(i[2]||i[1]).replace(/\\s+/g,\" \");if(r=t[r.toLowerCase()],!r){const s=i[0].charAt(0);return{type:\"text\",raw:s,text:s}}return Bt(i,r,i[0],this.lexer)}}emStrong(e,t,i=\"\"){let r=this.rules.inline.emStrong.lDelim.exec(e);if(!r||r[3]&&i.match(/[\\p{L}\\p{N}]/u))return;const s=r[1]||r[2]||\"\";if(!s||s&&(i===\"\"||this.rules.inline.punctuation.exec(i))){const a=r[0].length-1;let l,o,u=a,c=0;const d=r[0][0]===\"*\"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(d.lastIndex=0,t=t.slice(-1*e.length+a);(r=d.exec(t))!=null;){if(l=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!l)continue;if(o=l.length,r[3]||r[4]){u+=o;continue}else if((r[5]||r[6])&&a%3&&!((a+o)%3)){c+=o;continue}if(u-=o,u>0)continue;o=Math.min(o,o+u+c);const f=e.slice(0,a+r.index+(r[0].length-l.length)+o);if(Math.min(a,o)%2){const m=f.slice(1,-1);return{type:\"em\",raw:f,text:m,tokens:this.lexer.inlineTokens(m)}}const h=f.slice(2,-2);return{type:\"strong\",raw:f,text:h,tokens:this.lexer.inlineTokens(h)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let i=t[2].replace(/\\n/g,\" \");const r=/[^ ]/.test(i),s=/^ /.test(i)&&/ $/.test(i);return r&&s&&(i=i.substring(1,i.length-1)),i=I(i,!0),{type:\"codespan\",raw:t[0],text:i}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:\"br\",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:\"del\",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e,t){const i=this.rules.inline.autolink.exec(e);if(i){let r,s;return i[2]===\"@\"?(r=I(this.options.mangle?t(i[1]):i[1]),s=\"mailto:\"+r):(r=I(i[1]),s=r),{type:\"link\",raw:i[0],text:r,href:s,tokens:[{type:\"text\",raw:r,text:r}]}}}url(e,t){let i;if(i=this.rules.inline.url.exec(e)){let r,s;if(i[2]===\"@\")r=I(this.options.mangle?t(i[0]):i[0]),s=\"mailto:\"+r;else{let a;do a=i[0],i[0]=this.rules.inline._backpedal.exec(i[0])[0];while(a!==i[0]);r=I(i[0]),i[1]===\"www.\"?s=\"http://\"+i[0]:s=i[0]}return{type:\"link\",raw:i[0],text:r,href:s,tokens:[{type:\"text\",raw:r,text:r}]}}}inlineText(e,t){const i=this.rules.inline.text.exec(e);if(i){let r;return this.lexer.state.inRawBlock?r=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(i[0]):I(i[0]):i[0]:r=I(this.options.smartypants?t(i[0]):i[0]),{type:\"text\",raw:i[0],text:r}}}}const y={newline:/^(?: *(?:\\n|$))+/,code:/^( {4}[^\\n]+(?:\\n(?: *(?:\\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\\n]*(?:\\n|$))|~{3,})([^\\n]*)(?:\\n|$)(?:|([\\s\\S]*?)(?:\\n|$))(?: {0,3}\\1[~`]* *(?=\\n|$)|$)/,hr:/^ {0,3}((?:-[\\t ]*){3,}|(?:_[ \\t]*){3,}|(?:\\*[ \\t]*){3,})(?:\\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\\s|$)(.*)(?:\\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\\n]*)(?:\\n|$))+/,list:/^( {0,3}bull)([ \\t][^\\n]+?)?(?:\\n|$)/,html:\"^ {0,3}(?:<(script|pre|style|textarea)[\\\\s>][\\\\s\\\\S]*?(?:</\\\\1>[^\\\\n]*\\\\n+|$)|comment[^\\\\n]*(\\\\n+|$)|<\\\\?[\\\\s\\\\S]*?(?:\\\\?>\\\\n*|$)|<![A-Z][\\\\s\\\\S]*?(?:>\\\\n*|$)|<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?(?:\\\\]\\\\]>\\\\n*|$)|</?(tag)(?: +|\\\\n|/?>)[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$)|<(?!script|pre|style|textarea)([a-z][\\\\w-]*)(?:attribute)*? */?>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$)|</(?!script|pre|style|textarea)[a-z][\\\\w-]*\\\\s*>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$))\",def:/^ {0,3}\\[(label)\\]: *(?:\\n *)?([^<\\s][^\\s]*|<.*?>)(?:(?: +(?:\\n *)?| *\\n *)(title))? *(?:\\n+|$)/,table:Ie,lheading:/^((?:.|\\n(?!\\n))+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,_paragraph:/^([^\\n]+(?:\\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\\n)[^\\n]+)*)/,text:/^[^\\n]+/};y._label=/(?!\\s*\\])(?:\\\\.|[^\\[\\]\\\\])+/;y._title=/(?:\"(?:\\\\\"?|[^\"\\\\])*\"|'[^'\\n]*(?:\\n[^'\\n]+)*\\n?'|\\([^()]*\\))/;y.def=E(y.def).replace(\"label\",y._label).replace(\"title\",y._title).getRegex();y.bullet=/(?:[*+-]|\\d{1,9}[.)])/;y.listItemStart=E(/^( *)(bull) */).replace(\"bull\",y.bullet).getRegex();y.list=E(y.list).replace(/bull/g,y.bullet).replace(\"hr\",\"\\\\n+(?=\\\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$))\").replace(\"def\",\"\\\\n+(?=\"+y.def.source+\")\").getRegex();y._tag=\"address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul\";y._comment=/<!--(?!-?>)[\\s\\S]*?(?:-->|$)/;y.html=E(y.html,\"i\").replace(\"comment\",y._comment).replace(\"tag\",y._tag).replace(\"attribute\",/ +[a-zA-Z:_][\\w.:-]*(?: *= *\"[^\"\\n]*\"| *= *'[^'\\n]*'| *= *[^\\s\"'=<>`]+)?/).getRegex();y.paragraph=E(y._paragraph).replace(\"hr\",y.hr).replace(\"heading\",\" {0,3}#{1,6} \").replace(\"|lheading\",\"\").replace(\"|table\",\"\").replace(\"blockquote\",\" {0,3}>\").replace(\"fences\",\" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\",\" {0,3}(?:[*+-]|1[.)]) \").replace(\"html\",\"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)\").replace(\"tag\",y._tag).getRegex();y.blockquote=E(y.blockquote).replace(\"paragraph\",y.paragraph).getRegex();y.normal={...y};y.gfm={...y.normal,table:\"^ *([^\\\\n ].*\\\\|.*)\\\\n {0,3}(?:\\\\| *)?(:?-+:? *(?:\\\\| *:?-+:? *)*)(?:\\\\| *)?(?:\\\\n((?:(?! *\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)\"};y.gfm.table=E(y.gfm.table).replace(\"hr\",y.hr).replace(\"heading\",\" {0,3}#{1,6} \").replace(\"blockquote\",\" {0,3}>\").replace(\"code\",\" {4}[^\\\\n]\").replace(\"fences\",\" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\",\" {0,3}(?:[*+-]|1[.)]) \").replace(\"html\",\"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)\").replace(\"tag\",y._tag).getRegex();y.gfm.paragraph=E(y._paragraph).replace(\"hr\",y.hr).replace(\"heading\",\" {0,3}#{1,6} \").replace(\"|lheading\",\"\").replace(\"table\",y.gfm.table).replace(\"blockquote\",\" {0,3}>\").replace(\"fences\",\" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\",\" {0,3}(?:[*+-]|1[.)]) \").replace(\"html\",\"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)\").replace(\"tag\",y._tag).getRegex();y.pedantic={...y.normal,html:E(`^ *(?:comment *(?:\\\\n|\\\\s*$)|<(tag)[\\\\s\\\\S]+?</\\\\1> *(?:\\\\n{2,}|\\\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\\\s[^'\"/>\\\\s]*)*?/?> *(?:\\\\n{2,}|\\\\s*$))`).replace(\"comment\",y._comment).replace(/tag/g,\"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\\\b)\\\\w+(?!:|[^\\\\w\\\\s@]*@)\\\\b\").getRegex(),def:/^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +([\"(][^\\n]+[\")]))? *(?:\\n+|$)/,heading:/^(#{1,6})(.*)(?:\\n+|$)/,fences:Ie,lheading:/^(.+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,paragraph:E(y.normal._paragraph).replace(\"hr\",y.hr).replace(\"heading\",` *#{1,6} *[^\n]`).replace(\"lheading\",y.lheading).replace(\"blockquote\",\" {0,3}>\").replace(\"|fences\",\"\").replace(\"|list\",\"\").replace(\"|html\",\"\").getRegex()};const g={escape:/^\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/,autolink:/^<(scheme:[^\\s\\x00-\\x1f<>]*|email)>/,url:Ie,tag:\"^comment|^</[a-zA-Z][\\\\w:-]*\\\\s*>|^<[a-zA-Z][\\\\w-]*(?:attribute)*?\\\\s*/?>|^<\\\\?[\\\\s\\\\S]*?\\\\?>|^<![a-zA-Z]+\\\\s[\\\\s\\\\S]*?>|^<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>\",link:/^!?\\[(label)\\]\\(\\s*(href)(?:\\s+(title))?\\s*\\)/,reflink:/^!?\\[(label)\\]\\[(ref)\\]/,nolink:/^!?\\[(ref)\\](?:\\[\\])?/,reflinkSearch:\"reflink|nolink(?!\\\\()\",emStrong:{lDelim:/^(?:\\*+(?:([punct_])|[^\\s*]))|^_+(?:([punct*])|([^\\s_]))/,rDelimAst:/^(?:[^_*\\\\]|\\\\.)*?\\_\\_(?:[^_*\\\\]|\\\\.)*?\\*(?:[^_*\\\\]|\\\\.)*?(?=\\_\\_)|(?:[^*\\\\]|\\\\.)+(?=[^*])|[punct_](\\*+)(?=[\\s]|$)|(?:[^punct*_\\s\\\\]|\\\\.)(\\*+)(?=[punct_\\s]|$)|[punct_\\s](\\*+)(?=[^punct*_\\s])|[\\s](\\*+)(?=[punct_])|[punct_](\\*+)(?=[punct_])|(?:[^punct*_\\s\\\\]|\\\\.)(\\*+)(?=[^punct*_\\s])/,rDelimUnd:/^(?:[^_*\\\\]|\\\\.)*?\\*\\*(?:[^_*\\\\]|\\\\.)*?\\_(?:[^_*\\\\]|\\\\.)*?(?=\\*\\*)|(?:[^_\\\\]|\\\\.)+(?=[^_])|[punct*](\\_+)(?=[\\s]|$)|(?:[^punct*_\\s\\\\]|\\\\.)(\\_+)(?=[punct*\\s]|$)|[punct*\\s](\\_+)(?=[^punct*_\\s])|[\\s](\\_+)(?=[punct*])|[punct*](\\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\\s\\S]*?[^`])\\1(?!`)/,br:/^( {2,}|\\\\)\\n(?!\\s*$)/,del:Ie,text:/^(`+|[^`])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*_]|\\b_|$)|[^ ](?= {2,}\\n)))/,punctuation:/^([\\spunctuation])/};g._punctuation=\"!\\\"#$%&'()+\\\\-.,/:;<=>?@\\\\[\\\\]`^{|}~\";g.punctuation=E(g.punctuation).replace(/punctuation/g,g._punctuation).getRegex();g.blockSkip=/\\[[^\\]]*?\\]\\([^\\)]*?\\)|`[^`]*?`|<[^>]*?>/g;g.escapedEmSt=/(?:^|[^\\\\])(?:\\\\\\\\)*\\\\[*_]/g;g._comment=E(y._comment).replace(\"(?:-->|$)\",\"-->\").getRegex();g.emStrong.lDelim=E(g.emStrong.lDelim).replace(/punct/g,g._punctuation).getRegex();g.emStrong.rDelimAst=E(g.emStrong.rDelimAst,\"g\").replace(/punct/g,g._punctuation).getRegex();g.emStrong.rDelimUnd=E(g.emStrong.rDelimUnd,\"g\").replace(/punct/g,g._punctuation).getRegex();g._escapes=/\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/g;g._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;g._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;g.autolink=E(g.autolink).replace(\"scheme\",g._scheme).replace(\"email\",g._email).getRegex();g._attribute=/\\s+[a-zA-Z:_][\\w.:-]*(?:\\s*=\\s*\"[^\"]*\"|\\s*=\\s*'[^']*'|\\s*=\\s*[^\\s\"'=<>`]+)?/;g.tag=E(g.tag).replace(\"comment\",g._comment).replace(\"attribute\",g._attribute).getRegex();g._label=/(?:\\[(?:\\\\.|[^\\[\\]\\\\])*\\]|\\\\.|`[^`]*`|[^\\[\\]\\\\`])*?/;g._href=/<(?:\\\\.|[^\\n<>\\\\])+>|[^\\s\\x00-\\x1f]*/;g._title=/\"(?:\\\\\"?|[^\"\\\\])*\"|'(?:\\\\'?|[^'\\\\])*'|\\((?:\\\\\\)?|[^)\\\\])*\\)/;g.link=E(g.link).replace(\"label\",g._label).replace(\"href\",g._href).replace(\"title\",g._title).getRegex();g.reflink=E(g.reflink).replace(\"label\",g._label).replace(\"ref\",y._label).getRegex();g.nolink=E(g.nolink).replace(\"ref\",y._label).getRegex();g.reflinkSearch=E(g.reflinkSearch,\"g\").replace(\"reflink\",g.reflink).replace(\"nolink\",g.nolink).getRegex();g.normal={...g};g.pedantic={...g.normal,strong:{start:/^__|\\*\\*/,middle:/^__(?=\\S)([\\s\\S]*?\\S)__(?!_)|^\\*\\*(?=\\S)([\\s\\S]*?\\S)\\*\\*(?!\\*)/,endAst:/\\*\\*(?!\\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\\*/,middle:/^()\\*(?=\\S)([\\s\\S]*?\\S)\\*(?!\\*)|^_(?=\\S)([\\s\\S]*?\\S)_(?!_)/,endAst:/\\*(?!\\*)/g,endUnd:/_(?!_)/g},link:E(/^!?\\[(label)\\]\\((.*?)\\)/).replace(\"label\",g._label).getRegex(),reflink:E(/^!?\\[(label)\\]\\s*\\[([^\\]]*)\\]/).replace(\"label\",g._label).getRegex()};g.gfm={...g.normal,escape:E(g.escape).replace(\"])\",\"~|])\").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\\/\\/|www\\.)(?:[a-zA-Z0-9\\-]+\\.?)+[^\\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'\"~()&]+|\\([^)]*\\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'\"~)]+(?!$))+/,del:/^(~~?)(?=[^\\s~])([\\s\\S]*?[^\\s~])\\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\\n)|(?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*~_]|\\b_|https?:\\/\\/|ftp:\\/\\/|www\\.|$)|[^ ](?= {2,}\\n)|[^a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-](?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)))/};g.gfm.url=E(g.gfm.url,\"i\").replace(\"email\",g.gfm._extended_email).getRegex();g.breaks={...g.gfm,br:E(g.br).replace(\"{2,}\",\"*\").getRegex(),text:E(g.gfm.text).replace(\"\\\\b_\",\"\\\\b_| {2,}\\\\n\").replace(/\\{2,\\}/g,\"*\").getRegex()};function Yo(n){return n.replace(/---/g,\"—\").replace(/--/g,\"–\").replace(/(^|[-\\u2014/(\\[{\"\\s])'/g,\"$1‘\").replace(/'/g,\"’\").replace(/(^|[-\\u2014/(\\[{\\u2018\\s])\"/g,\"$1“\").replace(/\"/g,\"”\").replace(/\\.{3}/g,\"…\")}function Ut(n){let e=\"\",t,i;const r=n.length;for(t=0;t<r;t++)i=n.charCodeAt(t),Math.random()>.5&&(i=\"x\"+i.toString(16)),e+=\"&#\"+i+\";\";return e}class K{constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||oe,this.options.tokenizer=this.options.tokenizer||new $t,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={block:y.normal,inline:g.normal};this.options.pedantic?(t.block=y.pedantic,t.inline=g.pedantic):this.options.gfm&&(t.block=y.gfm,this.options.breaks?t.inline=g.breaks:t.inline=g.gfm),this.tokenizer.rules=t}static get rules(){return{block:y,inline:g}}static lex(e,t){return new K(t).lex(e)}static lexInline(e,t){return new K(t).inlineTokens(e)}lex(e){e=e.replace(/\\r\\n|\\r/g,`\n`),this.blockTokens(e,this.tokens);let t;for(;t=this.inlineQueue.shift();)this.inlineTokens(t.src,t.tokens);return this.tokens}blockTokens(e,t=[]){this.options.pedantic?e=e.replace(/\\t/g,\"    \").replace(/^ +$/gm,\"\"):e=e.replace(/^( *)(\\t+)/gm,(l,o,u)=>o+\"    \".repeat(u.length));let i,r,s,a;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(l=>(i=l.call({lexer:this},e,t))?(e=e.substring(i.raw.length),t.push(i),!0):!1))){if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length),i.raw.length===1&&t.length>0?t[t.length-1].raw+=`\n`:t.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length),r=t[t.length-1],r&&(r.type===\"paragraph\"||r.type===\"text\")?(r.raw+=`\n`+i.raw,r.text+=`\n`+i.text,this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length),r=t[t.length-1],r&&(r.type===\"paragraph\"||r.type===\"text\")?(r.raw+=`\n`+i.raw,r.text+=`\n`+i.raw,this.inlineQueue[this.inlineQueue.length-1].src=r.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title});continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(s=e,this.options.extensions&&this.options.extensions.startBlock){let l=1/0;const o=e.slice(1);let u;this.options.extensions.startBlock.forEach(function(c){u=c.call({lexer:this},o),typeof u==\"number\"&&u>=0&&(l=Math.min(l,u))}),l<1/0&&l>=0&&(s=e.substring(0,l+1))}if(this.state.top&&(i=this.tokenizer.paragraph(s))){r=t[t.length-1],a&&r.type===\"paragraph\"?(r.raw+=`\n`+i.raw,r.text+=`\n`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(i),a=s.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length),r=t[t.length-1],r&&r.type===\"text\"?(r.raw+=`\n`+i.raw,r.text+=`\n`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):t.push(i);continue}if(e){const l=\"Infinite loop on byte: \"+e.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let i,r,s,a=e,l,o,u;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(l=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)c.includes(l[0].slice(l[0].lastIndexOf(\"[\")+1,-1))&&(a=a.slice(0,l.index)+\"[\"+Ft(\"a\",l[0].length-2)+\"]\"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(l=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)a=a.slice(0,l.index)+\"[\"+Ft(\"a\",l[0].length-2)+\"]\"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(l=this.tokenizer.rules.inline.escapedEmSt.exec(a))!=null;)a=a.slice(0,l.index+l[0].length-2)+\"++\"+a.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;e;)if(o||(u=\"\"),o=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(c=>(i=c.call({lexer:this},e,t))?(e=e.substring(i.raw.length),t.push(i),!0):!1))){if(i=this.tokenizer.escape(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.tag(e)){e=e.substring(i.raw.length),r=t[t.length-1],r&&i.type===\"text\"&&r.type===\"text\"?(r.raw+=i.raw,r.text+=i.text):t.push(i);continue}if(i=this.tokenizer.link(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(i.raw.length),r=t[t.length-1],r&&i.type===\"text\"&&r.type===\"text\"?(r.raw+=i.raw,r.text+=i.text):t.push(i);continue}if(i=this.tokenizer.emStrong(e,a,u)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.codespan(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.br(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.del(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.autolink(e,Ut)){e=e.substring(i.raw.length),t.push(i);continue}if(!this.state.inLink&&(i=this.tokenizer.url(e,Ut))){e=e.substring(i.raw.length),t.push(i);continue}if(s=e,this.options.extensions&&this.options.extensions.startInline){let c=1/0;const d=e.slice(1);let f;this.options.extensions.startInline.forEach(function(h){f=h.call({lexer:this},d),typeof f==\"number\"&&f>=0&&(c=Math.min(c,f))}),c<1/0&&c>=0&&(s=e.substring(0,c+1))}if(i=this.tokenizer.inlineText(s,Yo)){e=e.substring(i.raw.length),i.raw.slice(-1)!==\"_\"&&(u=i.raw.slice(-1)),o=!0,r=t[t.length-1],r&&r.type===\"text\"?(r.raw+=i.raw,r.text+=i.text):t.push(i);continue}if(e){const c=\"Infinite loop on byte: \"+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return t}}class qe{constructor(e){this.options=e||oe}code(e,t,i){const r=(t||\"\").match(/\\S*/)[0];if(this.options.highlight){const s=this.options.highlight(e,r);s!=null&&s!==e&&(i=!0,e=s)}return e=e.replace(/\\n$/,\"\")+`\n`,r?'<pre><code class=\"'+this.options.langPrefix+I(r)+'\">'+(i?e:I(e,!0))+`</code></pre>\n`:\"<pre><code>\"+(i?e:I(e,!0))+`</code></pre>\n`}blockquote(e){return`<blockquote>\n${e}</blockquote>\n`}html(e){return e}heading(e,t,i,r){if(this.options.headerIds){const s=this.options.headerPrefix+r.slug(i);return`<h${t} id=\"${s}\">${e}</h${t}>\n`}return`<h${t}>${e}</h${t}>\n`}hr(){return this.options.xhtml?`<hr/>\n`:`<hr>\n`}list(e,t,i){const r=t?\"ol\":\"ul\",s=t&&i!==1?' start=\"'+i+'\"':\"\";return\"<\"+r+s+`>\n`+e+\"</\"+r+`>\n`}listitem(e){return`<li>${e}</li>\n`}checkbox(e){return\"<input \"+(e?'checked=\"\" ':\"\")+'disabled=\"\" type=\"checkbox\"'+(this.options.xhtml?\" /\":\"\")+\"> \"}paragraph(e){return`<p>${e}</p>\n`}table(e,t){return t&&(t=`<tbody>${t}</tbody>`),`<table>\n<thead>\n`+e+`</thead>\n`+t+`</table>\n`}tablerow(e){return`<tr>\n${e}</tr>\n`}tablecell(e,t){const i=t.header?\"th\":\"td\";return(t.align?`<${i} align=\"${t.align}\">`:`<${i}>`)+e+`</${i}>\n`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?\"<br/>\":\"<br>\"}del(e){return`<del>${e}</del>`}link(e,t,i){if(e=Ht(this.options.sanitize,this.options.baseUrl,e),e===null)return i;let r='<a href=\"'+e+'\"';return t&&(r+=' title=\"'+t+'\"'),r+=\">\"+i+\"</a>\",r}image(e,t,i){if(e=Ht(this.options.sanitize,this.options.baseUrl,e),e===null)return i;let r=`<img src=\"${e}\" alt=\"${i}\"`;return t&&(r+=` title=\"${t}\"`),r+=this.options.xhtml?\"/>\":\">\",r}text(e){return e}}class Hn{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,t,i){return\"\"+i}image(e,t,i){return\"\"+i}br(){return\"\"}}class qn{constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\\/a-z].*?>/ig,\"\").replace(/[\\u2000-\\u206F\\u2E00-\\u2E7F\\\\'!\"#$%&()*+,./:;<=>?@[\\]^`{|}~]/g,\"\").replace(/\\s/g,\"-\")}getNextSafeSlug(e,t){let i=e,r=0;if(this.seen.hasOwnProperty(i)){r=this.seen[e];do r++,i=e+\"-\"+r;while(this.seen.hasOwnProperty(i))}return t||(this.seen[e]=r,this.seen[i]=0),i}slug(e,t={}){const i=this.serialize(e);return this.getNextSafeSlug(i,t.dryrun)}}class Y{constructor(e){this.options=e||oe,this.options.renderer=this.options.renderer||new qe,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Hn,this.slugger=new qn}static parse(e,t){return new Y(t).parse(e)}static parseInline(e,t){return new Y(t).parseInline(e)}parse(e,t=!0){let i=\"\",r,s,a,l,o,u,c,d,f,h,m,v,O,x,A,R,w,k,_;const T=e.length;for(r=0;r<T;r++){if(h=e[r],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[h.type]&&(_=this.options.extensions.renderers[h.type].call({parser:this},h),_!==!1||![\"space\",\"hr\",\"heading\",\"code\",\"table\",\"blockquote\",\"list\",\"html\",\"paragraph\",\"text\"].includes(h.type))){i+=_||\"\";continue}switch(h.type){case\"space\":continue;case\"hr\":{i+=this.renderer.hr();continue}case\"heading\":{i+=this.renderer.heading(this.parseInline(h.tokens),h.depth,jn(this.parseInline(h.tokens,this.textRenderer)),this.slugger);continue}case\"code\":{i+=this.renderer.code(h.text,h.lang,h.escaped);continue}case\"table\":{for(d=\"\",c=\"\",l=h.header.length,s=0;s<l;s++)c+=this.renderer.tablecell(this.parseInline(h.header[s].tokens),{header:!0,align:h.align[s]});for(d+=this.renderer.tablerow(c),f=\"\",l=h.rows.length,s=0;s<l;s++){for(u=h.rows[s],c=\"\",o=u.length,a=0;a<o;a++)c+=this.renderer.tablecell(this.parseInline(u[a].tokens),{header:!1,align:h.align[a]});f+=this.renderer.tablerow(c)}i+=this.renderer.table(d,f);continue}case\"blockquote\":{f=this.parse(h.tokens),i+=this.renderer.blockquote(f);continue}case\"list\":{for(m=h.ordered,v=h.start,O=h.loose,l=h.items.length,f=\"\",s=0;s<l;s++)A=h.items[s],R=A.checked,w=A.task,x=\"\",A.task&&(k=this.renderer.checkbox(R),O?A.tokens.length>0&&A.tokens[0].type===\"paragraph\"?(A.tokens[0].text=k+\" \"+A.tokens[0].text,A.tokens[0].tokens&&A.tokens[0].tokens.length>0&&A.tokens[0].tokens[0].type===\"text\"&&(A.tokens[0].tokens[0].text=k+\" \"+A.tokens[0].tokens[0].text)):A.tokens.unshift({type:\"text\",text:k}):x+=k),x+=this.parse(A.tokens,O),f+=this.renderer.listitem(x,w,R);i+=this.renderer.list(f,m,v);continue}case\"html\":{i+=this.renderer.html(h.text);continue}case\"paragraph\":{i+=this.renderer.paragraph(this.parseInline(h.tokens));continue}case\"text\":{for(f=h.tokens?this.parseInline(h.tokens):h.text;r+1<T&&e[r+1].type===\"text\";)h=e[++r],f+=`\n`+(h.tokens?this.parseInline(h.tokens):h.text);i+=t?this.renderer.paragraph(f):f;continue}default:{const L='Token with \"'+h.type+'\" type was not found.';if(this.options.silent){console.error(L);return}else throw new Error(L)}}}return i}parseInline(e,t){t=t||this.renderer;let i=\"\",r,s,a;const l=e.length;for(r=0;r<l;r++){if(s=e[r],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]&&(a=this.options.extensions.renderers[s.type].call({parser:this},s),a!==!1||![\"escape\",\"html\",\"link\",\"image\",\"strong\",\"em\",\"codespan\",\"br\",\"del\",\"text\"].includes(s.type))){i+=a||\"\";continue}switch(s.type){case\"escape\":{i+=t.text(s.text);break}case\"html\":{i+=t.html(s.text);break}case\"link\":{i+=t.link(s.href,s.title,this.parseInline(s.tokens,t));break}case\"image\":{i+=t.image(s.href,s.title,s.text);break}case\"strong\":{i+=t.strong(this.parseInline(s.tokens,t));break}case\"em\":{i+=t.em(this.parseInline(s.tokens,t));break}case\"codespan\":{i+=t.codespan(s.text);break}case\"br\":{i+=t.br();break}case\"del\":{i+=t.del(this.parseInline(s.tokens,t));break}case\"text\":{i+=t.text(s.text);break}default:{const o='Token with \"'+s.type+'\" type was not found.';if(this.options.silent){console.error(o);return}else throw new Error(o)}}}return i}}class Me{constructor(e){this.options=e||oe}preprocess(e){return e}postprocess(e){return e}}U(Me,\"passThroughHooks\",new Set([\"preprocess\",\"postprocess\"]));function ea(n,e,t){return i=>{if(i.message+=`\nPlease report this to https://github.com/markedjs/marked.`,n){const r=\"<p>An error occurred:</p><pre>\"+I(i.message+\"\",!0)+\"</pre>\";if(e)return Promise.resolve(r);if(t){t(null,r);return}return r}if(e)return Promise.reject(i);if(t){t(i);return}throw i}}function Fn(n,e){return(t,i,r)=>{typeof i==\"function\"&&(r=i,i=null);const s={...i};i={...b.defaults,...s};const a=ea(i.silent,i.async,r);if(typeof t>\"u\"||t===null)return a(new Error(\"marked(): input parameter is undefined or null\"));if(typeof t!=\"string\")return a(new Error(\"marked(): input parameter is of type \"+Object.prototype.toString.call(t)+\", string expected\"));if(Qo(i),i.hooks&&(i.hooks.options=i),r){const l=i.highlight;let o;try{i.hooks&&(t=i.hooks.preprocess(t)),o=n(t,i)}catch(d){return a(d)}const u=function(d){let f;if(!d)try{i.walkTokens&&b.walkTokens(o,i.walkTokens),f=e(o,i),i.hooks&&(f=i.hooks.postprocess(f))}catch(h){d=h}return i.highlight=l,d?a(d):r(null,f)};if(!l||l.length<3||(delete i.highlight,!o.length))return u();let c=0;b.walkTokens(o,function(d){d.type===\"code\"&&(c++,setTimeout(()=>{l(d.text,d.lang,function(f,h){if(f)return u(f);h!=null&&h!==d.text&&(d.text=h,d.escaped=!0),c--,c===0&&u()})},0))}),c===0&&u();return}if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(t):t).then(l=>n(l,i)).then(l=>i.walkTokens?Promise.all(b.walkTokens(l,i.walkTokens)).then(()=>l):l).then(l=>e(l,i)).then(l=>i.hooks?i.hooks.postprocess(l):l).catch(a);try{i.hooks&&(t=i.hooks.preprocess(t));const l=n(t,i);i.walkTokens&&b.walkTokens(l,i.walkTokens);let o=e(l,i);return i.hooks&&(o=i.hooks.postprocess(o)),o}catch(l){return a(l)}}}function b(n,e,t){return Fn(K.lex,Y.parse)(n,e,t)}b.options=b.setOptions=function(n){return b.defaults={...b.defaults,...n},Do(b.defaults),b};b.getDefaults=Nn;b.defaults=oe;b.use=function(...n){const e=b.defaults.extensions||{renderers:{},childTokens:{}};n.forEach(t=>{const i={...t};if(i.async=b.defaults.async||i.async||!1,t.extensions&&(t.extensions.forEach(r=>{if(!r.name)throw new Error(\"extension name required\");if(r.renderer){const s=e.renderers[r.name];s?e.renderers[r.name]=function(...a){let l=r.renderer.apply(this,a);return l===!1&&(l=s.apply(this,a)),l}:e.renderers[r.name]=r.renderer}if(r.tokenizer){if(!r.level||r.level!==\"block\"&&r.level!==\"inline\")throw new Error(\"extension level must be 'block' or 'inline'\");e[r.level]?e[r.level].unshift(r.tokenizer):e[r.level]=[r.tokenizer],r.start&&(r.level===\"block\"?e.startBlock?e.startBlock.push(r.start):e.startBlock=[r.start]:r.level===\"inline\"&&(e.startInline?e.startInline.push(r.start):e.startInline=[r.start]))}r.childTokens&&(e.childTokens[r.name]=r.childTokens)}),i.extensions=e),t.renderer){const r=b.defaults.renderer||new qe;for(const s in t.renderer){const a=r[s];r[s]=(...l)=>{let o=t.renderer[s].apply(r,l);return o===!1&&(o=a.apply(r,l)),o}}i.renderer=r}if(t.tokenizer){const r=b.defaults.tokenizer||new $t;for(const s in t.tokenizer){const a=r[s];r[s]=(...l)=>{let o=t.tokenizer[s].apply(r,l);return o===!1&&(o=a.apply(r,l)),o}}i.tokenizer=r}if(t.hooks){const r=b.defaults.hooks||new Me;for(const s in t.hooks){const a=r[s];Me.passThroughHooks.has(s)?r[s]=l=>{if(b.defaults.async)return Promise.resolve(t.hooks[s].call(r,l)).then(u=>a.call(r,u));const o=t.hooks[s].call(r,l);return a.call(r,o)}:r[s]=(...l)=>{let o=t.hooks[s].apply(r,l);return o===!1&&(o=a.apply(r,l)),o}}i.hooks=r}if(t.walkTokens){const r=b.defaults.walkTokens;i.walkTokens=function(s){let a=[];return a.push(t.walkTokens.call(this,s)),r&&(a=a.concat(r.call(this,s))),a}}b.setOptions(i)})};b.walkTokens=function(n,e){let t=[];for(const i of n)switch(t=t.concat(e.call(b,i)),i.type){case\"table\":{for(const r of i.header)t=t.concat(b.walkTokens(r.tokens,e));for(const r of i.rows)for(const s of r)t=t.concat(b.walkTokens(s.tokens,e));break}case\"list\":{t=t.concat(b.walkTokens(i.items,e));break}default:b.defaults.extensions&&b.defaults.extensions.childTokens&&b.defaults.extensions.childTokens[i.type]?b.defaults.extensions.childTokens[i.type].forEach(function(r){t=t.concat(b.walkTokens(i[r],e))}):i.tokens&&(t=t.concat(b.walkTokens(i.tokens,e)))}return t};b.parseInline=Fn(K.lexInline,Y.parseInline);b.Parser=Y;b.parser=Y.parse;b.Renderer=qe;b.TextRenderer=Hn;b.Lexer=K;b.lexer=K.lex;b.Tokenizer=$t;b.Slugger=qn;b.Hooks=Me;b.parse=b;b.options;b.setOptions;b.use;b.walkTokens;b.parseInline;Y.parse;K.lex;const St=new qe;St.blockquote=n=>`<div class=\"fork\">${n}</div>`;St.del=n=>`<span class=\"small-caps\">${n}</span>`;function ta(n,e){var i,r;const t=n.substring(1,n.length-1).trim();if(/\\s/.test(t)){const s=(i=t.match(/^[^:,]+/))==null?void 0:i[0];if(!s)return n;const a=e.find(l=>l.match.test(s));if(a){const l=t.replace(s,\"\");if(l[0]===\":\"){const o=new Function(`return {\"${s}\" ${l}}`)(),u=o[s];return delete o[s],a.render(u,o,t)}else if(l[0]===\",\"){const o=new Function(`return {${l.substring(1)}}`)();return a.render(null,o,t)}else if(l===\"\")return a.render(null,{},t)}}else{const s=/(.+)\\[(.+)\\]$/.exec(t);let a;if(s?a=(r=p(s[1]))==null?void 0:r[s[2]]:a=p(t),a!==void 0)return a}return n}function na(n,e){let t=\"\",i=0,r=n.indexOf(\"{\");if(r===-1)return n;let s=!1,a;for(let l=r+1;l<n.length;l++)switch(n[l]){case\"{\":r=l,s=!1;break;case'\"':case\"'\":l>0&&n[l-1]!==\"\\\\\"&&(s?s&&a===n[l]&&(s=!1):(s=!0,a=n[l]));break;case\"}\":if(!s){const o=n.substring(r,l+1);let u=\"\";try{u=ta(o,e)}catch(c){console.warn(`An error occurred while rendering \"${o}\": ${c.message}`),u=o}u===void 0&&(u=\"\"),t+=n.substring(i,r)+u,i=l+1,r=n.indexOf(\"{\",i),r===-1&&(l=n.length)}break}return t+n.substring(i)}const{log:Z}=F(\"render\"),ia={renderer:St,smartypants:!0};function ra(n,e,t,i=!1){if(!n.vars)throw new Error(\"The renderer was given an object with no vars property.\");if(!n.blocks)throw new Error(\"The renderer was given an object with no blocks property.\");let r=\"\";if(!i){Z(`Setting vars (${n.vars.length})`);for(const o of n.vars)o.condition?o.condition()?(Z(`Setting var \"${o.name}\" (condition is currently true)`),$(o.name,o.value())):Z(`Not setting var \"${o.name}\" (condition is currently false)`):(Z(`Setting var \"${o.name}\"`),$(o.name,o.value()))}let s=[];const a=new Map;for(const o of n.blocks)switch(o.type){case\"text\":{const u={text:o.content,startsNewParagraph:!0},c=s.filter(f=>!!f.modifier.processRaw);Z(`Running ${c.length} modifiers on raw source block`);for(const{invocation:f,modifier:h}of c){const m=a.get(h);if(!m)throw new Error(\"State for a modifier was unknown, but should have had a value.\");if(!h.processRaw)throw new Error(\"A modifier was added to the raw modifiers list, but it has no processRaw function.\");h.processRaw(u,{state:m,invocation:f})}u.text=na(io(u.text),e);const d=s.filter(f=>!!f.modifier.process);Z(`Running ${d.length} modifiers on source block`);for(const{invocation:f,modifier:h}of d){const m=a.get(h);if(!m)throw new Error(\"State for a modifier was unknown, but should have had a value.\");if(!h.process)throw new Error(\"A modifier was added to the processed modifiers list, but it has no process function.\");h.process(u,{state:m,invocation:f})}Z(`Output after modifiers: ${JSON.stringify(u)}`),u.text.trim()!==\"\"&&(r!==\"\"&&(r+=u.startsNewParagraph?`\n\n`:\" \"),r+=u.text),s=[];break}case\"modifier\":{const u=t.filter(c=>c.match.test(o.content));if(u.length===1){const c=u[0];Z(`Activated modifier matching [${o.content}]`),a.has(c)||a.set(c,{}),s.push({modifier:c,invocation:o.content})}else u.length===0?r+=`\n\n[${o.content}]\n\n`:(console.warn(`More than one modifier matched \"[${o.content}]\".`),r+=`\n\n[${o.content}]\n\n`);break}default:throw new Error(`Don't know how to render a block with type \"${o.type}\".`)}const l=/^((>|-|(\\*\\s)).*$)\\n{2,}\\2/gm;for(;l.test(r);)r=r.replace(l,`$1\n$2`);return b.setOptions(ia),Z(`Final Markdown:\n${r}`),b(r)}function $e(n,e=!1){return ra(Ro(n),Pn(),Mn(),e)}class sa extends fe{constructor(){super(),this.addEventListener(\"click\",()=>{let e=this.getAttribute(\"text\");const t=this.getAttribute(\"passage\");if(t){const i=Se(t);i&&(e=i.source)}if(e){const i=document.createElement(\"div\");i.innerHTML=$e(e).trim();const r=this.closest(\"body-content, marginal-content\");if(!r)throw new Error(\"Couldn't find suitable parent element to do a reveal link transition on.\");r.changeContent(()=>{var a,l;const s=i.children.length;if(s>0&&this.parentNode){const o=document.createElement(\"span\");if(o.innerHTML=((a=i.firstElementChild)==null?void 0:a.innerHTML)??\"\",this.parentNode.insertBefore(o,this),(l=i.firstElementChild)==null||l.remove(),s>1&&this.parentNode.parentNode&&i.lastChild){const u=i.lastChild;for(;i.lastChild;)this.parentNode.parentNode.insertBefore(i.lastChild,this.parentNode.nextSibling);for(;this.nextSibling;)u.insertBefore(this.nextSibling,null)}}this.remove()})}})}}class Bn extends z{attributeChangedCallback(){const e=this.getAttribute(\"skippable-delay\");if(!e)return;const t=parseInt(e);if(isFinite(t))if(t===0){this.style.animationDelay=\"\";const i=this.className;this.className=\"\",this.offsetWidth,this.className=i}else this.style.animationDelay=`${t}ms`}}U(Bn,\"observedAttributes\",[\"skippable-delay\"]);class Un extends fe{constructor(){super(),this.addEventListener(\"click\",this),window.addEventListener(\"state-change\",this)}connectedCallback(){super.connectedCallback(),this.updateLabel(),this.updateVisibility()}disconnectedCallback(){window.removeEventListener(\"state-change\",this)}handleEvent(e){if(e.type===\"click\")$(\"config.style.page.theme.override\",p(\"browser.darkTheme\")?\"light\":\"dark\"),this.updateLabel();else{const{detail:t}=e;t.name===\"config.style.page.theme.enableSwitching\"&&this.updateVisibility()}}updateLabel(){const e=p(\"browser.darkTheme\")?\"dark\":\"light\";this.innerHTML=this.getAttribute(`${e}-label`)??\"Switch Theme\"}updateVisibility(){p(\"config.style.page.theme.enableSwitching\")?this.removeAttribute(\"hidden\"):this.setAttribute(\"hidden\",\"\")}attributeChangedCallback(){this.updateLabel()}}U(Un,\"observedAttributes\",[\"dark-label\",\"light-label\"]);class oa extends z{constructor(){super(),this.delegate(\"change\",\"input, select\",e=>{const t=this.getAttribute(\"name\"),i=e.target;if(t)switch(i.nodeName){case\"INPUT\":$(t,i.value);break;case\"SELECT\":{const r=i.querySelectorAll(\"option\")[i.selectedIndex];$(t,r.dataset.jsonValue?JSON.parse(r.dataset.jsonValue):r.value)}}})}}function aa(){wt({\"cycling-link\":Ys,\"inline-button\":fe,\"passage-link\":eo,\"restart-link\":to,\"reveal-link\":sa,\"skippable-animation\":Bn,\"theme-switcher\":Un,\"variable-binding\":oa})}function Vn(){aa()}const la=Object.freeze(Object.defineProperty({__proto__:null,initTemplate:Vn,inserts:vo,modifiers:Io,render:$e},Symbol.toStringTag,{value:\"Module\"})),ca=pn(n=>{if(n.some(e=>e[0])){const e=p(\"trail\");if(!Array.isArray(e))throw new Error(\"The trail variable has been set to a non-array value.\");if(typeof e[e.length-1]!=\"string\")throw new Error(\"The last value in the trail variable is not a string.\");const i=Se(e[e.length-1]);if(!i)throw new Error(`There is no passage named \"${e[e.length-1]}\".`);const r=$e(i.source),s={footer:{center:\"\",left:\"\",right:\"\"},header:{center:\"\",left:\"\",right:\"\"}};for(const a in s)for(const l in s[a])s[a][l]=$e(p(`config.${a}.${l}`).toString());window.dispatchEvent(new CustomEvent(\"display-change\",{detail:{body:r,...s}}))}});let Ue;function ua(){window.addEventListener(\"state-change\",({detail:n})=>{ca(n.name===\"trail\")}),Ue=window.matchMedia(\"(prefers-color-scheme: dark)\"),Ue.addEventListener(\"change\",()=>{window.dispatchEvent(new CustomEvent(\"system-theme-change\",{detail:{theme:Ue.matches?\"dark\":\"light\"}}))})}const da={\"config.body.transition.name\":\"crossfade\",\"config.body.transition.duration\":\"300ms\",\"config.header.left\":\"\",\"config.header.center\":\"\",\"config.header.right\":\"\",\"config.header.transition.name\":\"crossfade\",\"config.header.transition.duration\":\"300ms\",\"config.footer.left\":\"_{story.name}_\",\"config.footer.center\":\"\",\"config.footer.right\":\"{theme switcher}&emsp;{restart link}\",\"config.footer.transition.name\":\"crossfade\",\"config.footer.transition.duration\":\"300ms\"};function fa(){re(da),Ks(),ua()}const{warn:Ae}=F(\"extensibility\");function Vt(n){return n.split(\".\").map(window.parseInt)}function ha(){window.engine={extend(n,e){const t=p(\"engine.version\");if(typeof t!=\"string\")throw new Error(`engine.version has been set to a ${typeof t}, not a string.`);const i=Vt(n),r=Vt(t);if(r[0]<i[0]){Ae(`The current engine version (${t}) has a lower major version than requested (${n}); skipping`);return}r[0]>i[0]?Ae(`The current engine version (${t}) has a higher major version than requested (${n}); running code but you may encounter problems`):(r[1]<i[1]&&Ae(`The current engine version (${t}) has a lower minor version than requested (${n}); running code but you may encounter problems`),r[1]===i[1]&&r[2]<i[2]&&Ae(`The current engine version (${t}) has a lower patch version than requested (${n}); running code but you may encounter problems`)),e()},log:Qt,state:Xr,story:Qr,template:la,warn:Kt}}function pa(n,e,t,i){return(n/=i/2)<1?t/2*n*n+e:-t/2*(--n*(n-2)-1)+e}function Wn(n,e,t){const i=n.volume,r=e-i;let s,a=0;return n.volume===e?Promise.resolve():new Promise(l=>window.requestAnimationFrame(o=>{function u(c){a+=c-s,n.volume=pa(a,i,r,t),a<t?(s=c,window.requestAnimationFrame(u)):l()}s=o,window.requestAnimationFrame(u)}))}const{log:Xe}=F(\"sound\"),S={};function Ve(n,e,t){S[n]?(S[n].setAttribute(\"src\",e),t?S[n].setAttribute(\"preload\",\"auto\"):S[n].removeAttribute(\"preload\"),Xe(`Updated <audio> element in sound bank for \"${n}\" to use ${e}`)):(S[n]=document.createElement(\"audio\"),S[n].setAttribute(\"src\",e),t&&S[n].setAttribute(\"preload\",\"auto\"),Xe(`Added new <audio> element to sound bank for \"${n}\" for ${e}`))}async function Le(n,e=!1,t=0){if(!S[n])throw new Error(`There is no sound loaded named ${n}.`);return Xe(`Playing sound \"${n}\" (looping: ${e})`),t>0&&(S[n].volume=0,Wn(S[n],1,t)),e?(S[n].loop=!0,S[n].play()):(S[n].loop=!1,new Promise((i,r)=>{try{S[n].addEventListener(\"ended\",function s(){S[n].removeEventListener(\"ended\",s),i()}),S[n].play().catch(s=>r(s))}catch(s){r(s)}}))}function Wt(n,e=0){if(!S[n])throw new Error(`There is no sound loaded named ${n}.`);if(e<=0)S[n].pause(),S[n].currentTime=0;else{const t=S[n].volume;Wn(S[n],0,e).then(()=>{S[n].pause(),S[n].volume=t,S[n].currentTime=0})}}function Zt(n,e){if(!S[n])throw new Error(`There is no sound loaded named ${n}.`);S[n].muted=e}function We(n,e){if(!S[n])throw new Error(`There is no sound loaded named ${n}.`);if(e<0||e>1)throw new Error(\"A sound volume must be between 0 and 1.\");S[n].volume=e}const{warn:Gt}=F(\"sound\");function ga(){re({\"sound.mute\":!1,\"sound.volume\":1,\"sound.transitionDuration\":\"1s\"}),window.addEventListener(\"state-change\",({detail:n})=>{const{name:e,value:t}=n,i=[\"sound\",\"sound.ambient\"].includes(e),r=[\"sound\",\"sound.effect\"].includes(e);if(i){const a=p(\"sound.ambient\");if(typeof a==\"object\"&&a){const l=a;for(const o in l)typeof l[o].url==\"string\"&&Ve(o,l[o].url,!1),typeof l[o].volume==\"number\"&&We(o,l[o].volume),\"muted\"in l[o]&&Zt(o,!!l[o].muted),l[o].playing===!0&&Le(o,!0).catch(u=>Gt(`Could not resume playing ambient sound \"${o}\" (${u.message})`))}}if(r){const a=p(\"sound.effect\");if(typeof a==\"object\"&&a){const l=a;for(const o in l)typeof l[o].url==\"string\"&&Ve(o,l[o].url,!0),typeof l[o].volume==\"number\"&&We(o,l[o].volume),\"muted\"in l[o]&&Zt(o,!!l[o].muted),l[o].playing&&Le(o,!1).then(()=>$(`sound.effect.${o}.playing`,!1)).catch(u=>Gt(`Could not resume playing sound effect \"${o}\" (${u.message}`))}}if(i||r)return;const s=/^sound\\.(ambient|effect)\\.(.+?)\\.(.+)$/i.exec(e);if(s)switch(s[3].toLowerCase()){case\"playing\":{let a=\"0s\";typeof p(`${s[2]}.transitionDuration`)==\"string\"&&(a=p(`${s[2]}.transitionDuration`)),typeof p(\"sound.transitionDuration\")==\"string\"&&(a=p(\"sound.transitionDuration\")),t?s[1]===\"ambient\"?Le(s[2],!0,ve(a,\"ms\")):Le(s[2],!1).then(()=>$(e,!1)):s[1]===\"ambient\"?Wt(s[2],ve(a,\"ms\")):Wt(s[2]);break}case\"url\":Ve(s[2],t,s[1]===\"effect\");break;case\"volume\":We(s[2],t);break}})}function ma(){C(\"browser.darkSystemTheme\",()=>!!(window.matchMedia&&window.matchMedia(\"(prefers-color-scheme: dark)\").matches)),C(\"browser.darkTheme\",()=>{if(!p(\"config.style.page.theme.enableSwitching\"))return!1;switch(p(\"config.style.page.theme.override\")){case\"dark\":return!0;case\"light\":return!1;default:return p(\"browser.darkSystemTheme\")}}),C(\"browser.height\",()=>window.innerHeight),C(\"browser.online\",()=>window.navigator.onLine),C(\"browser.width\",()=>window.innerWidth)}const ba=\"2.2.0\";function ya(){C(\"engine.version\",()=>ba)}function wa(){C(\"now.datestamp\",()=>new Date().toLocaleDateString(navigator.language)),C(\"now.second\",()=>new Date().getSeconds()),C(\"now.minute\",()=>new Date().getMinutes()),C(\"now.hour\",()=>new Date().getHours()),C(\"now.day\",()=>new Date().getDate()),C(\"now.weekday\",()=>new Date().getDay()+1),C(\"now.weekdayName\",()=>new Date().toLocaleString(navigator.language,{weekday:\"long\"})),C(\"now.month\",()=>new Date().getMonth()+1),C(\"now.monthName\",()=>new Date().toLocaleString(navigator.language,{month:\"long\"})),C(\"now.year\",()=>new Date().getFullYear()),C(\"now.timestamp\",()=>new Date().toLocaleString(navigator.language,{hour:\"numeric\",minute:\"numeric\",second:\"numeric\"}))}const{warn:Ze}=F(\"lookups\");let Jt;function ka(){C(\"passage.from\",()=>{const n=p(\"trail\");if(!Array.isArray(n)){Ze(`The trail variable has been set to a ${typeof n}, not an array.`);return}if(n.length>1)return n[n.length-2]}),window.addEventListener(\"passage-navigate\",n=>{n.target&&(Jt=n.target.innerText)}),C(\"passage.fromText\",()=>Jt),C(\"passage.name\",()=>{const n=p(\"trail\");if(!Array.isArray(n)){Ze(`The trail variable has been set to a ${typeof n}, not an array.`);return}return n[n.length-1]}),C(\"passage.visits\",()=>{const n=p(\"trail\"),e=p(\"passage.name\");return Array.isArray(n)?n.reduce((t,i)=>i===e?t+1:t,0):(Ze(`The trail variable has been set to a ${typeof n}, not an array.`),0)})}var Qe={},xa={get exports(){return Qe},set exports(n){Qe=n}};(function(n){(function(e,t,i){function r(o){var u=this,c=l();u.next=function(){var d=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=d-(u.c=d|0)},u.c=1,u.s0=c(\" \"),u.s1=c(\" \"),u.s2=c(\" \"),u.s0-=c(o),u.s0<0&&(u.s0+=1),u.s1-=c(o),u.s1<0&&(u.s1+=1),u.s2-=c(o),u.s2<0&&(u.s2+=1),c=null}function s(o,u){return u.c=o.c,u.s0=o.s0,u.s1=o.s1,u.s2=o.s2,u}function a(o,u){var c=new r(o),d=u&&u.state,f=c.next;return f.int32=function(){return c.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,d&&(typeof d==\"object\"&&s(d,c),f.state=function(){return s(c,{})}),f}function l(){var o=4022871197,u=function(c){c=String(c);for(var d=0;d<c.length;d++){o+=c.charCodeAt(d);var f=.02519603282416938*o;o=f>>>0,f-=o,f*=o,o=f>>>0,f-=o,o+=f*4294967296}return(o>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=a:i&&i.amd?i(function(){return a}):this.alea=a})(se,n,!1)})(xa);var Ke={},va={get exports(){return Ke},set exports(n){Ke=n}};(function(n){(function(e,t,i){function r(l){var o=this,u=\"\";o.x=0,o.y=0,o.z=0,o.w=0,o.next=function(){var d=o.x^o.x<<11;return o.x=o.y,o.y=o.z,o.z=o.w,o.w^=o.w>>>19^d^d>>>8},l===(l|0)?o.x=l:u+=l;for(var c=0;c<u.length+64;c++)o.x^=u.charCodeAt(c)|0,o.next()}function s(l,o){return o.x=l.x,o.y=l.y,o.z=l.z,o.w=l.w,o}function a(l,o){var u=new r(l),c=o&&o.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,m=(f+h)/(1<<21);while(m===0);return m},d.int32=u.next,d.quick=d,c&&(typeof c==\"object\"&&s(c,u),d.state=function(){return s(u,{})}),d}t&&t.exports?t.exports=a:i&&i.amd?i(function(){return a}):this.xor128=a})(se,n,!1)})(va);var Ye={},$a={get exports(){return Ye},set exports(n){Ye=n}};(function(n){(function(e,t,i){function r(l){var o=this,u=\"\";o.next=function(){var d=o.x^o.x>>>2;return o.x=o.y,o.y=o.z,o.z=o.w,o.w=o.v,(o.d=o.d+362437|0)+(o.v=o.v^o.v<<4^(d^d<<1))|0},o.x=0,o.y=0,o.z=0,o.w=0,o.v=0,l===(l|0)?o.x=l:u+=l;for(var c=0;c<u.length+64;c++)o.x^=u.charCodeAt(c)|0,c==u.length&&(o.d=o.x<<10^o.x>>>4),o.next()}function s(l,o){return o.x=l.x,o.y=l.y,o.z=l.z,o.w=l.w,o.v=l.v,o.d=l.d,o}function a(l,o){var u=new r(l),c=o&&o.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,m=(f+h)/(1<<21);while(m===0);return m},d.int32=u.next,d.quick=d,c&&(typeof c==\"object\"&&s(c,u),d.state=function(){return s(u,{})}),d}t&&t.exports?t.exports=a:i&&i.amd?i(function(){return a}):this.xorwow=a})(se,n,!1)})($a);var et={},Sa={get exports(){return et},set exports(n){et=n}};(function(n){(function(e,t,i){function r(l){var o=this;o.next=function(){var c=o.x,d=o.i,f,h;return f=c[d],f^=f>>>7,h=f^f<<24,f=c[d+1&7],h^=f^f>>>10,f=c[d+3&7],h^=f^f>>>3,f=c[d+4&7],h^=f^f<<7,f=c[d+7&7],f=f^f<<13,h^=f^f<<9,c[d]=h,o.i=d+1&7,h};function u(c,d){var f,h=[];if(d===(d|0))h[0]=d;else for(d=\"\"+d,f=0;f<d.length;++f)h[f&7]=h[f&7]<<15^d.charCodeAt(f)+h[f+1&7]<<13;for(;h.length<8;)h.push(0);for(f=0;f<8&&h[f]===0;++f);for(f==8?h[7]=-1:h[f],c.x=h,c.i=0,f=256;f>0;--f)c.next()}u(o,l)}function s(l,o){return o.x=l.x.slice(),o.i=l.i,o}function a(l,o){l==null&&(l=+new Date);var u=new r(l),c=o&&o.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,m=(f+h)/(1<<21);while(m===0);return m},d.int32=u.next,d.quick=d,c&&(c.x&&s(c,u),d.state=function(){return s(u,{})}),d}t&&t.exports?t.exports=a:i&&i.amd?i(function(){return a}):this.xorshift7=a})(se,n,!1)})(Sa);var tt={},Ea={get exports(){return tt},set exports(n){tt=n}};(function(n){(function(e,t,i){function r(l){var o=this;o.next=function(){var c=o.w,d=o.X,f=o.i,h,m;return o.w=c=c+1640531527|0,m=d[f+34&127],h=d[f=f+1&127],m^=m<<13,h^=h<<17,m^=m>>>15,h^=h>>>12,m=d[f]=m^h,o.i=f,m+(c^c>>>16)|0};function u(c,d){var f,h,m,v,O,x=[],A=128;for(d===(d|0)?(h=d,d=null):(d=d+\"\\0\",h=0,A=Math.max(A,d.length)),m=0,v=-32;v<A;++v)d&&(h^=d.charCodeAt((v+32)%d.length)),v===0&&(O=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,v>=0&&(O=O+1640531527|0,f=x[v&127]^=h+O,m=f==0?m+1:0);for(m>=128&&(x[(d&&d.length||0)&127]=-1),m=127,v=4*128;v>0;--v)h=x[m+34&127],f=x[m=m+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,x[m]=h^f;c.w=O,c.X=x,c.i=m}u(o,l)}function s(l,o){return o.i=l.i,o.w=l.w,o.X=l.X.slice(),o}function a(l,o){l==null&&(l=+new Date);var u=new r(l),c=o&&o.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,m=(f+h)/(1<<21);while(m===0);return m},d.int32=u.next,d.quick=d,c&&(c.X&&s(c,u),d.state=function(){return s(u,{})}),d}t&&t.exports?t.exports=a:i&&i.amd?i(function(){return a}):this.xor4096=a})(se,n,!1)})(Ea);var nt={},Ca={get exports(){return nt},set exports(n){nt=n}};(function(n){(function(e,t,i){function r(l){var o=this,u=\"\";o.next=function(){var d=o.b,f=o.c,h=o.d,m=o.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^m,m=m-d|0,o.b=d=d<<20^d>>>12^f,o.c=f=f-h|0,o.d=h<<16^f>>>16^m,o.a=m-d|0},o.a=0,o.b=0,o.c=-1640531527,o.d=1367130551,l===Math.floor(l)?(o.a=l/4294967296|0,o.b=l|0):u+=l;for(var c=0;c<u.length+20;c++)o.b^=u.charCodeAt(c)|0,o.next()}function s(l,o){return o.a=l.a,o.b=l.b,o.c=l.c,o.d=l.d,o}function a(l,o){var u=new r(l),c=o&&o.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,m=(f+h)/(1<<21);while(m===0);return m},d.int32=u.next,d.quick=d,c&&(typeof c==\"object\"&&s(c,u),d.state=function(){return s(u,{})}),d}t&&t.exports?t.exports=a:i&&i.amd?i(function(){return a}):this.tychei=a})(se,n,!1)})(Ca);var it={},_a={get exports(){return it},set exports(n){it=n}};const Ta={},Aa=Object.freeze(Object.defineProperty({__proto__:null,default:Ta},Symbol.toStringTag,{value:\"Module\"})),La=Ls(Aa);(function(n){(function(e,t,i){var r=256,s=6,a=52,l=\"random\",o=i.pow(r,s),u=i.pow(2,a),c=u*2,d=r-1,f;function h(w,k,_){var T=[];k=k==!0?{entropy:!0}:k||{};var L=x(O(k.entropy?[w,R(t)]:w??A(),3),T),D=new m(T),H=function(){for(var j=D.g(s),W=o,B=0;j<u;)j=(j+B)*r,W*=r,B=D.g(1);for(;j>=c;)j/=2,W/=2,B>>>=1;return(j+B)/W};return H.int32=function(){return D.g(4)|0},H.quick=function(){return D.g(4)/4294967296},H.double=H,x(R(D.S),t),(k.pass||_||function(j,W,B,G){return G&&(G.S&&v(G,D),j.state=function(){return v(D,{})}),B?(i[l]=j,W):j})(H,L,\"global\"in k?k.global:this==i,k.state)}function m(w){var k,_=w.length,T=this,L=0,D=T.i=T.j=0,H=T.S=[];for(_||(w=[_++]);L<r;)H[L]=L++;for(L=0;L<r;L++)H[L]=H[D=d&D+w[L%_]+(k=H[L])],H[D]=k;(T.g=function(j){for(var W,B=0,G=T.i,Ce=T.j,he=T.S;j--;)W=he[G=d&G+1],B=B*r+he[d&(he[G]=he[Ce=d&Ce+W])+(he[Ce]=W)];return T.i=G,T.j=Ce,B})(r)}function v(w,k){return k.i=w.i,k.j=w.j,k.S=w.S.slice(),k}function O(w,k){var _=[],T=typeof w,L;if(k&&T==\"object\")for(L in w)try{_.push(O(w[L],k-1))}catch{}return _.length?_:T==\"string\"?w:w+\"\\0\"}function x(w,k){for(var _=w+\"\",T,L=0;L<_.length;)k[d&L]=d&(T^=k[d&L]*19)+_.charCodeAt(L++);return R(k)}function A(){try{var w;return f&&(w=f.randomBytes)?w=w(r):(w=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(w)),R(w)}catch{var k=e.navigator,_=k&&k.plugins;return[+new Date,e,_,e.screen,R(t)]}}function R(w){return String.fromCharCode.apply(0,w)}if(x(i.random(),t),n.exports){n.exports=h;try{f=La}catch{}}else i[\"seed\"+l]=h})(typeof self<\"u\"?self:se,[],Math)})(_a);var za=Qe,Pa=Ke,Oa=Ye,Ia=et,Ma=tt,Na=nt,ae=it;ae.alea=za;ae.xor128=Pa;ae.xorwow=Oa;ae.xorshift7=Ia;ae.xor4096=Ma;ae.tychei=Na;var Zn=ae;const Gn=Date.now().toString();let ye=Zn(Gn,{state:!0});const Ge=pn(()=>{$(\"config.random.privateState\",ye.state())});function Ra(){re({\"config.random.privateState\":null,\"config.random.seed\":Gn}),window.addEventListener(\"state-change\",({detail:n})=>{n.name===\"config.random.seed\"&&(ye=Zn(n.value,{state:!0}))}),C(\"random.coinFlip\",()=>{const n=ye();return Ge(),n>.5}),C(\"random.fraction\",()=>{const n=ye();return Ge(),n});for(const n of[4,5,6,8,10,12,20,25,50,100,1e3])C(`random.d${n}`,()=>{const e=1+Math.round(ye()*(n-1));return Ge(),e})}function Da(){C(\"story.name\",ht)}function ja(){ma(),ya(),wa(),ka(),Ra(),Da()}function Ha(){const n=document.querySelectorAll(\"tw-storydata\");if(n.length===0){console.warn(\"No <tw-storydata> element was found in HTML.\");return}n.length>1&&console.warn(\"Multiple <tw-storydata> elements were found in HTML. Using the first.\"),cn(n[0]),ha(),mn(),Object.assign(window,{go:vn,restart:$n}),ei(),re(Qn),fa(),Gs(),Vn(),ja(),ga(),un(),p(\"config.testing\")?As():yn()&&wn(),fn(),dn()}Ha();\n\n</script><style>\n:root{--font-monospace: ui-monospace, Menlo, Monaco, \"Cascadia Mono\", \"Segoe UI Mono\", \"Roboto Mono\", \"Oxygen Mono\", \"Ubuntu Monospace\", \"Source Code Pro\", \"Fira Mono\", \"Droid Sans Mono\", \"Courier New\", monospace;--font-system: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen-Sans, Ubuntu, Cantarell, \"Helvetica Neue\", sans-serif}*{box-sizing:border-box}body{margin:0;padding:0}code{font-family:var(--font-monospace)}img{max-width:100%;height:auto}input[type=text],select{padding:.25em}noscript{align-items:center;background:black;color:#fff;display:flex;height:100vh;font-family:var(--font-system);justify-content:center;width:100vw}pre{font-family:var(--font-monospace);white-space:pre-wrap}tw-storydata{display:none}body.backstage-visible #backdrop{max-width:67vw}backstage-sidebar{--backstage-grid: 10px;background:var(--color-gray-2);border-left:1px solid var(--color-gray-3);bottom:0;color:var(--color-gray-5);display:block;font-family:var(--font-system);font-size:13px;position:fixed;top:0;right:0;width:33vw}backstage-sidebar .content{overflow:auto;padding:var(--backstage-grid);height:100%;width:100%}backstage-sidebar[collapsed]{width:0}backstage-sidebar button[data-toggle-collapsed]{background:var(--color-gray-2);border-bottom:1px solid var(--color-gray-3);border-left:1px solid var(--color-gray-3);border-right:none;border-top:1px solid var(--color-gray-3);border-radius:60px 0 0 60px;color:var(--color-gray-5);font-size:20px;height:60px;min-width:30px;padding:0;position:absolute;top:50%;left:-30px;transform:translateY(-50%);width:30px}backstage-sidebar button[data-toggle-collapsed]:hover{background:var(--color-gray-1);cursor:pointer}backstage-sidebar button{background:var(--color-gray-1);border:1px solid var(--color-gray-3);border-radius:var(--backstage-grid);color:var(--color-gray-5);cursor:pointer;font-size:100%;min-width:40px;padding:calc(var(--backstage-grid) / 2)}backstage-sidebar button:disabled{color:var(--color-gray-3);cursor:not-allowed}backstage-sidebar button:not(:disabled):hover{background:white}backstage-sidebar details summary{cursor:pointer;font-size:110%;font-variant:small-caps;padding:calc(var(--backstage-grid) / 2) 0;text-transform:lowercase}backstage-sidebar input,backstage-sidebar textarea{background:var(--color-gray-1);border:1px solid var(--color-gray-3);color:var(--color-gray-5);font:100% var(--font-system);padding:calc(var(--backstage-grid) / 2)}backstage-sidebar table{max-width:100%;width:100%}backstage-history-table button{display:block;width:100%}backstage-history-table table{border-collapse:collapse;margin:var(--backstage-grid) 0;table-layout:fixed}backstage-history-table thead{height:1px;left:-10000px;overflow:hidden;position:absolute;top:auto;width:1px}backstage-history-table tr:not(:last-child){border-bottom:1px solid var(--oc-gray-8)}backstage-history-table td{text-overflow:ellipsis;overflow-wrap:break-word;padding:calc(var(--backstage-grid) / 2);vertical-align:top}backstage-history-table td:first-child{border-right:1px solid var(--oc-gray-8);width:45%}backstage-notes label{display:block;margin-top:var(--backstage-grid)}backstage-notes textarea{height:10em;margin:var(--backstage-grid) 0;width:100%}backstage-notes .actions{display:flex;gap:var(--backstage-grid)}backstage-notes .actions button{flex-grow:1}backstage-state-snapshots button[data-add-snapshot]{width:100%}backstage-state-snapshots .snapshot-button{display:flex;margin-bottom:var(--backstage-grid)}backstage-state-snapshots .snapshot-button [data-restore]{flex-grow:1;border-right-color:var(--oc-gray-4);border-bottom-right-radius:0;border-top-right-radius:0}backstage-state-snapshots .snapshot-button [data-remove]{border-left:none;border-bottom-left-radius:0;border-top-left-radius:0}backstage-state-variables .variables{display:flex;flex-direction:column;gap:calc(var(--backstage-grid) / 2);margin:calc(var(--backstage-grid)) 0}backstage-state-variables .variables label{align-items:center;display:grid;gap:var(--backstage-grid);grid-template-columns:15em 1fr}backstage-style-config textarea{height:10em;margin:var(--backstage-grid) 0;width:100%}backstage-style-group label{display:grid;gap:.25em;margin-bottom:.5em}backstage-style-theme p{margin:0 0 .5em}backstage-tab{border-left:1px solid var(--color-gray-3);cursor:pointer;flex-grow:1;padding:calc(var(--backstage-grid) / 2);text-align:center}backstage-tab:hover{background:white}backstage-tab:first-child{border-left:none;border-bottom-left-radius:var(--backstage-grid);border-top-left-radius:var(--backstage-grid)}backstage-tab:last-child{border-bottom-right-radius:var(--backstage-grid);border-top-right-radius:var(--backstage-grid)}backstage-tab[aria-selected=true]{background-color:#fff;cursor:default;font-weight:700}backstage-tab-panel{display:block;padding:calc(var(--backstage-grid) / 2) 0}backstage-tab-panel[hidden]{display:none}backstage-tabs{background:var(--color-gray-1);border:1px solid var(--color-gray-3);border-radius:var(--backstage-grid);display:flex}backstage-variable-input input{display:inline-block;width:100%}.fade-in{opacity:0;animation:fade-in 1s ease-out forwards}.fade-out{animation:fade-in 1s ease-out reverse forwards}@keyframes fade-in{0%{opacity:0}to{opacity:1}}#backdrop{align-items:center;background-color:var(--backdrop-color);display:flex;justify-content:center;min-height:100vh}#page>marginal-content[type=footer]{background-color:var(--page-footer-background-color);border-top:var(--page-footer-border);color:var(--page-footer-color);font-family:var(--page-footer-font-family);font-size:var(--page-footer-font-size);font-style:var(--page-footer-font-style);font-variant:var(--page-footer-font-variant);font-weight:var(--page-footer-font-weight);text-decoration:var(--page-footer-text-decoration);text-decoration-color:var(--page-footer-text-decoration-color);text-transform:var(--page-footer-text-transform)}#page>marginal-content[type=footer] .link{background-color:var(--page-footer-link-background-color);color:var(--page-footer-link-color);font-family:var(--page-footer-link-font-family);font-size:var(--page-footer-link-font-size);font-style:var(--page-footer-link-font-style);font-variant:var(--page-footer-link-font-variant);font-weight:var(--page-footer-link-font-weight);text-decoration:var(--page-footer-link-text-decoration);text-decoration-color:var(--page-footer-link-text-decoration-color);text-transform:var(--page-footer-link-text-transform)}#page>marginal-content[type=footer] .link:hover{background-color:var(--page-footer-link-active-background-color);color:var(--page-footer-link-active-color);font-family:var(--page-footer-link-active-font-family);font-size:var(--page-footer-link-active-font-size);font-style:var(--page-footer-link-active-font-style);font-variant:var(--page-footer-link-active-font-variant);font-weight:var(--page-footer-link-active-font-weight);text-decoration:var(--page-footer-link-active-text-decoration);text-decoration-color:var( --page-footer-link-active-text-decoration-color );text-transform:var(--page-footer-link-active-text-transform)}#page>marginal-content[type=header]{background-color:var(--page-header-background-color);border-bottom:1px solid var(--page-footer-borderColor);color:var(--page-header-color);font-family:var(--page-header-font-family);font-size:var(--page-header-font-size);font-style:var(--page-header-font-style);font-variant:var(--page-header-font-variant);font-weight:var(--page-header-font-weight);text-decoration:var(--page-header-text-decoration);text-decoration-color:var(--page-header-text-decoration-color);text-transform:var(--page-header-text-transform)}#page>marginal-content[type=header] .link{background-color:var(--page-header-link-background-color);color:var(--page-header-link-color);font-family:var(--page-header-link-font-family);font-size:var(--page-header-link-font-size);font-style:var(--page-header-link-font-style);font-variant:var(--page-header-link-font-variant);font-weight:var(--page-header-link-font-weight);text-decoration:var(--page-header-link-text-decoration);text-decoration-color:var(--page-header-link-text-decoration-color);text-transform:var(--page-header-link-text-transform)}#page>marginal-content[type=header] .link:hover{background-color:var(--page-header-link-active-background-color);color:var(--page-header-link-active-color);font-family:var(--page-header-link-active-font-family);font-size:var(--page-header-link-active-font-size);font-style:var(--page-header-link-active-font-style);font-variant:var(--page-header-link-active-font-variant);font-weight:var(--page-header-link-active-font-weight);text-decoration:var(--page-header-link-active-text-decoration);text-decoration-color:var( --page-header-link-active-text-decoration-color );text-transform:var(--page-header-link-active-text-transform)}#page{background-color:var(--page-background-color);border:var(--page-border);border-radius:3px;box-shadow:var(--page-box-shadow);color:var(--page-color);display:grid;font-family:var(--page-font-family);font-size:var(--page-font-size);font-style:var(--page-font-style);font-variant:var(--page-font-variant);font-weight:var(--page-font-weight);grid-template-areas:\"header\" \"body\" \"footer\";grid-template-rows:min-content 1fr min-content;line-height:150%;margin:1em;max-width:calc(100vw - 2em);min-height:calc(100vh - 2em);padding:2em 4em;position:relative;text-decoration:var(--page-text-decoration);text-transform:var(--page-text-transform);width:40em}#page hr{border:none}#page hr:after{content:\"* \\a0* \\a0*\";display:block;text-align:center}#page page-skip-indicator{position:absolute;bottom:0;right:0}#page .fork p{display:flex;flex-direction:column;width:100%}#page .fork p .link{display:block;flex-grow:1;text-align:center;padding:.5em}#page .fork p .link+.link{border-top:var(--page-fork-divider-size) var(--page-fork-divider-style) var(--page-fork-divider-color)}#page .link{background-color:var(--page-link-background-color);color:var(--page-link-color);cursor:pointer;font-family:var(--page-link-font-family);font-size:var(--page-link-font-size);font-style:var(--page-link-font-style);font-variant:var(--page-link-font-variant);font-weight:var(--page-link-font-weight);text-decoration:var(--page-link-text-decoration);text-decoration-color:var(--page-link-text-decoration-color);text-transform:var(--page-link-text-transform)}#page .link:hover{background-color:var(--page-link-active-background-color);color:var(--page-link-active-color);font-family:var(--page-link-font-family);font-size:var(--page-link-font-size);font-style:var(--page-link-font-style);font-variant:var(--page-link-font-variant);font-weight:var(--page-link-font-weight);text-decoration:var(--page-link-text-decoration);text-decoration-color:var(--page-link-text-decoration-color);text-transform:var(--page-link-text-transform)}#page .small-caps{font-variant:small-caps;text-transform:lowercase}#page>marginal-content[type=footer]{grid-area:footer}#page>marginal-content[type=header]{grid-area:header}#page>body-content{display:flex;flex-direction:column;flex-grow:1;grid-area:body;justify-content:var(--page-current-passage-justify-content)}#page>error-handler{grid-area:body;position:relative;z-index:2}@media screen and (max-width: 768px){#page{margin:0;width:100vw;max-width:100vw;min-height:100vh;padding:1em}}body-content{display:block}error-handler{display:none}error-handler.active{background:var(--color-red-1);color:var(--color-red-5);display:block;font-family:var(--font-system);font-size:max(90%,16px);padding:.5em;border-left:4px solid var(--color-red-2);position:relative;margin:1em 0;overflow:auto}error-handler pre{font-size:90%}error-handler a{color:var(--color-red-4)}error-handler button{appearance:none;background:none;border:none;color:var(--color-red-4);cursor:pointer;padding:0}external-fonts{display:none}marginal-content{display:flex;justify-content:space-between}marginal-content[hidden]{display:none}marginal-content .center{text-align:center}marginal-content .right{text-align:right}page-skip{display:block}page-skip-indicator{background-image:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3e%09%3crect width='38' height='72' x='31' y='14' fill='%23fff' rx='4' /%3e%09%3ccircle cx='50' cy='50' r='28' fill='%23fff' /%3e%09%3crect%09%09width='30'%09%09height='64'%09%09x='35'%09%09y='18'%09%09fill='%23fff'%09%09stroke='%23000'%09%09stroke-width='2'%09%09rx='4'%09/%3e%09%3ccircle%09%09cx='50'%09%09cy='50'%09%09r='20'%09%09fill='%23fff'%09%09stroke='%23000'%09%09stroke-width='2'%09/%3e%09%3cpath%09%09stroke='%23000'%09%09stroke-linecap='round'%09%09stroke-width='2'%09%09d='M50 50V37'%09%3e%09%09%3canimateTransform%09%09%09attributeName='transform'%09%09%09begin='0s'%09%09%09dur='20s'%09%09%09from='0 50 50'%09%09%09repeatCount='indefinite'%09%09%09to='360 50 50'%09%09%09type='rotate'%09%09/%3e%09%3c/path%3e%09%3cpath%09%09stroke='%23000'%09%09stroke-linecap='round'%09%09stroke-width='2'%09%09d='M50 50h-8'%09%3e%09%09%3canimateTransform%09%09%09attributeName='transform'%09%09%09begin='0s'%09%09%09dur='120s'%09%09%09from='0 50 50'%09%09%09repeatCount='indefinite'%09%09%09to='360 50 50'%09%09%09type='rotate'%09%09/%3e%09%3c/path%3e%3c/svg%3e\");background-size:contain;display:block;height:50px;opacity:0;pointer-events:none;transition:opacity .3s;width:50px}page-skip-indicator[active]{opacity:1}:root{--oc-white: #ffffff;--oc-white-rgb: 255, 255, 255;--oc-black: #000000;--oc-black-rgb: 0, 0, 0;--oc-gray-0: #f8f9fa;--oc-gray-0-rgb: 248, 249, 250;--oc-gray-1: #f1f3f5;--oc-gray-1-rgb: 241, 243, 245;--oc-gray-2: #e9ecef;--oc-gray-2-rgb: 233, 236, 239;--oc-gray-3: #dee2e6;--oc-gray-3-rgb: 222, 226, 230;--oc-gray-4: #ced4da;--oc-gray-4-rgb: 206, 212, 218;--oc-gray-5: #adb5bd;--oc-gray-5-rgb: 173, 181, 189;--oc-gray-6: #868e96;--oc-gray-6-rgb: 134, 142, 150;--oc-gray-7: #495057;--oc-gray-7-rgb: 73, 80, 87;--oc-gray-8: #343a40;--oc-gray-8-rgb: 52, 58, 64;--oc-gray-9: #212529;--oc-gray-9-rgb: 33, 37, 41;--oc-red-0: #fff5f5;--oc-red-0-rgb: 255, 245, 245;--oc-red-1: #ffe3e3;--oc-red-1-rgb: 255, 227, 227;--oc-red-2: #ffc9c9;--oc-red-2-rgb: 255, 201, 201;--oc-red-3: #ffa8a8;--oc-red-3-rgb: 255, 168, 168;--oc-red-4: #ff8787;--oc-red-4-rgb: 255, 135, 135;--oc-red-5: #ff6b6b;--oc-red-5-rgb: 255, 107, 107;--oc-red-6: #fa5252;--oc-red-6-rgb: 250, 82, 82;--oc-red-7: #f03e3e;--oc-red-7-rgb: 240, 62, 62;--oc-red-8: #e03131;--oc-red-8-rgb: 224, 49, 49;--oc-red-9: #c92a2a;--oc-red-9-rgb: 201, 42, 42;--oc-pink-0: #fff0f6;--oc-pink-0-rgb: 255, 240, 246;--oc-pink-1: #ffdeeb;--oc-pink-1-rgb: 255, 222, 235;--oc-pink-2: #fcc2d7;--oc-pink-2-rgb: 252, 194, 215;--oc-pink-3: #faa2c1;--oc-pink-3-rgb: 250, 162, 193;--oc-pink-4: #f783ac;--oc-pink-4-rgb: 247, 131, 172;--oc-pink-5: #f06595;--oc-pink-5-rgb: 240, 101, 149;--oc-pink-6: #e64980;--oc-pink-6-rgb: 230, 73, 128;--oc-pink-7: #d6336c;--oc-pink-7-rgb: 214, 51, 108;--oc-pink-8: #c2255c;--oc-pink-8-rgb: 194, 37, 92;--oc-pink-9: #a61e4d;--oc-pink-9-rgb: 166, 30, 77;--oc-grape-0: #f8f0fc;--oc-grape-0-rgb: 248, 240, 252;--oc-grape-1: #f3d9fa;--oc-grape-1-rgb: 243, 217, 250;--oc-grape-2: #eebefa;--oc-grape-2-rgb: 238, 190, 250;--oc-grape-3: #e599f7;--oc-grape-3-rgb: 229, 153, 247;--oc-grape-4: #da77f2;--oc-grape-4-rgb: 218, 119, 242;--oc-grape-5: #cc5de8;--oc-grape-5-rgb: 204, 93, 232;--oc-grape-6: #be4bdb;--oc-grape-6-rgb: 190, 75, 219;--oc-grape-7: #ae3ec9;--oc-grape-7-rgb: 174, 62, 201;--oc-grape-8: #9c36b5;--oc-grape-8-rgb: 156, 54, 181;--oc-grape-9: #862e9c;--oc-grape-9-rgb: 134, 46, 156;--oc-violet-0: #f3f0ff;--oc-violet-0-rgb: 243, 240, 255;--oc-violet-1: #e5dbff;--oc-violet-1-rgb: 229, 219, 255;--oc-violet-2: #d0bfff;--oc-violet-2-rgb: 208, 191, 255;--oc-violet-3: #b197fc;--oc-violet-3-rgb: 177, 151, 252;--oc-violet-4: #9775fa;--oc-violet-4-rgb: 151, 117, 250;--oc-violet-5: #845ef7;--oc-violet-5-rgb: 132, 94, 247;--oc-violet-6: #7950f2;--oc-violet-6-rgb: 121, 80, 242;--oc-violet-7: #7048e8;--oc-violet-7-rgb: 112, 72, 232;--oc-violet-8: #6741d9;--oc-violet-8-rgb: 103, 65, 217;--oc-violet-9: #5f3dc4;--oc-violet-9-rgb: 95, 61, 196;--oc-indigo-0: #edf2ff;--oc-indigo-0-rgb: 237, 242, 255;--oc-indigo-1: #dbe4ff;--oc-indigo-1-rgb: 219, 228, 255;--oc-indigo-2: #bac8ff;--oc-indigo-2-rgb: 186, 200, 255;--oc-indigo-3: #91a7ff;--oc-indigo-3-rgb: 145, 167, 255;--oc-indigo-4: #748ffc;--oc-indigo-4-rgb: 116, 143, 252;--oc-indigo-5: #5c7cfa;--oc-indigo-5-rgb: 92, 124, 250;--oc-indigo-6: #4c6ef5;--oc-indigo-6-rgb: 76, 110, 245;--oc-indigo-7: #4263eb;--oc-indigo-7-rgb: 66, 99, 235;--oc-indigo-8: #3b5bdb;--oc-indigo-8-rgb: 59, 91, 219;--oc-indigo-9: #364fc7;--oc-indigo-9-rgb: 54, 79, 199;--oc-blue-0: #e7f5ff;--oc-blue-0-rgb: 231, 245, 255;--oc-blue-1: #d0ebff;--oc-blue-1-rgb: 208, 235, 255;--oc-blue-2: #a5d8ff;--oc-blue-2-rgb: 165, 216, 255;--oc-blue-3: #74c0fc;--oc-blue-3-rgb: 116, 192, 252;--oc-blue-4: #4dabf7;--oc-blue-4-rgb: 77, 171, 247;--oc-blue-5: #339af0;--oc-blue-5-rgb: 51, 154, 240;--oc-blue-6: #228be6;--oc-blue-6-rgb: 34, 139, 230;--oc-blue-7: #1c7ed6;--oc-blue-7-rgb: 28, 126, 214;--oc-blue-8: #1971c2;--oc-blue-8-rgb: 25, 113, 194;--oc-blue-9: #1864ab;--oc-blue-9-rgb: 24, 100, 171;--oc-cyan-0: #e3fafc;--oc-cyan-0-rgb: 227, 250, 252;--oc-cyan-1: #c5f6fa;--oc-cyan-1-rgb: 197, 246, 250;--oc-cyan-2: #99e9f2;--oc-cyan-2-rgb: 153, 233, 242;--oc-cyan-3: #66d9e8;--oc-cyan-3-rgb: 102, 217, 232;--oc-cyan-4: #3bc9db;--oc-cyan-4-rgb: 59, 201, 219;--oc-cyan-5: #22b8cf;--oc-cyan-5-rgb: 34, 184, 207;--oc-cyan-6: #15aabf;--oc-cyan-6-rgb: 21, 170, 191;--oc-cyan-7: #1098ad;--oc-cyan-7-rgb: 16, 152, 173;--oc-cyan-8: #0c8599;--oc-cyan-8-rgb: 12, 133, 153;--oc-cyan-9: #0b7285;--oc-cyan-9-rgb: 11, 114, 133;--oc-teal-0: #e6fcf5;--oc-teal-0-rgb: 230, 252, 245;--oc-teal-1: #c3fae8;--oc-teal-1-rgb: 195, 250, 232;--oc-teal-2: #96f2d7;--oc-teal-2-rgb: 150, 242, 215;--oc-teal-3: #63e6be;--oc-teal-3-rgb: 99, 230, 190;--oc-teal-4: #38d9a9;--oc-teal-4-rgb: 56, 217, 169;--oc-teal-5: #20c997;--oc-teal-5-rgb: 32, 201, 151;--oc-teal-6: #12b886;--oc-teal-6-rgb: 18, 184, 134;--oc-teal-7: #0ca678;--oc-teal-7-rgb: 12, 166, 120;--oc-teal-8: #099268;--oc-teal-8-rgb: 9, 146, 104;--oc-teal-9: #087f5b;--oc-teal-9-rgb: 8, 127, 91;--oc-green-0: #ebfbee;--oc-green-0-rgb: 235, 251, 238;--oc-green-1: #d3f9d8;--oc-green-1-rgb: 211, 249, 216;--oc-green-2: #b2f2bb;--oc-green-2-rgb: 178, 242, 187;--oc-green-3: #8ce99a;--oc-green-3-rgb: 140, 233, 154;--oc-green-4: #69db7c;--oc-green-4-rgb: 105, 219, 124;--oc-green-5: #51cf66;--oc-green-5-rgb: 81, 207, 102;--oc-green-6: #40c057;--oc-green-6-rgb: 64, 192, 87;--oc-green-7: #37b24d;--oc-green-7-rgb: 55, 178, 77;--oc-green-8: #2f9e44;--oc-green-8-rgb: 47, 158, 68;--oc-green-9: #2b8a3e;--oc-green-9-rgb: 43, 138, 62;--oc-lime-0: #f4fce3;--oc-lime-0-rgb: 244, 252, 227;--oc-lime-1: #e9fac8;--oc-lime-1-rgb: 233, 250, 200;--oc-lime-2: #d8f5a2;--oc-lime-2-rgb: 216, 245, 162;--oc-lime-3: #c0eb75;--oc-lime-3-rgb: 192, 235, 117;--oc-lime-4: #a9e34b;--oc-lime-4-rgb: 169, 227, 75;--oc-lime-5: #94d82d;--oc-lime-5-rgb: 148, 216, 45;--oc-lime-6: #82c91e;--oc-lime-6-rgb: 130, 201, 30;--oc-lime-7: #74b816;--oc-lime-7-rgb: 116, 184, 22;--oc-lime-8: #66a80f;--oc-lime-8-rgb: 102, 168, 15;--oc-lime-9: #5c940d;--oc-lime-9-rgb: 92, 148, 13;--oc-yellow-0: #fff9db;--oc-yellow-0-rgb: 255, 249, 219;--oc-yellow-1: #fff3bf;--oc-yellow-1-rgb: 255, 243, 191;--oc-yellow-2: #ffec99;--oc-yellow-2-rgb: 255, 236, 153;--oc-yellow-3: #ffe066;--oc-yellow-3-rgb: 255, 224, 102;--oc-yellow-4: #ffd43b;--oc-yellow-4-rgb: 255, 212, 59;--oc-yellow-5: #fcc419;--oc-yellow-5-rgb: 252, 196, 25;--oc-yellow-6: #fab005;--oc-yellow-6-rgb: 250, 176, 5;--oc-yellow-7: #f59f00;--oc-yellow-7-rgb: 245, 159, 0;--oc-yellow-8: #f08c00;--oc-yellow-8-rgb: 240, 140, 0;--oc-yellow-9: #e67700;--oc-yellow-9-rgb: 230, 119, 0;--oc-orange-0: #fff4e6;--oc-orange-0-rgb: 255, 244, 230;--oc-orange-1: #ffe8cc;--oc-orange-1-rgb: 255, 232, 204;--oc-orange-2: #ffd8a8;--oc-orange-2-rgb: 255, 216, 168;--oc-orange-3: #ffc078;--oc-orange-3-rgb: 255, 192, 120;--oc-orange-4: #ffa94d;--oc-orange-4-rgb: 255, 169, 77;--oc-orange-5: #ff922b;--oc-orange-5-rgb: 255, 146, 43;--oc-orange-6: #fd7e14;--oc-orange-6-rgb: 253, 126, 20;--oc-orange-7: #f76707;--oc-orange-7-rgb: 247, 103, 7;--oc-orange-8: #e8590c;--oc-orange-8-rgb: 232, 89, 12;--oc-orange-9: #d9480f;--oc-orange-9-rgb: 217, 72, 15}/*! reasonable colors v0.4.0 | MIT License | https://github.com/matthewhowell/reasonable-colors */:root{--color-gray-1: #f6f6f6;--color-gray-2: #e2e2e2;--color-gray-3: #8b8b8b;--color-gray-4: #6f6f6f;--color-gray-5: #3e3e3e;--color-gray-6: #222222;--color-rose-1: #fff7f9;--color-rose-2: #ffdce5;--color-rose-3: #ff3b8d;--color-rose-4: #db0072;--color-rose-5: #800040;--color-rose-6: #4c0023;--color-raspberry-1: #fff8f8;--color-raspberry-2: #ffdddf;--color-raspberry-3: #ff426c;--color-raspberry-4: #de0051;--color-raspberry-5: #82002c;--color-raspberry-6: #510018;--color-red-1: #fff8f6;--color-red-2: #ffddd8;--color-red-3: #ff4647;--color-red-4: #e0002b;--color-red-5: #830014;--color-red-6: #530003;--color-orange-1: #fff8f5;--color-orange-2: #ffded1;--color-orange-3: #fd4d00;--color-orange-4: #cd3c00;--color-orange-5: #752100;--color-orange-6: #401600;--color-cinnamon-1: #fff8f3;--color-cinnamon-2: #ffdfc6;--color-cinnamon-3: #d57300;--color-cinnamon-4: #ac5c00;--color-cinnamon-5: #633300;--color-cinnamon-6: #371d00;--color-amber-1: #fff8ef;--color-amber-2: #ffe0b2;--color-amber-3: #b98300;--color-amber-4: #926700;--color-amber-5: #523800;--color-amber-6: #302100;--color-yellow-1: #fff9e5;--color-yellow-2: #ffe53e;--color-yellow-3: #9c8b00;--color-yellow-4: #7d6f00;--color-yellow-5: #463d00;--color-yellow-6: #292300;--color-lime-1: #f7ffac;--color-lime-2: #d5f200;--color-lime-3: #819300;--color-lime-4: #677600;--color-lime-5: #394100;--color-lime-6: #222600;--color-chartreuse-1: #e5ffc3;--color-chartreuse-2: #98fb00;--color-chartreuse-3: #5c9b00;--color-chartreuse-4: #497c00;--color-chartreuse-5: #264500;--color-chartreuse-6: #182600;--color-green-1: #e0ffd9;--color-green-2: #72ff6c;--color-green-3: #00a21f;--color-green-4: #008217;--color-green-5: #004908;--color-green-6: #062800;--color-emerald-1: #dcffe6;--color-emerald-2: #5dffa2;--color-emerald-3: #00a05a;--color-emerald-4: #008147;--color-emerald-5: #004825;--color-emerald-6: #002812;--color-aquamarine-1: #daffef;--color-aquamarine-2: #42ffc6;--color-aquamarine-3: #009f78;--color-aquamarine-4: #007f5f;--color-aquamarine-5: #004734;--color-aquamarine-6: #00281b;--color-teal-1: #d7fff7;--color-teal-2: #00ffe4;--color-teal-3: #009e8c;--color-teal-4: #007c6e;--color-teal-5: #00443c;--color-teal-6: #002722;--color-cyan-1: #c4fffe;--color-cyan-2: #00fafb;--color-cyan-3: #00999a;--color-cyan-4: #007a7b;--color-cyan-5: #004344;--color-cyan-6: #002525;--color-powder-1: #dafaff;--color-powder-2: #8df0ff;--color-powder-3: #0098a9;--color-powder-4: #007987;--color-powder-5: #004048;--color-powder-6: #002227;--color-sky-1: #e3f7ff;--color-sky-2: #aee9ff;--color-sky-3: #0094b4;--color-sky-4: #007590;--color-sky-5: #00404f;--color-sky-6: #001f28;--color-cerulean-1: #e8f6ff;--color-cerulean-2: #b9e3ff;--color-cerulean-3: #0092c5;--color-cerulean-4: #00749d;--color-cerulean-5: #003c54;--color-cerulean-6: #001d2a;--color-azure-1: #e8f2ff;--color-azure-2: #c6e0ff;--color-azure-3: #008fdb;--color-azure-4: #0071af;--color-azure-5: #003b5e;--color-azure-6: #001c30;--color-blue-1: #f0f4ff;--color-blue-2: #d4e0ff;--color-blue-3: #0089fc;--color-blue-4: #006dca;--color-blue-5: #00386d;--color-blue-6: #001a39;--color-indigo-1: #f3f3ff;--color-indigo-2: #deddff;--color-indigo-3: #657eff;--color-indigo-4: #0061fc;--color-indigo-5: #00328a;--color-indigo-6: #001649;--color-violet-1: #f7f1ff;--color-violet-2: #e8daff;--color-violet-3: #9b70ff;--color-violet-4: #794aff;--color-violet-5: #2d0fbf;--color-violet-6: #0b0074;--color-purple-1: #fdf4ff;--color-purple-2: #f7d9ff;--color-purple-3: #d150ff;--color-purple-4: #b01fe3;--color-purple-5: #660087;--color-purple-6: #3a004f;--color-magenta-1: #fff3fc;--color-magenta-2: #ffd7f6;--color-magenta-3: #f911e0;--color-magenta-4: #ca00b6;--color-magenta-5: #740068;--color-magenta-6: #44003c;--color-pink-1: #fff7fb;--color-pink-2: #ffdcec;--color-pink-3: #ff2fb2;--color-pink-4: #d2008f;--color-pink-5: #790051;--color-pink-6: #4b0030}warning-list{background:var(--color-yellow-1);border-left:4px solid var(--color-yellow-2);color:var(--color-yellow-4);display:block;font-family:var(--font-system);padding:.5em}warning-list[hidden]{display:none}warning-list ul{list-style-type:none;margin:0;padding-left:0}inline-button{cursor:pointer}\n\n</style></head><body><state-css-variables><state-dark-theme-css-overrides><div id=\"backdrop\"><page-skip><div id=\"page\" aria-live=\"polite\"><marginal-content role=\"banner\" type=\"header\"></marginal-content><body-content role=\"main\"></body-content><warning-list></warning-list><marginal-content role=\"contentinfo\" type=\"footer\"></marginal-content><error-handler></error-handler><page-skip-indicator></page-skip-indicator></div></page-skip></div></state-dark-theme-css-overrides></state-css-variables><external-fonts></external-fonts><noscript>This requires JavaScript.</noscript></body>{{STORY_DATA}}</html>","author":"Chris Klimas","description":"A Twine story format emphasizing ease of authoring, multimedia, and playability on many different types of devices. Visit the <a href=\"https://klembot.github.io/chapbook/guide/\">guide</a> for more information.","hydrate":"(function(l){\"use strict\";function r(){return{startState(){return{inVarsSection:!1}},token(e,t){if(t.hasVarsSection===void 0){for(let n=1,o=e.lookAhead(1);o&&t.hasVarsSection===void 0;o=e.lookAhead(++n))o===\"--\"&&(t.hasVarsSection=!0,t.inVarsSection=!0);t.hasVarsSection===void 0&&(t.hasVarsSection=!1)}return t.hasVarsSection&&t.inVarsSection&&e.sol()?e.match(/^--$/)?(t.inVarsSection=!1,e.skipToEnd(),\"punctuation\"):e.skipTo(\":\")?(e.next(),\"def\"):(e.skipToEnd(),\"text\"):e.sol()&&e.match(/^\\[[^[].*\\]$/)||e.match(/^\\{.+?\\}/)?\"keyword\":e.match(/^\\[\\[[^\\]]+?\\]\\]/)?\"link\":(e.eatWhile(/[^[{]/)||e.skipToEnd(),\"text\")}}}function c(e){return Object.keys(e).reduce((t,n)=>({...t,[n]:o=>{o.replaceSelection(e[n]),o.focus()}}),{})}function d(e){return Object.keys(e).reduce((t,n)=>({...t,[n]:o=>{const{matcher:i,wrapper:v}=e[n];o.replaceSelections(o.getSelections().map(s=>i.test(s)?s.replace(i,\"$1\"):v(s)),\"around\"),o.focus()}}),{})}const b={...d({boldText:{matcher:/^(?:__|\\*\\*)(.+)(?:__|\\*\\*)$/,wrapper:e=>`**${e}**`},italicText:{matcher:/^(?:_|\\*)(.+)(?:_|\\*)$/,wrapper:e=>`*${e}*`},monospacedText:{matcher:/^`(.+)`$/,wrapper:e=>\"`\"+e+\"`\"},smallCapsText:{matcher:/^~~(.+)~~$/,wrapper:e=>`~~${e}~~`}}),...c({insertAfter:`\n[after 1 second]\nText\n\n[continued]`,insertAppend:`\n[append]\n`,insertBlockquote:`\n<blockquote>Text</blockquote>\n`,insertContinue:`\n[continued]\n`,insertBulletedList:`\n- Item\n- Item\n`,insertCss:`\n[CSS]\n.page article {\n  color: green;\n}\n\n[continued]\n`,insertCyclingLink:\"{cycling link for: 'variable name', choices: ['choice', 'choice']}\",insertDropdownMenu:\"{dropdown menu for: 'variable name', choices: ['choice', 'choice']}\",insertEmbedAmbientSound:\"{ambient sound: 'sound name'}\",insertEmbedSoundEffect:\"{sound effect: 'sound name'}\",insertEmbedPassage:\"{embed passage: 'Passage name'}\",insertEmbedYouTubeVideo:\"{embed YouTube video: 'URL'}\",insertImageFlickr:\"{embed Flickr image: 'Flickr embed code'}\",insertImageUrl:\"{embed image: 'URL to image'}\",insertImageUnsplash:\"{embed Unsplash image: }\",insertForkList:`\n> Link\n> Link\n`,insertIf:`\n[if condition]\nText\n\n[continue]\n`,insertIfElse:`\n[if condition]\nText\n\n[else]Text\n\n[continued]\n`,insertJs:`\n[JavaScript]\nwrite('Hello from JavaScript');\n\n[continued]\n`,insertNote:`\n[note]\nNote to self\n\n[continued]\n`,insertNumberedList:`\n1. Item\n2. Item\n`,insertPassageLink:\"{link to: 'Passage name', label: 'Label text'}\",insertRestartLink:\"{restart link, label: 'Label text'}\",insertRevealPassageLink:\"{reveal link: 'Label text', passage: 'Passage name'}\",insertRevealTextLink:\"{restart link: 'Label text', text: 'Displayed text'}\",insertSectionBreak:`\n***\n`,insertTextInput:\"{text input for: 'variable name'}\",insertUnless:`\n[unless condition]\nText\n\n[continued]\n`})},m=`<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon icon-tabler icon-tabler-brackets\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n  <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/>\n  <path d=\"M8 4h-3v16h3\" />\n  <path d=\"M16 4h3v16h-3\" />\n</svg>\n\n\n`,p=`<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon icon-tabler icon-tabler-brush\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n  <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/>\n  <path d=\"M3 21v-4a4 4 0 1 1 4 4h-4\" />\n  <path d=\"M21 3a16 16 0 0 0 -12.8 10.2\" />\n  <path d=\"M21 3a16 16 0 0 1 -10.2 12.8\" />\n  <path d=\"M10.6 9a9 9 0 0 1 4.4 4.4\" />\n</svg>\n\n\n`,u=`<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon icon-tabler icon-tabler-frame\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n  <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/>\n  <path d=\"M4 7l16 0\" />\n  <path d=\"M4 17l16 0\" />\n  <path d=\"M7 4l0 16\" />\n  <path d=\"M17 4l0 16\" />\n</svg>\n\n\n`,h=`<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon icon-tabler icon-tabler-hand-click\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n  <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/>\n  <path d=\"M8 13v-8.5a1.5 1.5 0 0 1 3 0v7.5\" />\n  <path d=\"M11 11.5v-2a1.5 1.5 0 0 1 3 0v2.5\" />\n  <path d=\"M14 10.5a1.5 1.5 0 0 1 3 0v1.5\" />\n  <path d=\"M17 11.5a1.5 1.5 0 0 1 3 0v4.5a6 6 0 0 1 -6 6h-2h.208a6 6 0 0 1 -5.012 -2.7l-.196 -.3c-.312 -.479 -1.407 -2.388 -3.286 -5.728a1.5 1.5 0 0 1 .536 -2.022a1.867 1.867 0 0 1 2.28 .28l1.47 1.47\" />\n  <path d=\"M5 3l-1 -1\" />\n  <path d=\"M4 7h-1\" />\n  <path d=\"M14 3l1 -1\" />\n  <path d=\"M15 6h1\" />\n</svg>\n\n\n`,k=`<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"icon icon-tabler icon-tabler-link\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n  <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\"/>\n  <path d=\"M9 15l6 -6\" />\n  <path d=\"M11 6l.463 -.536a5 5 0 0 1 7.071 7.072l-.534 .464\" />\n  <path d=\"M13 18l-.397 .534a5.068 5.068 0 0 1 -7.127 0a4.972 4.972 0 0 1 0 -7.071l.524 -.463\" />\n</svg>\n\n\n`;function a(e,t){return`data:image/svg+xml;base64,${window.btoa(e.replace(/currentColor/g,t))}`}function g(e,{foregroundColor:t}){const n=e.getDoc().somethingSelected();return[{type:\"menu\",icon:a(p,t),label:\"Style\",items:[{type:\"button\",iconOnly:!0,label:\"Bold\",command:\"boldText\",disabled:!n},{type:\"button\",label:\"Italic\",command:\"italicText\",disabled:!n},{type:\"button\",label:\"Monospaced Text\",command:\"monospacedText\",disabled:!n},{type:\"button\",label:\"Small Caps\",command:\"smallCapsText\",disabled:!n},{type:\"separator\"},{type:\"button\",label:\"Blockquote\",command:\"insertBlockquote\",disabled:n},{type:\"button\",label:\"Bulleted List\",command:\"insertBulletedList\",disabled:n},{type:\"button\",label:\"Fork List\",command:\"insertForkList\",disabled:n},{type:\"button\",label:\"Numbered List\",command:\"insertNumberedList\",disabled:n},{type:\"button\",label:\"Section Break\",command:\"insertSectionBreak\",disabled:n}]},{type:\"menu\",icon:a(k,t),label:\"Link\",disabled:n,items:[{type:\"button\",label:\"Passage Link\",command:\"insertPassageLink\"},{type:\"button\",label:\"Restart Link\",command:\"insertRestartLink\"},{type:\"button\",label:\"Reveal Passage Link\",command:\"insertRevealPassageLink\"},{type:\"button\",label:\"Reveal Text Link\",command:\"insertRevealTextLink\"}]},{type:\"menu\",icon:a(m,t),label:\"Modifiers\",disabled:n,items:[{type:\"button\",label:\"If\",command:\"insertIf\"},{type:\"button\",label:\"If and Else\",command:\"insertIfElse\"},{type:\"button\",label:\"Unless\",command:\"insertUnless\"},{type:\"button\",label:\"Continue\",command:\"insertContinue\"},{type:\"separator\"},{type:\"button\",label:\"After Delay\",command:\"insertAfter\"},{type:\"button\",label:\"Append Text\",command:\"insertAppend\"},{type:\"button\",label:\"Note\",command:\"insertNote\"},{type:\"separator\"},{type:\"button\",label:\"JavaScript\",command:\"insertJs\"},{type:\"button\",label:\"CSS\",command:\"insertCss\"}]},{type:\"menu\",icon:a(u,t),label:\"Embed\",disabled:n,items:[{type:\"button\",label:\"Embed Passage\",command:\"insertEmbedPassage\"},{type:\"button\",label:\"Embed Image from Flickr\",command:\"insertImageFlickr\"},{type:\"button\",label:\"Embed Image from URL\",command:\"insertImageUrl\"},{type:\"button\",label:\"Embed Image from Unsplash\",command:\"insertImageUnsplash\"},{type:\"button\",label:\"Embed Ambient Sound\",command:\"insertEmbedAmbientSound\"},{type:\"button\",label:\"Embed Sound Effect\",command:\"insertEmbedSoundEffect\"},{type:\"button\",label:\"Embed YouTube Video\",command:\"insertEmbedYouTubeVideo\"}]},{type:\"menu\",icon:a(h,t),label:\"Input\",disabled:n,items:[{type:\"button\",label:\"Cycling Link\",command:\"insertCyclingLink\"},{type:\"button\",label:\"Dropdown Menu\",command:\"insertDropdownMenu\"},{type:\"button\",label:\"Text Input\",command:\"insertTextInput\"}]}]}function f(e){const t=[/\\{embed\\s+passage\\s*:\\s*['\"](.+?)['\"]\\s*}/g,/\\{link\\s+to\\s*:\\s*['\"](.+?)['\"]\\s*\\}/g,/\\{reveal\\s+link.+passage\\s*:\\s*['\"](.+?)['\"].*\\}/g],n=[];for(const o of t){let i;for(;i=o.exec(e);)n.push(i[1])}return n}l.editorExtensions={twine:{\"^2.4.0-beta2\":{codeMirror:{commands:b,mode:r,toolbar:g},references:{parsePassageText:f}}}}})(this);\n","image":"logo.svg","name":"Chapbook","proofing":false,"version":"2.2.0"})