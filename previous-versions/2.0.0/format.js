window.storyFormat({"source":"<!doctype html><html><head><title>{{STORY_NAME}}</title><meta charset=\"utf-8\"/><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/><script type=\"module\" crossorigin>\nvar Un=Object.defineProperty;var Vn=(t,e,n)=>e in t?Un(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Z=(t,e,n)=>(Vn(t,typeof e!=\"symbol\"?e+\"\":e,n),n),vt=(t,e,n)=>{if(!e.has(t))throw TypeError(\"Cannot \"+n)};var he=(t,e,n)=>(vt(t,e,\"read from private field\"),n?n.call(t):e.get(t)),$t=(t,e,n)=>{if(e.has(t))throw TypeError(\"Cannot add the same private member more than once\");e instanceof WeakSet?e.add(t):e.set(t,n)},St=(t,e,n,i)=>(vt(t,e,\"write to private field\"),i?i.call(t,n):e.set(t,n),n);(function(){const e=document.createElement(\"link\").relList;if(e&&e.supports&&e.supports(\"modulepreload\"))return;for(const r of document.querySelectorAll('link[rel=\"modulepreload\"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type===\"childList\")for(const l of s.addedNodes)l.tagName===\"LINK\"&&l.rel===\"modulepreload\"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin===\"use-credentials\"?s.credentials=\"include\":r.crossOrigin===\"anonymous\"?s.credentials=\"omit\":s.credentials=\"same-origin\",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const Zn={\"config.logger.show.parse\":!1,\"config.logger.show.render\":!1,\"config.logger.show.sound\":!1,\"config.logger.show.state\":!1,\"config.logger.show.story\":!1,\"config.logger.show.style\":!1};function Gt(t){return t+\": \"}const Me={inserts:!0};function Gn(t){Me[t]=!1}function Jn(t){Me[t]=!0}function Jt(t,e){Me[t]&&(console.log(Gt(t)+e),window.dispatchEvent(new CustomEvent(\"log-info\",{detail:{message:e,source:t}})))}function Xt(t,e){Me[t]&&(console.warn(Gt(t)+e),window.dispatchEvent(new CustomEvent(\"log-warning\",{detail:{message:e,source:t}})))}function F(t){return{log(e){Jt(t,e)},warn(e){Xt(t,e)}}}function Xn(){window.addEventListener(\"state-change\",t=>{const e=/^config\\.logger\\.show\\.(.+)$/.exec(t.detail.name);e&&e[1]&&(t.detail.value?Jn(e[1]):Gn(e[1]))})}var Wn=typeof global==\"object\"&&global&&global.Object===Object&&global;const Qn=Wn;var Kn=typeof self==\"object\"&&self&&self.Object===Object&&self,Yn=Qn||Kn||Function(\"return this\")();const tt=Yn;var ei=tt.Symbol;const le=ei;var Wt=Object.prototype,ti=Wt.hasOwnProperty,ni=Wt.toString,pe=le?le.toStringTag:void 0;function ii(t){var e=ti.call(t,pe),n=t[pe];try{t[pe]=void 0;var i=!0}catch{}var r=ni.call(t);return i&&(e?t[pe]=n:delete t[pe]),r}var ri=Object.prototype,si=ri.toString;function oi(t){return si.call(t)}var ai=\"[object Null]\",li=\"[object Undefined]\",Et=le?le.toStringTag:void 0;function Qt(t){return t==null?t===void 0?li:ai:Et&&Et in Object(t)?ii(t):oi(t)}function ci(t){return t!=null&&typeof t==\"object\"}var ui=\"[object Symbol]\";function nt(t){return typeof t==\"symbol\"||ci(t)&&Qt(t)==ui}function fi(t,e){for(var n=-1,i=t==null?0:t.length,r=Array(i);++n<i;)r[n]=e(t[n],n,t);return r}var di=Array.isArray;const it=di;var hi=1/0,_t=le?le.prototype:void 0,Ct=_t?_t.toString:void 0;function Kt(t){if(typeof t==\"string\")return t;if(it(t))return fi(t,Kt)+\"\";if(nt(t))return Ct?Ct.call(t):\"\";var e=t+\"\";return e==\"0\"&&1/t==-hi?\"-0\":e}function Pe(t){var e=typeof t;return t!=null&&(e==\"object\"||e==\"function\")}var pi=\"[object AsyncFunction]\",gi=\"[object Function]\",mi=\"[object GeneratorFunction]\",bi=\"[object Proxy]\";function yi(t){if(!Pe(t))return!1;var e=Qt(t);return e==gi||e==mi||e==pi||e==bi}var wi=tt[\"__core-js_shared__\"];const qe=wi;var At=function(){var t=/[^.]+$/.exec(qe&&qe.keys&&qe.keys.IE_PROTO||\"\");return t?\"Symbol(src)_1.\"+t:\"\"}();function ki(t){return!!At&&At in t}var xi=Function.prototype,vi=xi.toString;function $i(t){if(t!=null){try{return vi.call(t)}catch{}try{return t+\"\"}catch{}}return\"\"}var Si=/[\\\\^$.*+?()[\\]{}|]/g,Ei=/^\\[object .+?Constructor\\]$/,_i=Function.prototype,Ci=Object.prototype,Ai=_i.toString,Ti=Ci.hasOwnProperty,Li=RegExp(\"^\"+Ai.call(Ti).replace(Si,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\");function zi(t){if(!Pe(t)||ki(t))return!1;var e=yi(t)?Li:Ei;return e.test($i(t))}function Pi(t,e){return t==null?void 0:t[e]}function rt(t,e){var n=Pi(t,e);return zi(n)?n:void 0}var Oi=function(){try{var t=rt(Object,\"defineProperty\");return t({},\"\",{}),t}catch{}}();const Tt=Oi;var Ii=9007199254740991,Ni=/^(?:0|[1-9]\\d*)$/;function Mi(t,e){var n=typeof t;return e=e??Ii,!!e&&(n==\"number\"||n!=\"symbol\"&&Ni.test(t))&&t>-1&&t%1==0&&t<e}function Ri(t,e,n){e==\"__proto__\"&&Tt?Tt(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Yt(t,e){return t===e||t!==t&&e!==e}var Di=Object.prototype,ji=Di.hasOwnProperty;function Hi(t,e,n){var i=t[e];(!(ji.call(t,e)&&Yt(i,n))||n===void 0&&!(e in t))&&Ri(t,e,n)}var qi=/\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,Fi=/^\\w*$/;function Bi(t,e){if(it(t))return!1;var n=typeof t;return n==\"number\"||n==\"symbol\"||n==\"boolean\"||t==null||nt(t)?!0:Fi.test(t)||!qi.test(t)||e!=null&&t in Object(e)}var Ui=rt(Object,\"create\");const ye=Ui;function Vi(){this.__data__=ye?ye(null):{},this.size=0}function Zi(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Gi=\"__lodash_hash_undefined__\",Ji=Object.prototype,Xi=Ji.hasOwnProperty;function Wi(t){var e=this.__data__;if(ye){var n=e[t];return n===Gi?void 0:n}return Xi.call(e,t)?e[t]:void 0}var Qi=Object.prototype,Ki=Qi.hasOwnProperty;function Yi(t){var e=this.__data__;return ye?e[t]!==void 0:Ki.call(e,t)}var er=\"__lodash_hash_undefined__\";function tr(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ye&&e===void 0?er:e,this}function ee(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}ee.prototype.clear=Vi;ee.prototype.delete=Zi;ee.prototype.get=Wi;ee.prototype.has=Yi;ee.prototype.set=tr;function nr(){this.__data__=[],this.size=0}function Re(t,e){for(var n=t.length;n--;)if(Yt(t[n][0],e))return n;return-1}var ir=Array.prototype,rr=ir.splice;function sr(t){var e=this.__data__,n=Re(e,t);if(n<0)return!1;var i=e.length-1;return n==i?e.pop():rr.call(e,n,1),--this.size,!0}function or(t){var e=this.__data__,n=Re(e,t);return n<0?void 0:e[n][1]}function ar(t){return Re(this.__data__,t)>-1}function lr(t,e){var n=this.__data__,i=Re(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this}function fe(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}fe.prototype.clear=nr;fe.prototype.delete=sr;fe.prototype.get=or;fe.prototype.has=ar;fe.prototype.set=lr;var cr=rt(tt,\"Map\");const ur=cr;function fr(){this.size=0,this.__data__={hash:new ee,map:new(ur||fe),string:new ee}}function dr(t){var e=typeof t;return e==\"string\"||e==\"number\"||e==\"symbol\"||e==\"boolean\"?t!==\"__proto__\":t===null}function De(t,e){var n=t.__data__;return dr(e)?n[typeof e==\"string\"?\"string\":\"hash\"]:n.map}function hr(t){var e=De(this,t).delete(t);return this.size-=e?1:0,e}function pr(t){return De(this,t).get(t)}function gr(t){return De(this,t).has(t)}function mr(t,e){var n=De(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this}function ie(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}ie.prototype.clear=fr;ie.prototype.delete=hr;ie.prototype.get=pr;ie.prototype.has=gr;ie.prototype.set=mr;var br=\"Expected a function\";function st(t,e){if(typeof t!=\"function\"||e!=null&&typeof e!=\"function\")throw new TypeError(br);var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],s=n.cache;if(s.has(r))return s.get(r);var l=t.apply(this,i);return n.cache=s.set(r,l)||s,l};return n.cache=new(st.Cache||ie),n}st.Cache=ie;var yr=500;function wr(t){var e=st(t,function(i){return n.size===yr&&n.clear(),i}),n=e.cache;return e}var kr=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g,xr=/\\\\(\\\\)?/g,vr=wr(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(\"\"),t.replace(kr,function(n,i,r,s){e.push(r?s.replace(xr,\"$1\"):i||n)}),e});const $r=vr;function ot(t){return t==null?\"\":Kt(t)}function at(t,e){return it(t)?t:Bi(t,e)?[t]:$r(ot(t))}var Sr=1/0;function lt(t){if(typeof t==\"string\"||nt(t))return t;var e=t+\"\";return e==\"0\"&&1/t==-Sr?\"-0\":e}function en(t,e){e=at(e,t);for(var n=0,i=e.length;t!=null&&n<i;)t=t[lt(e[n++])];return n&&n==i?t:void 0}function Fe(t,e,n){var i=t==null?void 0:en(t,e);return i===void 0?n:i}function Er(t,e,n){var i=-1,r=t.length;e<0&&(e=-e>r?0:r+e),n=n>r?r:n,n<0&&(n+=r),r=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(r);++i<r;)s[i]=t[i+e];return s}function tn(t){return function(e){return t==null?void 0:t[e]}}function _r(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}var Cr={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\"},Ar=tn(Cr);const Tr=Ar;var nn=/[&<>\"']/g,Lr=RegExp(nn.source);function q(t){return t=ot(t),t&&Lr.test(t)?t.replace(nn,Tr):t}function zr(t,e){return e.length<2?t:en(t,Er(e,0,-1))}function Pr(t,e){return e=at(e,t),t=zr(t,e),t==null||delete t[lt(_r(e))]}function Or(t,e,n,i){if(!Pe(t))return t;e=at(e,t);for(var r=-1,s=e.length,l=s-1,a=t;a!=null&&++r<s;){var o=lt(e[r]),c=n;if(o===\"__proto__\"||o===\"constructor\"||o===\"prototype\")return t;if(r!=l){var u=a[o];c=i?i(u,o,a):void 0,c===void 0&&(c=Pe(u)?u:Mi(e[r+1])?[]:{})}Hi(a,o,c),a=a[o]}return t}function ct(t,e,n){return t==null?t:Or(t,e,n)}var Ir={\"&amp;\":\"&\",\"&lt;\":\"<\",\"&gt;\":\">\",\"&quot;\":'\"',\"&#39;\":\"'\"},Nr=tn(Ir);const Mr=Nr;var rn=/&(?:amp|lt|gt|quot|#39);/g,Rr=RegExp(rn.source);function Dr(t){return t=ot(t),t&&Rr.test(t)?t.replace(rn,Mr):t}function jr(t,e){return t==null?!0:Pr(t,e)}const sn=F(\"story\"),z={customScripts:[],customStyles:[],passages:[]};function on(t){for(const i of[\"name\",\"creator\",\"ifid\",\"options\"])z[i]=t.getAttribute(i)??void 0;const e=parseInt(t.getAttribute(\"startnode\")??\"\");isNaN(e)||(z.startNode=e),z.creatorVersion=t.getAttribute(\"creator-version\")??void 0;const n=i=>[...i].map(r=>r.textContent??\"\");z.customScripts=n(t.querySelectorAll('[type=\"text/twine-javascript\"]')),z.customStyles=n(t.querySelectorAll('[type=\"text/twine-css\"]')),z.passages=[...t.querySelectorAll(\"tw-passagedata\")].map(i=>{const r=parseInt(i.getAttribute(\"pid\")??\"\"),s=i.getAttribute(\"tags\");return{id:isNaN(r)?void 0:r,name:i.getAttribute(\"name\")??void 0,source:i.textContent??\"\",tags:s?s.split(\" \"):[]}})}function an(){const t=ft();if(!t||!t.name)throw new Error(\"There is no starting passage for this story, or it has no name.\");re({trail:[t.name],\"config.testing\":typeof z.options==\"string\"&&z.options.indexOf(\"debug\")!==-1||!1}),z.name&&(document.title=z.name)}function Hr(){sn.log(`Running custom scripts (${z.customScripts.length})`);for(const t of z.customScripts)new Function(t).apply(window)}function qr(){sn.log(`Adding custom styles (${z.customStyles.length})`);for(const t of z.customStyles){const e=document.createElement(\"style\");e.innerHTML=t,document.head.appendChild(e)}}function ln(){return z.ifid}function ut(){return z.name}function Fr(){return z.passages}function ft(){return z.passages.find(t=>t.id===z.startNode)}function $e(t){return z.passages.find(e=>e.name===t)}function Br(t){return z.passages.find(e=>e.id===t)}function cn(t){let e=[],n=!1;return async(...i)=>{n||(n=!0,Promise.resolve().then(()=>{try{t(e),e=[],n=!1}catch(r){window.setTimeout(()=>{throw r})}})),e.push(i)}}function we(t,e,n=[]){const i=document.createElement(t);if(e)for(const r of Object.keys(e))e[r]!==void 0&&i.setAttribute(r,e[r]);for(const r of n)typeof r==\"string\"||typeof r==\"number\"?i.appendChild(document.createTextNode(r.toString())):i.appendChild(r);return i}function j(...t){return we(...t).outerHTML}function Ze(t){return Array.isArray(t)?t.every(Ze):t===null?!0:typeof t==\"object\"?Object.getPrototypeOf(t)!==Object.prototype?!1:Object.values(t).every(Ze):typeof t==\"number\"?isFinite(t)&&!isNaN(t):[\"boolean\",\"string\",\"undefined\"].includes(typeof t)}const{log:Q,warn:Ur}=F(\"state\");let te;const dt={},un={},ce={};function ht(t,e){if(t[e])return;Object.defineProperty(t,e,{get(){return m(e)},set(i){E(e,i)},configurable:!0});const n=e.split(\".\");n.length>1&&(n.pop(),ht(t,n.join(\".\")))}function Vr(t,e){if(t[e])return;const n=e.split(\".\"),i=n[n.length-1];for(let r=0;r<n.length-1;r++)t[n[r]]=t[n[r]]||{},t=t[n[r]];Object.defineProperty(t,i,{get(){return m(e)},set(){throw new Error(\"Chapbook lookup variables may only be read.\")},configurable:!0})}function Zr(t,e){jr(t,e)}function fn(){const t=ln(),e=ut();if(e===void 0)throw new Error(\"Cannot set up state: the story has no name\");te=`chapbook-${e}-${t}`,je(\"config.state.autosave\",!0)}function pt(){function t(e,n){Object.keys(e).forEach(i=>{const r=n===\"\"?i:`${n}.${i}`;if(typeof e[i]==\"object\"&&!Array.isArray(e[i]))t(e[i],r);else{const s=e[i];delete e[i],Zr(window,n),window.dispatchEvent(new CustomEvent(\"state-change\",{detail:{name:r,value:m(r),previous:s}}))}})}t(ce,\"\"),window.dispatchEvent(new CustomEvent(\"state-reset\")),m(\"config.state.autosave\")&&gt()}function E(t,e){const n=m(t);Ze(e)||Ur(`Setting ${t} to ${JSON.stringify(e)} can't be saved permanently. This will work in the current session, but will not persist between sessions.`),ct(ce,t,e),ht(window,t),e!==n&&window.dispatchEvent(new CustomEvent(\"state-change\",{detail:{previous:n,name:t,value:e}})),m(\"config.state.autosave\")&&gt()}function je(t,e){const n=m(t);Q(`Defaulting \"${t}\" to ${JSON.stringify(e)}`),ct(dt,t,e),ht(window,t),n==null&&window.dispatchEvent(new CustomEvent(\"state-change\",{detail:{previous:n,name:t,value:e}}))}function re(t){for(const e in t)je(e,t[e])}function L(t,e){const n=m(t);Q(`Adding lookup variable ${t}`),ct(un,t,e),Vr(window,t),n==null&&window.dispatchEvent(new CustomEvent(\"state-change\",{detail:{previous:n,name:t,value:m(t)}}))}function m(t){const e=Fe(un,t);if(typeof e==\"function\")return e(m,E);const n=Fe(ce,t),i=Fe(dt,t);if(n==null)return i;if(typeof n==\"object\"&&n!==null&&!Array.isArray(n)&&typeof i==\"object\"&&i!==null&&!Array.isArray(i)){const r={},s=[...Object.keys(i),...Object.keys(n)];for(const l of s)Object.defineProperty(r,l,{get(){return m(t+\".\"+l)},set(a){E(t+\".\"+l,a)},configurable:!0,enumerable:!0});return r}return n}function ke(){return{...ce}}function Se(t){pt();for(const e in t)E(e,t[e])}function dn(){try{return window.localStorage.setItem(\"chapbook-test\",\"a\"),window.localStorage.removeItem(\"chapbook-test\"),!0}catch{return!1}}function gt(){Q(\"Saving to local storage: \"+JSON.stringify(ke())),window.localStorage.setItem(te,JSON.stringify(ke())),Q(\"Save complete\")}function hn(){return dn()&&window.localStorage.getItem(te)!==null}function pn(){Q(\"Restoring variables from local storage\");const t=window.localStorage.getItem(te);if(!t)throw new Error(`No value is set in local storage at \"${te}\"`);Se(JSON.parse(t)),Q(\"Restore complete\")}function gn(t){t||Q(\"Purging variables from local storage\");const e=window.localStorage.getItem(te);if(!e)throw new Error(`No value is set in local storage at \"${te}\"`);Se(JSON.parse(e)),t||Q(\"Purge complete\")}function mn(t){function e(n,i,r=[]){return Object.keys(n).reduce((s,l)=>{if(typeof n[l]==\"object\"&&n[l]&&!Array.isArray(n[l]))e(n[l],i?`${i}.${l}`:l,s);else{const a=i?`${i}.${l}`:l;s.includes(a)||s.push(a)}return s},r)}return t?e(dt,void 0,e(ce)).sort():e(ce).sort()}const Gr=Object.freeze(Object.defineProperty({__proto__:null,canRestoreFromStorage:hn,canSaveToStorage:dn,get:m,initState:fn,purgeFromStorage:gn,reset:pt,restoreFromObject:Se,restoreFromStorage:pn,saveToObject:ke,saveToStorage:gt,set:E,setDefault:je,setDefaults:re,setLookup:L,varNames:mn},Symbol.toStringTag,{value:\"Module\"})),Jr=Object.freeze(Object.defineProperty({__proto__:null,addCustomStyles:qr,ifid:ln,initStory:an,loadFromData:on,name:ut,passageNamed:$e,passageWithId:Br,passages:Fr,runCustomScripts:Hr,startPassage:ft},Symbol.toStringTag,{value:\"Module\"})),{log:bn}=F(\"actions\");function yn(t){bn(`Going to passage \"${t}\"`);const e=$e(t);if(!e)throw new Error(`There is no passage with the name \"${t}\"`);document.activeElement instanceof HTMLElement&&document.activeElement.blur();const n=m(\"trail\");if(!Array.isArray(n))throw new Error(`The trail variable has been set to a ${typeof n}, not an array.`);E(\"trail\",[...n,e.name])}function wn(){bn(\"Restarting\"),pt(),window.location.reload()}let W=[],Oe=!0;function Xr(){Oe&&(W=[],window.dispatchEvent(new CustomEvent(\"backstage-state-recorder-update\")))}function Wr({detail:t}){if(!Oe)return;W.length===m(\"config.backstage.trail.maxLength\")&&W.shift();const{name:e,value:n}=t;W.push({change:{name:e,value:n},state:ke()}),window.dispatchEvent(new CustomEvent(\"backstage-state-recorder-update\"))}function Qr(){return[...W]}function Kr(t){if(!W[t])throw new Error(`There is no history at index ${t} to rewind to.`);Oe=!1,Se(W[t].state),W.length=t+1,Oe=!0,window.dispatchEvent(new CustomEvent(\"backstage-state-recorder-update\"))}function Yr(){je(\"config.backstage.trail.maxLength\",100),window.addEventListener(\"state-change\",Wr),window.addEventListener(\"state-reset\",Xr)}let U=[];function es(t){U.push({name:t,state:ke()}),kn(),window.dispatchEvent(new CustomEvent(\"backstage-state-snapshots-update\"))}function ts(t){const e=U.find(n=>n.name===t);if(!e)throw new Error(`There is no snapshot named \"${t}\".`);Se(e.state)}function ns(t){U=U.filter(({name:e})=>t!==e),kn(),window.dispatchEvent(new CustomEvent(\"backstage-state-snapshots-update\"))}function is(){try{U=JSON.parse(window.localStorage.getItem(`chapbookbackstage-snapshots-${m(\"config.state.saveKey\")}`)),Array.isArray(U)||(U=[])}catch{U=[]}}function kn(){window.localStorage.setItem(`chapbookbackstage-snapshots-${m(\"config.state.saveKey\")}`,JSON.stringify(U))}function Lt(){return U.map(({name:t})=>t)}function rs(){is()}function mt(t){for(const e in t)window.customElements.get(e)||window.customElements.define(e,t[e])}class P extends HTMLElement{defaultHtml(e){this.innerHTML.trim()===\"\"&&(this.innerHTML=e)}delegate(e,n,i){this.addEventListener(e,r=>{if(!r.target)return;const s=r.target.closest(n);s&&i(r,s)})}query(e){const n=this.querySelector(e);if(!n)throw new Error(`Couldn't find element matching \"${e}\"`);return n}queryAll(e){return[...this.querySelectorAll(e)]}}class xn extends P{constructor(){super(),this.addEventListener(\"click\",e=>{e.target.closest(\"[data-toggle-collapsed]\")&&(this.hasAttribute(\"collapsed\")?this.removeAttribute(\"collapsed\"):this.setAttribute(\"collapsed\",\"\"))})}connectedCallback(){this.innerHTML=`\n\t\t\t<button data-toggle-collapsed></button>\n\t\t\t<div class=\"content\">\n\t\t\t\t<backstage-tabs aria-label=\"Backstage\">\n\t\t\t\t<backstage-tab\n\t\t\t\t\taria-controls=\"backstage-state-tab-panel\"\n\t\t\t\t\tid=\"backstage-state-tab\"\n\t\t\t\t>\n\t\t\t\t\tState\n\t\t\t\t</backstage-tab>\n\t\t\t\t<backstage-tab\n\t\t\t\t\taria-controls=\"backstage-history-tab-panel\"\n\t\t\t\t\tid=\"backstage-history-tab\"\n\t\t\t\t>\n\t\t\t\t\tHistory\n\t\t\t\t</backstage-tab>\n\t\t\t\t<backstage-tab\n\t\t\t\t\taria-controls=\"backstage-style-tab-panel\"\n\t\t\t\t\tid=\"backstage-style-tab\"\n\t\t\t\t>\n\t\t\t\t\tStyle\n\t\t\t\t</backstage-tab>\n\t\t\t\t<backstage-tab\n\t\t\t\t\taria-controls=\"backstage-notes-tab-panel\"\n\t\t\t\t\tid=\"backstage-notes-tab\"\n\t\t\t\t>\n\t\t\t\t\tNotes\n\t\t\t\t</backstage-tab>\n\t\t\t</backstage-tabs>\n\t\t\t<backstage-tab-panel\n\t\t\t\taria-labelledby=\"backstage-state-tab\"\n\t\t\t\tid=\"backstage-state-tab-panel\"\n\t\t\t>\n\t\t\t\t<backstage-state-variables></backstage-state-variables>\n\t\t\t\t<backstage-state-snapshots></backstage-state-snapshots>\n\t\t\t</backstage-tab-panel>\n\t\t\t<backstage-tab-panel\n\t\t\t\taria-labelledby=\"backstage-history-tab\"\n\t\t\t\tid=\"backstage-history-tab-panel\"\n\t\t\t>\n\t\t\t\t<backstage-history-table></backstage-history-table>\n\t\t\t</backstage-tab-panel>\n\t\t\t<backstage-tab-panel\n\t\t\t\taria-labelledby=\"backstage-style-tab\"\n\t\t\t\tid=\"backstage-style-tab-panel\"\n\t\t\t>\n\t\t\t\t<backstage-style-config></backstage-style-config>\n\t\t\t\t<backstage-style-group title=\"Page\" prefix=\"page\"></backstage-style-group>\n\t\t\t\t<backstage-style-group title=\"Header\"></backstage-style-group>\n\t\t\t\t<backstage-style-group title=\"Footer\"></backstage-style-group>\n\t\t\t</backstage-tab-panel>\n\t\t\t<backstage-tab-panel\n\t\t\t\taria-labelledby=\"backstage-notes-tab\"\n\t\t\t\tid=\"backstage-notes-tab-panel\"\n\t\t\t>\n\t\t\t\t<backstage-notes></backstage-notes>\n\t\t\t</backstage-tab-panel>\n\t\t</div>`,this.update()}attributeChangedCallback(){this.update()}update(){const e=this.querySelectorAll(\"[data-toggle-collapsed]\");if(this.hasAttribute(\"collapsed\")){for(const n of e)n.innerHTML=\"&rarr;\",n.setAttribute(\"aria-label\",\"Show Backstage\");document.body.classList.remove(\"backstage-visible\")}else{for(const n of e)n.innerHTML=\"&larr;\",n.setAttribute(\"aria-label\",\"Hide Backstage\");document.body.classList.add(\"backstage-visible\")}}}Z(xn,\"observedAttributes\",[\"collapsed\"]);function ss(t){const e=[];let n=[],i;return t.forEach(({change:r},s)=>{if(r.name===\"trail\"){const l=r.value;e.push({historyIndex:s-1,passage:i,varChanges:n}),n=[],i=l[l.length-1]}else n.push({name:r.name,value:r.value})}),e.push({historyIndex:t.length-1,passage:i,varChanges:n}),e}class os extends P{constructor(){super();Z(this,\"root\",document.createElement(\"div\"));this.delegate(\"click\",\"button[data-rewind]\",(n,i)=>{const r=parseInt(i.dataset.rewind??\"\");isNaN(r)||Kr(r)})}connectedCallback(){window.addEventListener(\"backstage-state-recorder-update\",this),this.update()}disconnectedCallback(){window.removeEventListener(\"backstage-state-recorder-update\",this)}handleEvent(){this.update()}update(){this.innerHTML=ss(Qr()).reduce((n,{historyIndex:i,passage:r,varChanges:s})=>{n+=`\n\t\t\t\t\t<button\n\t\t\t\t\t\tdata-rewind=\"${i}\"\n\t\t\t\t\t\taria-label=\"Rewind to ${r?q(r):\"Startup\"}\">&#x21aa;\n\t\t\t\t\t${r?q(r):\"<em>Startup</em>\"}</button><table><thead><tr><th>Variable</th><th>Value</th></thead><tbody>`;for(const l of s)n+=`\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>${q(l.name)}</td><td>${q(JSON.stringify(l.value))}</td>\n\t\t\t\t\t\t</tr>`;return n+\"</tbody></table>\"},\"\")}}let N={};function as(){N={},bt()}function ls(){const t=Object.keys(N).reduce((n,i)=>n+`<li class=\"note\"><span class=\"passage\">${q(i)}</span><pre>${q(N[i])}</pre></li>`,\"\");let e=m(\"story.name\");return typeof e!=\"string\"&&(e=\"Story\"),`<h1>Notes for &ldquo;${q(e)}&rdquo;</h1><ul data-cb-backstage-notes data-cb-version=\"${m(\"engine.version\")}\">${t}</ul>`}function cs(t){return N[t]}function us(t){const e=document.createElement(\"div\"),n={...N};let i=0;e.innerHTML=t;for(const r of e.querySelectorAll(\"ul[data-cb-backstage-notes] li\")){const s=r.querySelector(\"span.passage\"),l=r.querySelector(\"pre\");s!=null&&s.textContent&&(l!=null&&l.textContent)&&(n[s.textContent]?n[s.textContent]=`${n[s.textContent]??\"\"}\n\n${l.textContent}`:n[s.textContent]=l.textContent,i++)}return N=n,bt(),i}function fs(){const t=window.localStorage.getItem(`chapbookbackstage-passage-notes-${m(\"config.state.saveKey\")}`);try{t&&(N=JSON.parse(t),(typeof N!=\"object\"||Array.isArray(N))&&(N={}))}catch{N={}}}function bt(){window.localStorage.setItem(`chapbookbackstage-passage-notes-${m(\"config.state.saveKey\")}`,JSON.stringify(N))}function ds(t,e){N[t]=e,bt()}function hs(){fs()}function zt(){const t=m(\"trail\");if(Array.isArray(t))return t[t.length-1]}class ps extends P{constructor(){super(),this.delegate(\"change\",'input[type=\"file\"]',e=>{var i;const n=(i=e.target.files)==null?void 0:i[0];if(n){const r=new FileReader;r.onload=s=>{const l=us(s.target.result);window.alert(`${l} note(s) were imported.`)},r.readAsText(n)}}),this.delegate(\"change\",\"textarea\",e=>{const n=zt();n&&ds(n,e.target.value)}),this.delegate(\"click\",\"[data-export]\",()=>{const e=ls(),n=document.createElement(\"a\");m(\"story.name\"),n.setAttribute(\"download\",`${m(\"story.name\")} Notes - ${new Date().toDateString()} ${new Date().toTimeString()}.html`),n.setAttribute(\"href\",\"data:text/html;base64,\"+window.btoa(e)),document.body.appendChild(n),n.click(),document.body.removeChild(n)}),this.delegate(\"click\",\"[data-import]\",()=>{this.query('input[type=\"file\"]').click()}),this.delegate(\"click\",\"[data-reset]\",()=>{window.confirm(\"Are you sure? This will delete all text entered in the Notes panel of Backstage, and cannot be undone.\")&&as()})}connectedCallback(){this.defaultHtml(`\n\t\t\t<label for=\"backstage-notes-textarea\"></label>\n\t\t\t\t<textarea id=\"backstage-notes-textarea\"></textarea>\n\t\t\t\t<div class=\"actions\">\n\t\t\t\t\t<button data-export>Export All Notes</button>\n\t\t\t\t\t<button data-import>Import Notes</button>\n\t\t\t\t\t<button data-reset>Delete All Notes</button>\n\t\t\t\t</div>\n\t\t\t\t<input type=\"file\" hidden />\n\t\t`),window.addEventListener(\"state-change\",this),this.update()}disconnectedCallback(){window.removeEventListener(\"state-change\",this)}handleEvent(e){e.detail.name===\"trail\"&&this.update()}update(){const e=zt();e&&(this.query(\"#backstage-notes-textarea\").value=cs(e)??\"\",this.query('label[for=\"backstage-notes-textarea\"]').textContent=`Notes on \"${e}\"`)}}class gs extends P{constructor(){super(),this.delegate(\"click\",\"[data-add-snapshot]\",()=>{const e=window.prompt(\"Enter a name for this snapshot:\");e&&(Lt().includes(e)?window.alert(\"A snapshot already exists with this name.\"):es(e))}),this.delegate(\"click\",\"[data-remove]\",({target:e})=>{const n=e.dataset.remove;n&&window.confirm(`Are you sure you want to delete the snapshot \"${n}\"? This cannot be undone.`)&&ns(n)}),this.delegate(\"click\",\"[data-restore]\",({target:e})=>{ts(e.dataset.restore)})}connectedCallback(){this.defaultHtml(`\n\t\t\t<details open>\n\t\t\t\t<summary>Snapshots</summary>\n\t\t\t\t<div class=\"snapshots\"></div>\n\t\t\t\t<button data-add-snapshot>Add Snapshot</button>\n\t\t\t</details>\n\t\t`),window.addEventListener(\"backstage-state-snapshots-update\",this),this.update()}disconnectedCallback(){window.removeEventListener(\"backstage-state-snapshots-update\",this)}handleEvent(){this.update()}update(){const e=this.querySelector(\".snapshots\");e&&(e.innerHTML=Lt().map(n=>{const i=q(n);return`\n\t\t\t\t\t<div class=\"snapshot-button\">\n\t\t\t\t\t\t<button data-restore=\"${i}\" aria-label=\"Restore '${i}' snapshot\">\n\t\t\t\t\t\t\t${i}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button data-remove=\"${i}\" aria-label=\"Remove '${i}' snapshot\">\n\t\t\t\t\t\t\t&times;\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div class=\"snapshot-button\">\n\t\t\t\t`}).join(\"\"))}}class ms extends P{constructor(){super();Z(this,\"showDefaults\",!1);this.delegate(\"change\",'input[type=\"checkbox\"]',n=>{this.showDefaults=n.target.checked,this.update()})}connectedCallback(){this.defaultHtml(`\n\t\t\t<details open>\n\t\t\t\t<summary>Variables</summary>\n\t\t\t\t<label>\n\t\t\t\t\t<input type=\"checkbox\" />\n\t\t\t\t\tShow Defaults\n\t\t\t\t</label>\n\t\t\t\t<div class=\"variables\"></div>\n\t\t\t</details>\n\t\t`),this.update(),window.addEventListener(\"state-change\",this)}disconnectedCallback(){window.removeEventListener(\"state-change\",this)}handleEvent(){this.update()}update(){this.query(\".variables\").innerHTML=mn(this.showDefaults).map(n=>`<div><label><span>${q(n)}</span><backstage-variable-input name=\"${q(n)}\"></backstage-variable-input></label></div>`).join(\"\")}}const bs=[\"page\",\"page.header\",\"page.footer\"].reduce((t,e)=>t.concat([`config.style.${e}.font`,`config.style.${e}.color`,`config.style.${e}.link.font`,`config.style.${e}.link.color`,`config.style.${e}.link.lineColor`,`config.style.${e}.link.active.font`,`config.style.${e}.link.active.color`,`config.style.${e}.link.active.lineColor`]),[]);class ys extends P{connectedCallback(){this.defaultHtml(`\n\t\t\t<details open>\n\t\t\t\t<summary>Config</summary>\n\t\t\t\t<label for=\"cb-backstage-style-config\">\n\t\t\t\t\tEnter this code into your first passage&rsquo;s variables section to\n\t\t\t\t\tpermanently use this style:\n\t\t\t\t</label>\n\t\t\t\t<textarea\n\t\t\t\t\treadonly\n\t\t\t\t\tid=\"cb-backstage-style-config\"\n\t\t\t\t></textarea>\n\t\t\t</details>\n\t\t`),window.addEventListener(\"state-change\",this),this.update()}disconnectedCallback(){window.removeEventListener(\"state-change\",this)}handleEvent(){this.update()}update(){this.query(\"textarea\").value=bs.reduce((e,n)=>{const i=m(n);return i?e+`${n}: ${JSON.stringify(i)}\n`:e},\"\").trim()}}const ws=[{name:\"Font\",suffix:\"font\"},{name:\"Color\",suffix:\"color\"},{name:\"Link Font\",suffix:\"link.font\"},{name:\"Link Color\",suffix:\"link.color\"},{name:\"Link Line Color\",suffix:\"link.lineColor\"},{name:\"Active Link Font\",suffix:\"link.active.font\"},{name:\"Active Link Color\",suffix:\"link.active.color\"},{name:\"Active Link Line Color\",suffix:\"link.active.lineColor\"}];class vn extends P{connectedCallback(){const e=this.getAttribute(\"prefix\"),n=this.getAttribute(\"title\");this.defaultHtml(`\n\t\t\t<details open>\n\t\t\t\t<summary>${n}</summary>\n\t\t\t\t${ws.map(({name:i,suffix:r})=>`\n\t\t\t\t\t\t<label data-prefix=\"config.style.%.${r}\">\n\t\t\t\t\t\t\t${i}\n\t\t\t\t\t\t\t<backstage-variable-input name=\"config.style.${e}.${r}\" string />\n\t\t\t\t\t\t</label>\n\t\t\t\t\t`).join(\"\")}\n\t\t\t</details>\n\t\t`)}attributeChangedCallback(e,n,i){var r;if(this.innerHTML!==\"\")switch(e){case\"title\":this.query(\"summary\").innerText=i;break;case\"prefix\":for(const s of this.queryAll(\"backstage-variable-input\")){const l=(r=s.closest(\"[data-prefix]\"))==null?void 0:r.dataset.prefix;l&&s.setAttribute(\"name\",l.replace(\"%\",i))}}}}Z(vn,\"observedAttributes\",[\"prefix\",\"title\"]);class ks extends P{constructor(){super(),this.addEventListener(\"click\",()=>{var e;this.textContent&&((e=this.closest(\"backstage-tabs\"))==null||e.selectTab(this.textContent))})}connectedCallback(){this.setAttribute(\"role\",\"tab\")}}class xs extends P{connectedCallback(){this.setAttribute(\"role\",\"tabpanel\")}}class vs extends P{connectedCallback(){this.setAttribute(\"role\",\"tablist\"),window.setTimeout(()=>this.selectTab(0))}selectTab(e){[...this.children].filter(n=>n.getAttribute(\"role\")===\"tab\").forEach((n,i)=>{var l,a;const r=n.getAttribute(\"aria-controls\"),s=typeof e==\"number\"?i==e:n.textContent===e;n.setAttribute(\"aria-selected\",s.toString()),r&&(s?(l=document.getElementById(r))==null||l.removeAttribute(\"hidden\"):(a=document.getElementById(r))==null||a.setAttribute(\"hidden\",\"\"))})}}class $n extends P{constructor(){super(),this.addEventListener(\"input\",e=>{const n=this.getAttribute(\"name\");if(!n||!e.target)return;const i=e.target.value;try{this.hasAttribute(\"string\")?E(n,i):E(n,JSON.parse(i))}catch{}})}attributeChangedCallback(){const e=this.getAttribute(\"name\");if(!e)return;const n=m(e);let i=JSON.stringify(n);this.hasAttribute(\"string\")&&(n==null?i=\"\":i=n.toString()),this.innerHTML=`<input type=\"text\" value=\"${q(i)}\" />`}}Z($n,\"observedAttributes\",[\"name\",\"string\"]);function $s(){mt({\"backstage-history-table\":os,\"backstage-notes\":ps,\"backstage-sidebar\":xn,\"backstage-state-snapshots\":gs,\"backstage-state-variables\":ms,\"backstage-style-config\":ys,\"backstage-style-group\":vn,\"backstage-tab\":ks,\"backstage-tab-panel\":xs,\"backstage-tabs\":vs,\"backstage-variable-input\":$n})}function Ss(){hs(),Yr(),rs(),$s(),document.body.appendChild(document.createElement(\"backstage-sidebar\"))}var se=typeof globalThis<\"u\"?globalThis:typeof window<\"u\"?window:typeof global<\"u\"?global:typeof self<\"u\"?self:{};function Es(t){if(t.__esModule)return t;var e=t.default;if(typeof e==\"function\"){var n=function i(){if(this instanceof i){var r=[null];r.push.apply(r,arguments);var s=Function.bind.apply(e,r);return new s}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,\"__esModule\",{value:!0}),Object.keys(t).forEach(function(i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}),n}var xe=Cs;const _s={hoursPerDay:24,daysPerWeek:7,weeksPerMonth:4,monthsPerYear:12,daysPerYear:365.25},Pt={ms:[\"ms\",\"milli\",\"millisecond\",\"milliseconds\"],s:[\"s\",\"sec\",\"secs\",\"second\",\"seconds\"],m:[\"m\",\"min\",\"mins\",\"minute\",\"minutes\"],h:[\"h\",\"hr\",\"hrs\",\"hour\",\"hours\"],d:[\"d\",\"day\",\"days\"],w:[\"w\",\"week\",\"weeks\"],mth:[\"mon\",\"mth\",\"mths\",\"month\",\"months\"],y:[\"y\",\"yr\",\"yrs\",\"year\",\"years\"]};function Cs(t,e,n){n=Object.assign({},_s,n||{});let i=0,r=As(n),s=t.toLowerCase().replace(/[^.\\w+-]+/g,\"\").match(/[-+]?[0-9.]+[a-z]+/g);if(s===null)throw new Error(`The string [${t}] could not be parsed by timestring`);return s.forEach(l=>{let a=l.match(/[0-9.]+/g)[0],o=l.match(/[a-z]+/g)[0];i+=Ts(a,o,r)}),e?Ls(i,e,r):i}function As(t){let e={ms:.001,s:1,m:60,h:3600};return e.d=t.hoursPerDay*e.h,e.w=t.daysPerWeek*e.d,e.mth=t.daysPerYear/t.monthsPerYear*e.d,e.y=t.daysPerYear*e.d,e}function Sn(t){for(let e of Object.keys(Pt))if(Pt[e].indexOf(t)>-1)return e;throw new Error(`The unit [${t}] is not supported by timestring`)}function Ts(t,e,n){return t*n[Sn(e)]}function Ls(t,e,n){return t/n[Sn(e)]}function yt(t,e){return new Promise(n=>{t.innerHTML=e,n()})}function zs(t,e,n){const i=xe(n,\"s\")/2;return i===0?yt(t,e):new Promise(r=>{const s=t.style.animationDuration,l=t.style.pointerEvents;t.style.pointerEvents=\"none\";function a(){t.removeEventListener(\"animationend\",a),t.classList.remove(\"fade-in\"),t.style.animationDuration=s,t.style.pointerEvents=l,r()}t.innerHTML.trim()!==\"\"?(t.style.animationDuration=`${i}s`,t.addEventListener(\"animationend\",function o(){t.removeEventListener(\"animationend\",o),t.innerHTML=e,t.classList.remove(\"fade-out\"),t.classList.add(\"fade-in\")})):(t.innerHTML=e,t.style.animationDuration=`${i*2}s`,t.classList.add(\"fade-in\"),t.addEventListener(\"animationend\",a))})}function Ps(t,e,n){const i=xe(n,\"s\");return i===0?yt(t,e):new Promise((r,s)=>{const l=t.style.animationDuration,a=t.style.pointerEvents;if(t.innerHTML.trim()!==\"\"){if(!t.parentNode){s(new Error(\"This element must have a parent element.\"));return}const o=t.cloneNode(!0);t.parentNode.appendChild(o),o.setAttribute(\"aria-hidden\",\"\"),o.classList.add(\"fade-out\"),o.style.animationDuration=`${i}s`,o.addEventListener(\"animationend\",()=>o.remove())}t.innerHTML=e,t.classList.add(\"fade-in\"),t.style.animationDuration=`${i}s`,t.style.pointerEvents=\"none\",t.addEventListener(\"animationend\",function o(){t.removeEventListener(\"animationend\",o),t.style.animationDuration=l,t.style.pointerEvents=a,t.classList.remove(\"fade-in\"),r()})})}function Os(t){return typeof t==\"string\"&&[\"crossfade\",\"fadeInOut\",\"none\"].includes(t)}function En(t,e,n,i){const r=typeof i==\"string\"?i:\"0s\";switch(Os(n)?n:\"none\"){case\"crossfade\":return Ps(t,e,r);case\"fadeInOut\":return zs(t,e,r);case\"none\":return yt(t,e)}}class _n extends P{allChildInputsValid(){let e=!0;for(const n of this.querySelectorAll(\"input, select\"))e=e&&n.reportValidity();return e}moveContentsOffscreen(){const e=this.innerHTML,n=document.createElement(\"div\");for(;this.firstChild;)n.appendChild(this.firstChild);return this.innerHTML=e,n}}class Is extends _n{connectedCallback(){window.addEventListener(\"display-change\",this)}disconnectedCallback(){window.removeEventListener(\"display-change\",this)}async changeContent(e){const n=super.moveContentsOffscreen();await e(n),await En(this,n.innerHTML,m(\"config.body.transition.name\"),m(\"config.body.transition.duration\")),this.dispatchEvent(new CustomEvent(\"body-content-change\",{bubbles:!0}))}handleEvent({detail:e}){this.changeContent(n=>{n.innerHTML=e.body})}}class Ns extends P{constructor(){super(),this.delegate(\"click\",\"[data-back]\",()=>{const e=m(\"trail\");this.classList.remove(\"active\"),Array.isArray(e)?E(\"trail\",e.slice(0,e.length-1)):window.alert(\"Sorry, going back was not successful. Please try hard restarting.\")}),this.delegate(\"click\",\"[data-refresh]\",()=>{var n;const e=m(\"trail\");this.classList.remove(\"active\"),Array.isArray(e)?E(\"trail\",[...e]):E(\"trail\",[(n=ft())==null?void 0:n.name])}),this.delegate(\"click\",\"[data-hard-restart]\",()=>{gn(!0),window.location.reload()})}connectedCallback(){window.addEventListener(\"error\",this),window.addEventListener(\"unhandledrejection\",this)}disconnectedCallback(){window.removeEventListener(\"error\",this),window.removeEventListener(\"unhandledrejection\",this)}handleEvent(e){const n=`\nPlease report this to https://github.com/markedjs/marked.`,i=e.type===\"unhandledrejection\"?e.reason:e.error;try{let r=\"\";i!=null&&i.stack?r=`${i.message}\n\nStack trace:\n${i.stack}`:r=`${i.message}\n\n[No stack trace available]`,r=r.replace(n,\"\");const s=m(\"trail\");this.classList.add(\"active\"),this.innerHTML=`\n\t\t\t<p>\n\t\t\tAn unexpected error has occurred.\n\t\t\t</p>\n\t\t\t<pre>${m(\"config.testing\")?r:\"\"}</pre>\n\t\t\t<ul>\n\t\t\t\t<li>\n\t\t\t\t\t<inline-button class=\"link\" ${Array.isArray(s)&&s.length>1?\"data-back\":\"data-refresh\"}>Go back</inline-button> to the previous passage.\n\t\t\t\t</li>\n\t\t\t\t<li>\n\t\t\t\t\t<inline-button class=\"link\" data-hard-restart>Hard restart</inline-button>, clearing all progress and beginning from the start.\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t`}catch(r){console.error(r)}}}const{log:Ce}=F(\"display\");class Ms extends P{connectedCallback(){window.addEventListener(\"state-change\",this),this.defaultHtml(\"<div data-google></div><div data-typekit></div>\")}disconnectedCallback(){window.removeEventListener(\"state-change\",this)}handleEvent({detail:e}){if([\"config\",\"config.style\",\"config.style.fonts\"].includes(e.name)){const r=m(\"config.style.fonts\");if(!r)return;for(const s in r){const l=r[s].name,a=r[s].url;typeof l==\"string\"&&typeof a==\"string\"&&this.loadUrlFont(s,a,l)}return}const i=e.name.match(/^config\\.style\\.fonts\\.([^.]+)/i);if(i){const r=i[1],s=m(`config.style.fonts.${r}.name`),l=m(`config.style.fonts.${r}.url`);typeof l==\"string\"&&typeof s==\"string\"&&(Ce(`Adding font from URL (${s})`),this.loadUrlFont(r,l,s));return}e.name===\"config.style.googleFont\"&&typeof e.value==\"string\"?this.loadGoogleFont(e.value):e.name===\"config.style.typekitFont\"&&typeof e.value==\"string\"&&this.loadTypekitFont(e.value)}loadGoogleFont(e){Ce(\"Adding Google font\"),this.query(\"[data-google]\").innerHTML=e}loadTypekitFont(e){Ce(\"Adding Typekit font\"),this.query(\"[data-typekit]\").innerHTML=e}loadUrlFont(e,n,i){Ce(\"Adding font from URL\");const r=n.match(/\\.(.+)$/);if(!r||!r[1])return;const s=r[1],l=this.querySelector(`[data-url-${e}]`)??document.createElement(\"style\");l.setAttribute(`data-url-${e}`,\"\"),l.innerHTML=`@font-face { font-family: \"${i}\"; src: url(\"${n}\") format(\"${s}\"); }`,l.parentNode||this.appendChild(l)}}class Rs extends _n{get validatedType(){const e=this.getAttribute(\"type\")??\"\";if(![\"footer\",\"header\"].includes(e))throw new Error(`Don't know how to update marginal content with type \"${e}\".`);return e}connectedCallback(){window.addEventListener(\"display-change\",this)}disconnectedCallback(){window.removeEventListener(\"display-change\",this)}async changeContent(e){const n=super.moveContentsOffscreen();await e(n);let i=!1;for(const r of[\"left\",\"center\",\"right\"]){const s=n.querySelector(`.${r}`);if((s==null?void 0:s.innerHTML.trim())!==\"\"){i=!0;break}}if(i)return this.removeAttribute(\"hidden\"),En(this,n.innerHTML,m(`config.${this.validatedType}.transition.name`),m(`config.${this.validatedType}.transition.duration`));this.setAttribute(\"hidden\",\"\")}handleEvent({detail:e}){this.changeContent(n=>{n.innerHTML=[\"left\",\"center\",\"right\"].reduce((i,r)=>i+`<div class=\"${r}\">${e[this.validatedType][r]}</div>`,\"\")})}}class Ds extends HTMLElement{constructor(){super(),this.addEventListener(\"body-content-change\",this)}handleEvent({target:e}){if(!e)return;const n=[...e.querySelectorAll(\"[skippable-delay]\")].map(a=>{const o={delay:0,el:a};try{o.delay=parseInt(a.getAttribute(\"skippable-delay\")??\"0\")}catch{}return o}).filter(({delay:a})=>!!a).sort((a,o)=>a.delay-o.delay);if(n.length===0)return;let i=Date.now(),r;const s=()=>{var c;const a=Date.now()-i,o=(c=n.find(({delay:u})=>u>a))==null?void 0:c.delay;if(!o){this.dispatchEvent(new CustomEvent(\"page-skip-indicator-hide\"));return}for(const u of n)u.delay<=0||(u.delay<=o?(u.delay=0,u.el.setAttribute(\"skippable-delay\",\"0\")):(u.delay-=o,u.el.setAttribute(\"skippable-delay\",u.delay.toString())));i=Date.now(),window.clearTimeout(r),l()},l=()=>{r&&window.clearTimeout(r),r=window.setTimeout(()=>{window.removeEventListener(\"click\",s),window.removeEventListener(\"keyup\",s),this.dispatchEvent(new CustomEvent(\"page-skip-indicator-hide\"))},n[n.length-1].delay)};window.addEventListener(\"click\",s),window.addEventListener(\"keyup\",s),l(),this.dispatchEvent(new CustomEvent(\"page-skip-indicator-show\"))}}class js extends P{connectedCallback(){var e,n;(e=this.closest(\"page-skip\"))==null||e.addEventListener(\"page-skip-indicator-hide\",this),(n=this.closest(\"page-skip\"))==null||n.addEventListener(\"page-skip-indicator-show\",this)}disconnectedCallback(){var e,n;(e=this.closest(\"page-skip\"))==null||e.removeEventListener(\"page-skip-indicator-hide\",this),(n=this.closest(\"page-skip\"))==null||n.removeEventListener(\"page-skip-indicator-show\",this)}handleEvent(e){switch(e.type){case\"page-skip-indicator-hide\":this.removeAttribute(\"active\");break;case\"page-skip-indicator-show\":this.setAttribute(\"active\",\"\");break}}}const Ot=[\"gray\",\"red\",\"pink\",\"grape\",\"violet\",\"indigo\",\"blue\",\"cyan\",\"teal\",\"green\",\"lime\",\"yellow\",\"orange\"];function It(t){if(typeof t!=\"string\")throw new Error(\"Only strings can be parsed as color values.\");let e=t;if(Ot.includes(t))return`var(--oc-${t}-9)`;const n=/^(\\w+)-(\\d)$/.exec(t);return n&&Ot.includes(n[1])&&(e=`var(--oc-${t})`),e}function ge(t){const e={backgroundColor:\"inherit\",color:\"inherit\"};if(t===void 0)return e;if(typeof t!=\"string\")throw new Error(\"Only strings can be parsed as colors.\");const n=t.split(/ on /i);return e.color=It(n[0].trim().toLowerCase()),e.color===\"\"&&(e.color=\"inherit\"),n.length===2&&(e.backgroundColor=It(n[1].trim().toLowerCase())),e}function Hs(t){const e={fontFamily:\"inherit\",fontSize:\"inherit\",fontStyle:\"inherit\",fontVariant:\"inherit\",fontWeight:\"inherit\",textDecoration:\"inherit\",textTransform:\"inherit\"};if(t===void 0)return e;if(typeof t!=\"string\")throw new Error(\"Only strings can be parsed as fonts.\");function n(c,u){c.fontFamily=u.split(\"/\").map(d=>{let f=d;return[\"monospace\",\"sans-serif\",\"serif\"].includes(f)||(f[0]!=='\"'&&(f='\"'+f),f[f.length-1]!=='\"'&&(f=f+'\"')),f}).join(\",\")}function i(c){c.fontWeight=\"bold\"}function r(c){c.fontStyle=\"italic\"}function s(c){c.fontStyle=\"none\",c.fontWeight=\"normal\",c.textDecoration=\"none\",c.textTransform=\"none\"}function l(c){c.fontVariant=\"small-caps\",c.textTransform=\"lowercase\"}function a(c){c.textDecoration=\"underline\"}const o=/\\b\\d+(?:\\.\\d+)?(ch|cm|ex|in|mm|pc|pt|px|r?em|vh|vmax|vmin|vw|%)?/i.exec(t);if(o){/^\\d+$/.test(o[0])?e.fontSize=`${o[0]}px`:e.fontSize=o[0],o.index!==0&&n(e,t.substring(0,o.index).trim());const c=t.substring(o.index);/\\bregular\\b/i.test(c)?s(e):(/\\bbold\\b/.test(c)&&i(e),/\\bitalics?\\b/.test(c)&&r(e),/\\bunderlined?/.test(c)&&a(e),/\\bsmall caps?\\b/.test(c)&&l(e))}else{let c,u=t;for(;c=/(bold|italics?|regular|small caps|underlined?)$/.exec(u);){switch(c[0]){case\"bold\":i(e);break;case\"italic\":case\"italics\":r(e);break;case\"regular\":s(e);break;case\"small caps\":l(e);break;case\"underline\":case\"underlined\":a(e);break}u=u.substring(0,c.index).trim()}u.trim()!==\"\"&&n(e,u)}return e}const qs={\"config.style.backdrop\":\"gray-0\",\"config.style.page.style.border\":\"shadow\",\"config.style.page.style.borderColor\":\"gray-2\",\"config.style.page.font\":\"Iowan Old Style/Constantia/Georgia/serif 18\",\"config.style.page.color\":\"gray-9 on white\",\"config.style.page.fork.divider.color\":\"gray-3\",\"config.style.page.fork.divider.style\":\"dashed\",\"config.style.page.fork.divider.size\":1,\"config.style.page.link.color\":\"gray-9\",\"config.style.page.link.lineColor\":\"red-8\",\"config.style.page.link.font\":\"underline\",\"config.style.page.link.active.color\":\"red-8 on red-0\",\"config.style.page.verticalAlign\":\"center\",\"config.style.page.header.font\":\"16\",\"config.style.page.header.link.font\":\"small caps underlined\",\"config.style.page.header.link.lineColor\":\"red-8\",\"config.style.page.header.link.active.color\":\"red-8 on red-0\",\"config.style.page.header.link.active.font\":\"small caps underlined\",\"config.style.page.header.link.active.lineColor\":\"red-8\",\"config.style.page.footer.font\":\"16\",\"config.style.page.footer.link.font\":\"small caps underlined\",\"config.style.page.footer.link.lineColor\":\"red-8\",\"config.style.page.footer.link.active.color\":\"red-8 on red-0\",\"config.style.page.footer.link.active.font\":\"small caps underlined\",\"config.style.page.footer.link.active.lineColor\":\"red-8\"};function Fs(){re(qs)}class Bs extends P{connectedCallback(){window.addEventListener(\"state-change\",this)}disconnectedCallback(){window.removeEventListener(\"state-change\",this)}handleEvent(e){const{name:n,value:i}=e.detail;if(![\"number\",\"string\"].includes(typeof i)||!/^config\\.style\\./.test(n))return;const r=/^config\\.style\\.(.*)\\.color$/.exec(n);if(r){const a=r[1].replace(/\\./g,\"-\"),{backgroundColor:o,color:c}=ge(i);this.style.setProperty(`--${a}-background-color`,o),this.style.setProperty(`--${a}-color`,c);return}const s=/^config\\.style\\.(.*)\\.lineColor$/.exec(n);if(s){const a=s[1].replace(/\\./g,\"-\"),{color:o}=ge(i);this.style.setProperty(`--${a}-text-decoration-color`,o);return}const l=/^config\\.style\\.(.*)\\.font$/.exec(n);if(l){const a=l[1].replace(/\\./g,\"-\"),o=Hs(i);this.style.setProperty(`--${a}-font-family`,o.fontFamily),this.style.setProperty(`--${a}-font-size`,o.fontSize),this.style.setProperty(`--${a}-font-style`,o.fontStyle),this.style.setProperty(`--${a}-font-variant`,o.fontVariant),this.style.setProperty(`--${a}-font-weight`,o.fontWeight),this.style.setProperty(`--${a}-text-decoration`,o.textDecoration),this.style.setProperty(`--${a}-text-transform`,o.textTransform);return}switch(n){case\"config.style.backdrop\":{const{color:a}=ge(i);this.style.setProperty(\"--backdrop-color\",a);break}case\"config.style.page.fork.divider.size\":this.style.setProperty(\"--page-fork-divider-size\",`${i}px`);break;case\"config.style.page.fork.divider.style\":this.style.setProperty(\"--page-fork-divider-style\",i);break;case\"config.style.page.verticalAlign\":switch(i){case\"top\":this.style.setProperty(\"--page-current-passage-justify-content\",\"flex-start\");break;case\"center\":this.style.setProperty(\"--page-current-passage-justify-content\",\"center\");break;case\"bottom\":this.style.setProperty(\"--page-current-passage-justify-content\",\"flex-end\");break}break;case\"config.style.page.style.border\":case\"config.style.page.style.borderColor\":switch(i){case\"none\":this.style.setProperty(\"--page-border\",\"none\"),this.style.setProperty(\"--page-box-shadow\",\"none\");break;case\"shadow\":this.style.setProperty(\"--page-border\",\"none\"),this.style.setProperty(\"--page-box-shadow\",\"0 4px 8px hsla(0, 0%, 0%, 0.25)\");break;case\"thick-line\":this.style.setProperty(\"--page-border\",`4px solid ${ge(m(\"config.style.page.style.borderColor\")).color}`),this.style.setProperty(\"--page-box-shadow\",\"none\");break;case\"thin-line\":this.style.setProperty(\"--page-border\",`1px solid ${ge(m(\"config.style.page.style.borderColor\")).color}`),this.style.setProperty(\"--page-box-shadow\",\"none\");break}}}}var X;class Us extends P{constructor(){super();Z(this,\"warnings\");$t(this,X,void 0);this.warnings=[]}connectedCallback(){window.addEventListener(\"state-change\",this),this.spyOnWarnings(),this.update()}disconnectedCallback(){window.removeEventListener(\"state-change\",this),this.unspyOnWarnings()}handleEvent(n){n.type===\"state-change\"&&n.detail.name===\"trail\"&&(this.warnings=[],this.update())}spyOnWarnings(){St(this,X,console.warn),console.warn=(...n)=>{this.warnings.push(...n),this.update(),he(this,X).apply(he(this,X),n)}}unspyOnWarnings(){he(this,X)&&(console.warn=he(this,X))}update(){this.isConnected&&(this.warnings.length>0&&m(\"config.testing\")?(this.removeAttribute(\"hidden\"),this.innerHTML=`<ul>${this.warnings.map(n=>`<li>Warning: ${n}</li>`).join(\"\")}</ul>`):this.setAttribute(\"hidden\",\"\"))}}X=new WeakMap;function Vs(){mt({\"body-content\":Is,\"error-handler\":Ns,\"external-fonts\":Ms,\"marginal-content\":Rs,\"page-skip\":Ds,\"page-skip-indicator\":js,\"state-css-variables\":Bs,\"warning-list\":Us})}class Ee extends P{constructor(){super(),this.addEventListener(\"keydown\",e=>{(e.key===\" \"||e.key===\"Enter\")&&(e.preventDefault(),this.dispatchEvent(new MouseEvent(\"click\",{bubbles:!0})))})}connectedCallback(){this.setAttribute(\"tabindex\",\"0\"),this.hasAttribute(\"role\")||this.setAttribute(\"role\",\"button\")}}const{warn:Nt}=F(\"inserts\");class Zs extends Ee{constructor(){super(),this.addEventListener(\"click\",()=>{const e=this.getAttribute(\"choices\");if(e){let n;try{n=JSON.parse(e)}catch{Nt(`The choices attribute, \"${e}\" couldn't be parsed.`);return}if(!Array.isArray(n)){Nt(\"The choices attribute of this cycling link doesn't deserialize to an array.\");return}let i=n.map(l=>typeof l==\"string\"?l:l.toString()).indexOf((this.textContent??\"\").trim())+1;i===n.length&&(i=0);const r=this.closest(\"body-content, marginal-content\");if(!r)throw new Error(\"Couldn't find suitable parent element to do a cycle link transition on.\");r.changeContent(()=>{this.textContent=n[i].toString()});const s=this.getAttribute(\"set\");s&&E(s,n[i])}})}}class Gs extends Ee{constructor(){super(),this.addEventListener(\"click\",()=>{const e=this.getAttribute(\"to\"),n=this.closest(\"body-content, marginal-content\");n&&!n.allChildInputsValid()||e&&yn(e)})}connectedCallback(){this.setAttribute(\"role\",\"link\")}}class Js extends Ee{constructor(){super(),this.addEventListener(\"click\",wn)}}const Xs={match:/^(no )?ambient\\s+sound/i,render(t,{volume:e}){const n=m(\"sound.ambient\");if(n)for(const r in n)r!==t&&n[r].playing&&E(`sound.ambient.${r}.playing`,!1);if(!t)return;const i=m(`sound.ambient.${t}.description`)??\"\";return e&&E(`sound.ambient.${t}.volume`,e),E(`sound.ambient.${t}.playing`,!0),`<audio>${i}</audio>`}};function wt(t,e){return/^\\w+:\\/\\/\\/?\\w/i.test(t)?j(\"a\",{class:\"link\",href:t},[e??t]):j(\"passage-link\",{class:\"link\",to:t},[e??t])}function Ws(t){return t.replace(/\\[\\[(.*?)\\]\\]/g,(e,n)=>{let i=n;const r=n.indexOf(\"|\");if(r!==-1)i=n.substring(0,r),n=n.substring(r+1);else{const s=n.indexOf(\"->\");if(s!==-1)i=n.substring(0,s),n=n.substring(s+2);else{const l=n.indexOf(\"<-\");l!==-1&&(i=n.substring(l+2),n=n.substring(0,l))}}return i===\"\"||n===\"\"?e:wt(n,i??n)})}const Qs={match:/^back\\s+link/i,render(t,e){const n=m(\"trail\");if(!(!Array.isArray(n)||n.length===0))return wt(n.length>1?n[n.length-2]:n[0],e.label??\"Back\")}},Ks={match:/^cycling\\s+link(\\s+for)?/i,render(t,{choices:e}){let n=\"\";if(t){const i=m(t);i===void 0?(E(t,e[0]),n=e[0].toString()):n=i.toString()}else n=e[0].toString();return j(\"cycling-link\",{class:\"link\",set:t??void 0,choices:JSON.stringify(e)},[n])}},Ys={match:/^dropdown menu(\\s+for)?/i,render(t,e){let n;return t&&(n=m(t),n===void 0&&(E(t,e.choices[0]),n=e.choices[0])),j(\"variable-binding\",{name:t??void 0},[we(\"select\",{},e.choices.map(i=>{const r=i.toString(),s={\"data-json-value\":JSON.stringify(i)};return t&&n===i&&(s.selected=\"\"),we(\"option\",s,[r])}))])}},eo={match:/^embed\\s+flickr(\\s+image)?/i,render(t,e){var n;if(t)return j(\"img\",{...e,src:(n=/img src=\"(.+?)\"/.exec(t))==null?void 0:n[1]})}},to={match:/^embed\\s+image/i,render(t,e){return j(\"img\",{...e,src:t??\"\"})}},no={match:/^embed\\s+passage(\\s+named)?/i,render(t){if(!t)return\"\";const e=$e(t);return e?ve(e.source):\"\"}},io={match:/^embed\\s+unsplash(\\s+image)?/i,render(t,e){if(t)return j(\"img\",{...e,src:`https://source.unsplash.com/${t.replace(/.*\\//,\"\")}/${e.width}x${e.height}`})}},ro={match:/^embed\\s+youtube(\\s+video)?/i,render(t,e){if(!t)return;let n=`https://www.youtube-nocookie.com/embed/${t.replace(/.*\\?v=/,\"\")}?modestbranding=1&rel=0&controls=${e.controls?1:0}&`;return e.autoplay&&(n+=\"autoplay=1&\"),e.loop&&(n+=\"loop=1&\"),j(\"div\",{style:\"position: relative; height: 0; padding-bottom: 56.25%; margin-bottom: 1em\"},[we(\"iframe\",{src:n,frameBorder:\"0\",style:\"position: absolute; top: 0; left: 0; width: 100%; height: 100%\"})])}},so={match:/^link\\s+to/i,render(t,{label:e}){if(t)return wt(t,e)}},oo={match:/^restart\\s+link/i,render(t,{label:e}){return j(\"restart-link\",{class:\"link\"},[e??\"Restart\"])}},ao={match:/^reveal\\s+link/i,render(t,e){if(t){if(e.text)return j(\"reveal-link\",{class:\"link\",text:e.text},[t]);if(e.passage)return j(\"reveal-link\",{class:\"link\",passage:e.passage},[t])}}},lo={match:/^sound\\s+effect/i,render(t,{volume:e}){const n=m(`sound.effect.${t}.description`)??\"\";return e&&E(`sound.effect.${t}.volume`,e),E(`sound.effect.${t}.playing`,!0),`<audio>${n}</audio>`}},co={match:/^text\\s+input(\\s+for)?/i,render(t,e){return j(\"variable-binding\",{name:t??void 0},[we(\"input\",{type:\"text\",value:t?(m(t)??\"\").toString():\"\",required:e.required!==!1?\"\":void 0})])}},Cn=[Xs,Qs,Ks,Ys,eo,to,no,io,ro,so,oo,ao,lo,co];let ue=[...Cn];function An(){return ue}function uo(t){ue=[...ue,t]}function fo(t){ue=ue.filter(e=>e!==t)}function ho(){ue=[...Cn]}const po=Object.freeze(Object.defineProperty({__proto__:null,add:uo,all:An,remove:fo,reset:ho},Symbol.toStringTag,{value:\"Module\"}));function Tn(t,e,n={}){const i=`<${e}`+Object.keys(n).reduce((s,l)=>`${s} ${l}=\"${n[l]}\"`,\"\")+\">\";let r=i+t.replace(/[\\r\\n]{2,}/g,`</${e}>$&${i}`)+`</${e}>`;return r=r.replace(/(<span.*?>)\\s*(#+)/gi,\"$2 $1\"),r}const go={match:/^after\\s/i,process(t,{invocation:e}){const n=xe(e.replace(/^after\\s/i,\"\"),\"ms\");t.text=Tn(t.text,\"skippable-animation\",{\"skippable-delay\":n.toString(),class:\"fade-in\"})}},mo={match:/^align\\s+(left|right|center)/i,process(t,{invocation:e}){const n=e.replace(/^align\\s+/i,\"\");t.text=Tn(t.text,\"span\",{style:`display: block; text-align: ${n}`})}},bo={match:/^append$/i,process(t){t.startsNewParagraph=!1}},yo={match:/^if(always|never)?\\s|else$|unless\\s/i,processRaw(t,{invocation:e,state:n}){const i=e.replace(/\\s.*/,\"\").toLowerCase(),r=()=>new Function(\"return \"+e.replace(/.*?\\s/,\"\")).apply(window);switch(i){case\"if\":n.conditionEval=r();break;case\"ifalways\":n.conditionEval=!0;break;case\"ifnever\":n.conditionEval=!1;break;case\"unless\":n.conditionEval=!r();break;case\"else\":if(n.conditionEval===void 0)throw new Error(\"There was no matching if modifier for an else modifier.\");n.conditionEval=!n.conditionEval;break}n.conditionEval||(t.text=\"\")}},wo={match:/^continued?|cont('d)?$/i,process(){}},ko={match:/^css$/i,process(t){t.text=`<style>${t.text}</style>`}},xo={match:/^javascript$/i,process(t){try{const e=new Function(`\n\t\t\t\t\t\tfunction write() { write.__out += write.__join.call(arguments, ''); }\n\t\t\t\t\t\twrite.__out = '';\n\t\t\t\t\t\twrite.__join = Array.prototype.join;\n\t\t\t\t\t\t${Dr(t.text)};\n\t\t\t\t\t\treturn write.__out;\n\t\t\t\t\t`);t.text=e.apply(window)}catch(e){if(m(\"config.testing\")){const n=e;let i=\"unknown error\";n.stack?i=n.stack:i=n.message+`\n[No stack trace available]`,t.text=`<div class=\"error\">An error occurred evaluating:<pre>${t.text}</pre><p><pre>${i}</pre></p></div>`}else throw e}}},vo={match:/^(note(\\s+to\\s+myself)?|n\\.?b\\.?|todo|fixme)$/i,process(t){t.text=\"\"}},Ln=[go,mo,bo,yo,wo,ko,xo,vo];let ne=[...Ln];function zn(){return ne}function $o(t){ne=[...ne,t]}function So(t){ne=ne.filter(e=>e!==t)}function Eo(){ne=[...Ln]}const _o=Object.freeze(Object.defineProperty({__proto__:null,add:$o,all:zn,get modifiers(){return ne},remove:So,reset:Eo},Symbol.toStringTag,{value:\"Module\"})),{log:me,warn:Co}=F(\"parse\"),Ao={varsSep:/^--$/m,modifierPattern:/^\\[([^[].+[^\\]])\\]$/gm};function To(t,e=Ao){const n={vars:[],blocks:[]},i=t.split(e.varsSep,2);let r,s;i.length===2?(me(\"Detected vars section\"),[r,s]=i,r.split(/\\r?\\n/).forEach(u=>{if(u.trim()===\"\")return;const d=u.indexOf(\":\");if(d!==-1){const f=u.substring(0,d).trim(),h=u.substring(d+1).trim(),g={name:f,value:new Function(`return (${h})`)},v=f.match(/\\(.+\\)/);if(v){if(!v.index)throw new Error(`A condition was found in \"${f}\", but no index was present in the regular expression match.`);g.condition=new Function(`return !!(${v[0]})`),g.name=g.name.substring(0,v.index).trim(),me(`Setting variable \"${g.name}\" to \"${h}\" with condition (${v[0]})`)}else me(`Setting variable \"${f}\" to \"${h}\" without condition`);n.vars.push(g)}else Co(`The line \"${u}\" in the vars section is missing a colon. It was ignored.`)})):(me(\"No vars section detected\"),s=i[0]);function l(u,d){const f=d.trim();f!==\"\"&&(me(`Creating '${u}' block with content: \"${f}\"`),n.blocks.push({type:u,content:f}))}const a=new RegExp(e.modifierPattern);let o=0,c=a.exec(s);for(;c;){l(\"text\",s.substring(o,c.index));const u=c[1];let d=\"\";for(let f=0;f<u.length;f++)switch(u[f]){case'\"':for(d+='\"',f=f+1;f<u.length&&(d+=u[f],!(u[f]==='\"'&&u[f-1]!==\"\\\\\"));f++);break;case\";\":l(\"modifier\",d),d=\"\";break;default:d+=u[f]}l(\"modifier\",d),o=a.lastIndex,c=a.exec(s)}return l(\"text\",s.substring(o)),n}function Pn(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:\"\",highlight:null,hooks:null,langPrefix:\"language-\",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let oe=Pn();function Lo(t){oe=t}const On=/[&<>\"']/,zo=new RegExp(On.source,\"g\"),In=/[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/,Po=new RegExp(In.source,\"g\"),Oo={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\"},Mt=t=>Oo[t];function I(t,e){if(e){if(On.test(t))return t.replace(zo,Mt)}else if(In.test(t))return t.replace(Po,Mt);return t}const Io=/&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/ig;function Nn(t){return t.replace(Io,(e,n)=>(n=n.toLowerCase(),n===\"colon\"?\":\":n.charAt(0)===\"#\"?n.charAt(1)===\"x\"?String.fromCharCode(parseInt(n.substring(2),16)):String.fromCharCode(+n.substring(1)):\"\"))}const No=/(^|[^\\[])\\^/g;function S(t,e){t=typeof t==\"string\"?t:t.source,e=e||\"\";const n={replace:(i,r)=>(r=r.source||r,r=r.replace(No,\"$1\"),t=t.replace(i,r),n),getRegex:()=>new RegExp(t,e)};return n}const Mo=/[^\\w:]/g,Ro=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function Rt(t,e,n){if(t){let i;try{i=decodeURIComponent(Nn(n)).replace(Mo,\"\").toLowerCase()}catch{return null}if(i.indexOf(\"javascript:\")===0||i.indexOf(\"vbscript:\")===0||i.indexOf(\"data:\")===0)return null}e&&!Ro.test(n)&&(n=qo(e,n));try{n=encodeURI(n).replace(/%25/g,\"%\")}catch{return null}return n}const Ae={},Do=/^[^:]+:\\/*[^/]*$/,jo=/^([^:]+:)[\\s\\S]*$/,Ho=/^([^:]+:\\/*[^/]*)[\\s\\S]*$/;function qo(t,e){Ae[\" \"+t]||(Do.test(t)?Ae[\" \"+t]=t+\"/\":Ae[\" \"+t]=ze(t,\"/\",!0)),t=Ae[\" \"+t];const n=t.indexOf(\":\")===-1;return e.substring(0,2)===\"//\"?n?e:t.replace(jo,\"$1\")+e:e.charAt(0)===\"/\"?n?e:t.replace(Ho,\"$1\")+e:t+e}const Ie={exec:function(){}};function Dt(t,e){const n=t.replace(/\\|/g,(s,l,a)=>{let o=!1,c=l;for(;--c>=0&&a[c]===\"\\\\\";)o=!o;return o?\"|\":\" |\"}),i=n.split(/ \\|/);let r=0;if(i[0].trim()||i.shift(),i.length>0&&!i[i.length-1].trim()&&i.pop(),i.length>e)i.splice(e);else for(;i.length<e;)i.push(\"\");for(;r<i.length;r++)i[r]=i[r].trim().replace(/\\\\\\|/g,\"|\");return i}function ze(t,e,n){const i=t.length;if(i===0)return\"\";let r=0;for(;r<i;){const s=t.charAt(i-r-1);if(s===e&&!n)r++;else if(s!==e&&n)r++;else break}return t.slice(0,i-r)}function Fo(t,e){if(t.indexOf(e[1])===-1)return-1;const n=t.length;let i=0,r=0;for(;r<n;r++)if(t[r]===\"\\\\\")r++;else if(t[r]===e[0])i++;else if(t[r]===e[1]&&(i--,i<0))return r;return-1}function Bo(t){t&&t.sanitize&&!t.silent&&console.warn(\"marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options\")}function jt(t,e){if(e<1)return\"\";let n=\"\";for(;e>1;)e&1&&(n+=t),e>>=1,t+=t;return n+t}function Ht(t,e,n,i){const r=e.href,s=e.title?I(e.title):null,l=t[1].replace(/\\\\([\\[\\]])/g,\"$1\");if(t[0].charAt(0)!==\"!\"){i.state.inLink=!0;const a={type:\"link\",raw:n,href:r,title:s,text:l,tokens:i.inlineTokens(l)};return i.state.inLink=!1,a}return{type:\"image\",raw:n,href:r,title:s,text:I(l)}}function Uo(t,e){const n=t.match(/^(\\s+)(?:```)/);if(n===null)return e;const i=n[1];return e.split(`\n`).map(r=>{const s=r.match(/^\\s+/);if(s===null)return r;const[l]=s;return l.length>=i.length?r.slice(i.length):r}).join(`\n`)}class kt{constructor(e){this.options=e||oe}space(e){const n=this.rules.block.newline.exec(e);if(n&&n[0].length>0)return{type:\"space\",raw:n[0]}}code(e){const n=this.rules.block.code.exec(e);if(n){const i=n[0].replace(/^ {1,4}/gm,\"\");return{type:\"code\",raw:n[0],codeBlockStyle:\"indented\",text:this.options.pedantic?i:ze(i,`\n`)}}}fences(e){const n=this.rules.block.fences.exec(e);if(n){const i=n[0],r=Uo(i,n[3]||\"\");return{type:\"code\",raw:i,lang:n[2]?n[2].trim().replace(this.rules.inline._escapes,\"$1\"):n[2],text:r}}}heading(e){const n=this.rules.block.heading.exec(e);if(n){let i=n[2].trim();if(/#$/.test(i)){const r=ze(i,\"#\");(this.options.pedantic||!r||/ $/.test(r))&&(i=r.trim())}return{type:\"heading\",raw:n[0],depth:n[1].length,text:i,tokens:this.lexer.inline(i)}}}hr(e){const n=this.rules.block.hr.exec(e);if(n)return{type:\"hr\",raw:n[0]}}blockquote(e){const n=this.rules.block.blockquote.exec(e);if(n){const i=n[0].replace(/^ *>[ \\t]?/gm,\"\"),r=this.lexer.state.top;this.lexer.state.top=!0;const s=this.lexer.blockTokens(i);return this.lexer.state.top=r,{type:\"blockquote\",raw:n[0],tokens:s,text:i}}}list(e){let n=this.rules.block.list.exec(e);if(n){let i,r,s,l,a,o,c,u,d,f,h,g,v=n[1].trim();const O=v.length>1,x={type:\"list\",raw:\"\",ordered:O,start:O?+v.slice(0,-1):\"\",loose:!1,items:[]};v=O?`\\\\d{1,9}\\\\${v.slice(-1)}`:`\\\\${v}`,this.options.pedantic&&(v=O?v:\"[*+-]\");const A=new RegExp(`^( {0,3}${v})((?:[\t ][^\\\\n]*)?(?:\\\\n|$))`);for(;e&&(g=!1,!(!(n=A.exec(e))||this.rules.block.hr.test(e)));){if(i=n[0],e=e.substring(i.length),u=n[2].split(`\n`,1)[0].replace(/^\\t+/,w=>\" \".repeat(3*w.length)),d=e.split(`\n`,1)[0],this.options.pedantic?(l=2,h=u.trimLeft()):(l=n[2].search(/[^ ]/),l=l>4?1:l,h=u.slice(l),l+=n[1].length),o=!1,!u&&/^ *$/.test(d)&&(i+=d+`\n`,e=e.substring(d.length+1),g=!0),!g){const w=new RegExp(`^ {0,${Math.min(3,l-1)}}(?:[*+-]|\\\\d{1,9}[.)])((?:[ \t][^\\\\n]*)?(?:\\\\n|$))`),k=new RegExp(`^ {0,${Math.min(3,l-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$)`),_=new RegExp(`^ {0,${Math.min(3,l-1)}}(?:\\`\\`\\`|~~~)`),C=new RegExp(`^ {0,${Math.min(3,l-1)}}#`);for(;e&&(f=e.split(`\n`,1)[0],d=f,this.options.pedantic&&(d=d.replace(/^ {1,4}(?=( {4})*[^ ])/g,\"  \")),!(_.test(d)||C.test(d)||w.test(d)||k.test(e)));){if(d.search(/[^ ]/)>=l||!d.trim())h+=`\n`+d.slice(l);else{if(o||u.search(/[^ ]/)>=4||_.test(u)||C.test(u)||k.test(u))break;h+=`\n`+d}!o&&!d.trim()&&(o=!0),i+=f+`\n`,e=e.substring(f.length+1),u=d.slice(l)}}x.loose||(c?x.loose=!0:/\\n *\\n *$/.test(i)&&(c=!0)),this.options.gfm&&(r=/^\\[[ xX]\\] /.exec(h),r&&(s=r[0]!==\"[ ] \",h=h.replace(/^\\[[ xX]\\] +/,\"\"))),x.items.push({type:\"list_item\",raw:i,task:!!r,checked:s,loose:!1,text:h}),x.raw+=i}x.items[x.items.length-1].raw=i.trimRight(),x.items[x.items.length-1].text=h.trimRight(),x.raw=x.raw.trimRight();const M=x.items.length;for(a=0;a<M;a++)if(this.lexer.state.top=!1,x.items[a].tokens=this.lexer.blockTokens(x.items[a].text,[]),!x.loose){const w=x.items[a].tokens.filter(_=>_.type===\"space\"),k=w.length>0&&w.some(_=>/\\n.*\\n/.test(_.raw));x.loose=k}if(x.loose)for(a=0;a<M;a++)x.items[a].loose=!0;return x}}html(e){const n=this.rules.block.html.exec(e);if(n){const i={type:\"html\",raw:n[0],pre:!this.options.sanitizer&&(n[1]===\"pre\"||n[1]===\"script\"||n[1]===\"style\"),text:n[0]};if(this.options.sanitize){const r=this.options.sanitizer?this.options.sanitizer(n[0]):I(n[0]);i.type=\"paragraph\",i.text=r,i.tokens=this.lexer.inline(r)}return i}}def(e){const n=this.rules.block.def.exec(e);if(n){const i=n[1].toLowerCase().replace(/\\s+/g,\" \"),r=n[2]?n[2].replace(/^<(.*)>$/,\"$1\").replace(this.rules.inline._escapes,\"$1\"):\"\",s=n[3]?n[3].substring(1,n[3].length-1).replace(this.rules.inline._escapes,\"$1\"):n[3];return{type:\"def\",tag:i,raw:n[0],href:r,title:s}}}table(e){const n=this.rules.block.table.exec(e);if(n){const i={type:\"table\",header:Dt(n[1]).map(r=>({text:r})),align:n[2].replace(/^ *|\\| *$/g,\"\").split(/ *\\| */),rows:n[3]&&n[3].trim()?n[3].replace(/\\n[ \\t]*$/,\"\").split(`\n`):[]};if(i.header.length===i.align.length){i.raw=n[0];let r=i.align.length,s,l,a,o;for(s=0;s<r;s++)/^ *-+: *$/.test(i.align[s])?i.align[s]=\"right\":/^ *:-+: *$/.test(i.align[s])?i.align[s]=\"center\":/^ *:-+ *$/.test(i.align[s])?i.align[s]=\"left\":i.align[s]=null;for(r=i.rows.length,s=0;s<r;s++)i.rows[s]=Dt(i.rows[s],i.header.length).map(c=>({text:c}));for(r=i.header.length,l=0;l<r;l++)i.header[l].tokens=this.lexer.inline(i.header[l].text);for(r=i.rows.length,l=0;l<r;l++)for(o=i.rows[l],a=0;a<o.length;a++)o[a].tokens=this.lexer.inline(o[a].text);return i}}}lheading(e){const n=this.rules.block.lheading.exec(e);if(n)return{type:\"heading\",raw:n[0],depth:n[2].charAt(0)===\"=\"?1:2,text:n[1],tokens:this.lexer.inline(n[1])}}paragraph(e){const n=this.rules.block.paragraph.exec(e);if(n){const i=n[1].charAt(n[1].length-1)===`\n`?n[1].slice(0,-1):n[1];return{type:\"paragraph\",raw:n[0],text:i,tokens:this.lexer.inline(i)}}}text(e){const n=this.rules.block.text.exec(e);if(n)return{type:\"text\",raw:n[0],text:n[0],tokens:this.lexer.inline(n[0])}}escape(e){const n=this.rules.inline.escape.exec(e);if(n)return{type:\"escape\",raw:n[0],text:I(n[1])}}tag(e){const n=this.rules.inline.tag.exec(e);if(n)return!this.lexer.state.inLink&&/^<a /i.test(n[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\\/a>/i.test(n[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\\s|>)/i.test(n[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\\/(pre|code|kbd|script)(\\s|>)/i.test(n[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?\"text\":\"html\",raw:n[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(n[0]):I(n[0]):n[0]}}link(e){const n=this.rules.inline.link.exec(e);if(n){const i=n[2].trim();if(!this.options.pedantic&&/^</.test(i)){if(!/>$/.test(i))return;const l=ze(i.slice(0,-1),\"\\\\\");if((i.length-l.length)%2===0)return}else{const l=Fo(n[2],\"()\");if(l>-1){const o=(n[0].indexOf(\"!\")===0?5:4)+n[1].length+l;n[2]=n[2].substring(0,l),n[0]=n[0].substring(0,o).trim(),n[3]=\"\"}}let r=n[2],s=\"\";if(this.options.pedantic){const l=/^([^'\"]*[^\\s])\\s+(['\"])(.*)\\2/.exec(r);l&&(r=l[1],s=l[3])}else s=n[3]?n[3].slice(1,-1):\"\";return r=r.trim(),/^</.test(r)&&(this.options.pedantic&&!/>$/.test(i)?r=r.slice(1):r=r.slice(1,-1)),Ht(n,{href:r&&r.replace(this.rules.inline._escapes,\"$1\"),title:s&&s.replace(this.rules.inline._escapes,\"$1\")},n[0],this.lexer)}}reflink(e,n){let i;if((i=this.rules.inline.reflink.exec(e))||(i=this.rules.inline.nolink.exec(e))){let r=(i[2]||i[1]).replace(/\\s+/g,\" \");if(r=n[r.toLowerCase()],!r){const s=i[0].charAt(0);return{type:\"text\",raw:s,text:s}}return Ht(i,r,i[0],this.lexer)}}emStrong(e,n,i=\"\"){let r=this.rules.inline.emStrong.lDelim.exec(e);if(!r||r[3]&&i.match(/[\\p{L}\\p{N}]/u))return;const s=r[1]||r[2]||\"\";if(!s||s&&(i===\"\"||this.rules.inline.punctuation.exec(i))){const l=r[0].length-1;let a,o,c=l,u=0;const d=r[0][0]===\"*\"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(d.lastIndex=0,n=n.slice(-1*e.length+l);(r=d.exec(n))!=null;){if(a=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!a)continue;if(o=a.length,r[3]||r[4]){c+=o;continue}else if((r[5]||r[6])&&l%3&&!((l+o)%3)){u+=o;continue}if(c-=o,c>0)continue;o=Math.min(o,o+c+u);const f=e.slice(0,l+r.index+(r[0].length-a.length)+o);if(Math.min(l,o)%2){const g=f.slice(1,-1);return{type:\"em\",raw:f,text:g,tokens:this.lexer.inlineTokens(g)}}const h=f.slice(2,-2);return{type:\"strong\",raw:f,text:h,tokens:this.lexer.inlineTokens(h)}}}}codespan(e){const n=this.rules.inline.code.exec(e);if(n){let i=n[2].replace(/\\n/g,\" \");const r=/[^ ]/.test(i),s=/^ /.test(i)&&/ $/.test(i);return r&&s&&(i=i.substring(1,i.length-1)),i=I(i,!0),{type:\"codespan\",raw:n[0],text:i}}}br(e){const n=this.rules.inline.br.exec(e);if(n)return{type:\"br\",raw:n[0]}}del(e){const n=this.rules.inline.del.exec(e);if(n)return{type:\"del\",raw:n[0],text:n[2],tokens:this.lexer.inlineTokens(n[2])}}autolink(e,n){const i=this.rules.inline.autolink.exec(e);if(i){let r,s;return i[2]===\"@\"?(r=I(this.options.mangle?n(i[1]):i[1]),s=\"mailto:\"+r):(r=I(i[1]),s=r),{type:\"link\",raw:i[0],text:r,href:s,tokens:[{type:\"text\",raw:r,text:r}]}}}url(e,n){let i;if(i=this.rules.inline.url.exec(e)){let r,s;if(i[2]===\"@\")r=I(this.options.mangle?n(i[0]):i[0]),s=\"mailto:\"+r;else{let l;do l=i[0],i[0]=this.rules.inline._backpedal.exec(i[0])[0];while(l!==i[0]);r=I(i[0]),i[1]===\"www.\"?s=\"http://\"+i[0]:s=i[0]}return{type:\"link\",raw:i[0],text:r,href:s,tokens:[{type:\"text\",raw:r,text:r}]}}}inlineText(e,n){const i=this.rules.inline.text.exec(e);if(i){let r;return this.lexer.state.inRawBlock?r=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(i[0]):I(i[0]):i[0]:r=I(this.options.smartypants?n(i[0]):i[0]),{type:\"text\",raw:i[0],text:r}}}}const y={newline:/^(?: *(?:\\n|$))+/,code:/^( {4}[^\\n]+(?:\\n(?: *(?:\\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\\n]*(?:\\n|$))|~{3,})([^\\n]*)(?:\\n|$)(?:|([\\s\\S]*?)(?:\\n|$))(?: {0,3}\\1[~`]* *(?=\\n|$)|$)/,hr:/^ {0,3}((?:-[\\t ]*){3,}|(?:_[ \\t]*){3,}|(?:\\*[ \\t]*){3,})(?:\\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\\s|$)(.*)(?:\\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\\n]*)(?:\\n|$))+/,list:/^( {0,3}bull)([ \\t][^\\n]+?)?(?:\\n|$)/,html:\"^ {0,3}(?:<(script|pre|style|textarea)[\\\\s>][\\\\s\\\\S]*?(?:</\\\\1>[^\\\\n]*\\\\n+|$)|comment[^\\\\n]*(\\\\n+|$)|<\\\\?[\\\\s\\\\S]*?(?:\\\\?>\\\\n*|$)|<![A-Z][\\\\s\\\\S]*?(?:>\\\\n*|$)|<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?(?:\\\\]\\\\]>\\\\n*|$)|</?(tag)(?: +|\\\\n|/?>)[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$)|<(?!script|pre|style|textarea)([a-z][\\\\w-]*)(?:attribute)*? */?>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$)|</(?!script|pre|style|textarea)[a-z][\\\\w-]*\\\\s*>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:(?:\\\\n *)+\\\\n|$))\",def:/^ {0,3}\\[(label)\\]: *(?:\\n *)?([^<\\s][^\\s]*|<.*?>)(?:(?: +(?:\\n *)?| *\\n *)(title))? *(?:\\n+|$)/,table:Ie,lheading:/^((?:.|\\n(?!\\n))+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,_paragraph:/^([^\\n]+(?:\\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\\n)[^\\n]+)*)/,text:/^[^\\n]+/};y._label=/(?!\\s*\\])(?:\\\\.|[^\\[\\]\\\\])+/;y._title=/(?:\"(?:\\\\\"?|[^\"\\\\])*\"|'[^'\\n]*(?:\\n[^'\\n]+)*\\n?'|\\([^()]*\\))/;y.def=S(y.def).replace(\"label\",y._label).replace(\"title\",y._title).getRegex();y.bullet=/(?:[*+-]|\\d{1,9}[.)])/;y.listItemStart=S(/^( *)(bull) */).replace(\"bull\",y.bullet).getRegex();y.list=S(y.list).replace(/bull/g,y.bullet).replace(\"hr\",\"\\\\n+(?=\\\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$))\").replace(\"def\",\"\\\\n+(?=\"+y.def.source+\")\").getRegex();y._tag=\"address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul\";y._comment=/<!--(?!-?>)[\\s\\S]*?(?:-->|$)/;y.html=S(y.html,\"i\").replace(\"comment\",y._comment).replace(\"tag\",y._tag).replace(\"attribute\",/ +[a-zA-Z:_][\\w.:-]*(?: *= *\"[^\"\\n]*\"| *= *'[^'\\n]*'| *= *[^\\s\"'=<>`]+)?/).getRegex();y.paragraph=S(y._paragraph).replace(\"hr\",y.hr).replace(\"heading\",\" {0,3}#{1,6} \").replace(\"|lheading\",\"\").replace(\"|table\",\"\").replace(\"blockquote\",\" {0,3}>\").replace(\"fences\",\" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\",\" {0,3}(?:[*+-]|1[.)]) \").replace(\"html\",\"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)\").replace(\"tag\",y._tag).getRegex();y.blockquote=S(y.blockquote).replace(\"paragraph\",y.paragraph).getRegex();y.normal={...y};y.gfm={...y.normal,table:\"^ *([^\\\\n ].*\\\\|.*)\\\\n {0,3}(?:\\\\| *)?(:?-+:? *(?:\\\\| *:?-+:? *)*)(?:\\\\| *)?(?:\\\\n((?:(?! *\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)\"};y.gfm.table=S(y.gfm.table).replace(\"hr\",y.hr).replace(\"heading\",\" {0,3}#{1,6} \").replace(\"blockquote\",\" {0,3}>\").replace(\"code\",\" {4}[^\\\\n]\").replace(\"fences\",\" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\",\" {0,3}(?:[*+-]|1[.)]) \").replace(\"html\",\"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)\").replace(\"tag\",y._tag).getRegex();y.gfm.paragraph=S(y._paragraph).replace(\"hr\",y.hr).replace(\"heading\",\" {0,3}#{1,6} \").replace(\"|lheading\",\"\").replace(\"table\",y.gfm.table).replace(\"blockquote\",\" {0,3}>\").replace(\"fences\",\" {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n\").replace(\"list\",\" {0,3}(?:[*+-]|1[.)]) \").replace(\"html\",\"</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|textarea|!--)\").replace(\"tag\",y._tag).getRegex();y.pedantic={...y.normal,html:S(`^ *(?:comment *(?:\\\\n|\\\\s*$)|<(tag)[\\\\s\\\\S]+?</\\\\1> *(?:\\\\n{2,}|\\\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\\\s[^'\"/>\\\\s]*)*?/?> *(?:\\\\n{2,}|\\\\s*$))`).replace(\"comment\",y._comment).replace(/tag/g,\"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\\\b)\\\\w+(?!:|[^\\\\w\\\\s@]*@)\\\\b\").getRegex(),def:/^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +([\"(][^\\n]+[\")]))? *(?:\\n+|$)/,heading:/^(#{1,6})(.*)(?:\\n+|$)/,fences:Ie,lheading:/^(.+?)\\n {0,3}(=+|-+) *(?:\\n+|$)/,paragraph:S(y.normal._paragraph).replace(\"hr\",y.hr).replace(\"heading\",` *#{1,6} *[^\n]`).replace(\"lheading\",y.lheading).replace(\"blockquote\",\" {0,3}>\").replace(\"|fences\",\"\").replace(\"|list\",\"\").replace(\"|html\",\"\").getRegex()};const p={escape:/^\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/,autolink:/^<(scheme:[^\\s\\x00-\\x1f<>]*|email)>/,url:Ie,tag:\"^comment|^</[a-zA-Z][\\\\w:-]*\\\\s*>|^<[a-zA-Z][\\\\w-]*(?:attribute)*?\\\\s*/?>|^<\\\\?[\\\\s\\\\S]*?\\\\?>|^<![a-zA-Z]+\\\\s[\\\\s\\\\S]*?>|^<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>\",link:/^!?\\[(label)\\]\\(\\s*(href)(?:\\s+(title))?\\s*\\)/,reflink:/^!?\\[(label)\\]\\[(ref)\\]/,nolink:/^!?\\[(ref)\\](?:\\[\\])?/,reflinkSearch:\"reflink|nolink(?!\\\\()\",emStrong:{lDelim:/^(?:\\*+(?:([punct_])|[^\\s*]))|^_+(?:([punct*])|([^\\s_]))/,rDelimAst:/^(?:[^_*\\\\]|\\\\.)*?\\_\\_(?:[^_*\\\\]|\\\\.)*?\\*(?:[^_*\\\\]|\\\\.)*?(?=\\_\\_)|(?:[^*\\\\]|\\\\.)+(?=[^*])|[punct_](\\*+)(?=[\\s]|$)|(?:[^punct*_\\s\\\\]|\\\\.)(\\*+)(?=[punct_\\s]|$)|[punct_\\s](\\*+)(?=[^punct*_\\s])|[\\s](\\*+)(?=[punct_])|[punct_](\\*+)(?=[punct_])|(?:[^punct*_\\s\\\\]|\\\\.)(\\*+)(?=[^punct*_\\s])/,rDelimUnd:/^(?:[^_*\\\\]|\\\\.)*?\\*\\*(?:[^_*\\\\]|\\\\.)*?\\_(?:[^_*\\\\]|\\\\.)*?(?=\\*\\*)|(?:[^_\\\\]|\\\\.)+(?=[^_])|[punct*](\\_+)(?=[\\s]|$)|(?:[^punct*_\\s\\\\]|\\\\.)(\\_+)(?=[punct*\\s]|$)|[punct*\\s](\\_+)(?=[^punct*_\\s])|[\\s](\\_+)(?=[punct*])|[punct*](\\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\\s\\S]*?[^`])\\1(?!`)/,br:/^( {2,}|\\\\)\\n(?!\\s*$)/,del:Ie,text:/^(`+|[^`])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*_]|\\b_|$)|[^ ](?= {2,}\\n)))/,punctuation:/^([\\spunctuation])/};p._punctuation=\"!\\\"#$%&'()+\\\\-.,/:;<=>?@\\\\[\\\\]`^{|}~\";p.punctuation=S(p.punctuation).replace(/punctuation/g,p._punctuation).getRegex();p.blockSkip=/\\[[^\\]]*?\\]\\([^\\)]*?\\)|`[^`]*?`|<[^>]*?>/g;p.escapedEmSt=/(?:^|[^\\\\])(?:\\\\\\\\)*\\\\[*_]/g;p._comment=S(y._comment).replace(\"(?:-->|$)\",\"-->\").getRegex();p.emStrong.lDelim=S(p.emStrong.lDelim).replace(/punct/g,p._punctuation).getRegex();p.emStrong.rDelimAst=S(p.emStrong.rDelimAst,\"g\").replace(/punct/g,p._punctuation).getRegex();p.emStrong.rDelimUnd=S(p.emStrong.rDelimUnd,\"g\").replace(/punct/g,p._punctuation).getRegex();p._escapes=/\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/g;p._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;p._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;p.autolink=S(p.autolink).replace(\"scheme\",p._scheme).replace(\"email\",p._email).getRegex();p._attribute=/\\s+[a-zA-Z:_][\\w.:-]*(?:\\s*=\\s*\"[^\"]*\"|\\s*=\\s*'[^']*'|\\s*=\\s*[^\\s\"'=<>`]+)?/;p.tag=S(p.tag).replace(\"comment\",p._comment).replace(\"attribute\",p._attribute).getRegex();p._label=/(?:\\[(?:\\\\.|[^\\[\\]\\\\])*\\]|\\\\.|`[^`]*`|[^\\[\\]\\\\`])*?/;p._href=/<(?:\\\\.|[^\\n<>\\\\])+>|[^\\s\\x00-\\x1f]*/;p._title=/\"(?:\\\\\"?|[^\"\\\\])*\"|'(?:\\\\'?|[^'\\\\])*'|\\((?:\\\\\\)?|[^)\\\\])*\\)/;p.link=S(p.link).replace(\"label\",p._label).replace(\"href\",p._href).replace(\"title\",p._title).getRegex();p.reflink=S(p.reflink).replace(\"label\",p._label).replace(\"ref\",y._label).getRegex();p.nolink=S(p.nolink).replace(\"ref\",y._label).getRegex();p.reflinkSearch=S(p.reflinkSearch,\"g\").replace(\"reflink\",p.reflink).replace(\"nolink\",p.nolink).getRegex();p.normal={...p};p.pedantic={...p.normal,strong:{start:/^__|\\*\\*/,middle:/^__(?=\\S)([\\s\\S]*?\\S)__(?!_)|^\\*\\*(?=\\S)([\\s\\S]*?\\S)\\*\\*(?!\\*)/,endAst:/\\*\\*(?!\\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\\*/,middle:/^()\\*(?=\\S)([\\s\\S]*?\\S)\\*(?!\\*)|^_(?=\\S)([\\s\\S]*?\\S)_(?!_)/,endAst:/\\*(?!\\*)/g,endUnd:/_(?!_)/g},link:S(/^!?\\[(label)\\]\\((.*?)\\)/).replace(\"label\",p._label).getRegex(),reflink:S(/^!?\\[(label)\\]\\s*\\[([^\\]]*)\\]/).replace(\"label\",p._label).getRegex()};p.gfm={...p.normal,escape:S(p.escape).replace(\"])\",\"~|])\").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\\/\\/|www\\.)(?:[a-zA-Z0-9\\-]+\\.?)+[^\\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'\"~()&]+|\\([^)]*\\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'\"~)]+(?!$))+/,del:/^(~~?)(?=[^\\s~])([\\s\\S]*?[^\\s~])\\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\\n)|(?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*~_]|\\b_|https?:\\/\\/|ftp:\\/\\/|www\\.|$)|[^ ](?= {2,}\\n)|[^a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-](?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@)))/};p.gfm.url=S(p.gfm.url,\"i\").replace(\"email\",p.gfm._extended_email).getRegex();p.breaks={...p.gfm,br:S(p.br).replace(\"{2,}\",\"*\").getRegex(),text:S(p.gfm.text).replace(\"\\\\b_\",\"\\\\b_| {2,}\\\\n\").replace(/\\{2,\\}/g,\"*\").getRegex()};function Vo(t){return t.replace(/---/g,\"\").replace(/--/g,\"\").replace(/(^|[-\\u2014/(\\[{\"\\s])'/g,\"$1\").replace(/'/g,\"\").replace(/(^|[-\\u2014/(\\[{\\u2018\\s])\"/g,\"$1\").replace(/\"/g,\"\").replace(/\\.{3}/g,\"\")}function qt(t){let e=\"\",n,i;const r=t.length;for(n=0;n<r;n++)i=t.charCodeAt(n),Math.random()>.5&&(i=\"x\"+i.toString(16)),e+=\"&#\"+i+\";\";return e}class K{constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||oe,this.options.tokenizer=this.options.tokenizer||new kt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const n={block:y.normal,inline:p.normal};this.options.pedantic?(n.block=y.pedantic,n.inline=p.pedantic):this.options.gfm&&(n.block=y.gfm,this.options.breaks?n.inline=p.breaks:n.inline=p.gfm),this.tokenizer.rules=n}static get rules(){return{block:y,inline:p}}static lex(e,n){return new K(n).lex(e)}static lexInline(e,n){return new K(n).inlineTokens(e)}lex(e){e=e.replace(/\\r\\n|\\r/g,`\n`),this.blockTokens(e,this.tokens);let n;for(;n=this.inlineQueue.shift();)this.inlineTokens(n.src,n.tokens);return this.tokens}blockTokens(e,n=[]){this.options.pedantic?e=e.replace(/\\t/g,\"    \").replace(/^ +$/gm,\"\"):e=e.replace(/^( *)(\\t+)/gm,(a,o,c)=>o+\"    \".repeat(c.length));let i,r,s,l;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(i=a.call({lexer:this},e,n))?(e=e.substring(i.raw.length),n.push(i),!0):!1))){if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length),i.raw.length===1&&n.length>0?n[n.length-1].raw+=`\n`:n.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length),r=n[n.length-1],r&&(r.type===\"paragraph\"||r.type===\"text\")?(r.raw+=`\n`+i.raw,r.text+=`\n`+i.text,this.inlineQueue[this.inlineQueue.length-1].src=r.text):n.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length),r=n[n.length-1],r&&(r.type===\"paragraph\"||r.type===\"text\")?(r.raw+=`\n`+i.raw,r.text+=`\n`+i.raw,this.inlineQueue[this.inlineQueue.length-1].src=r.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title});continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),n.push(i);continue}if(s=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0;const o=e.slice(1);let c;this.options.extensions.startBlock.forEach(function(u){c=u.call({lexer:this},o),typeof c==\"number\"&&c>=0&&(a=Math.min(a,c))}),a<1/0&&a>=0&&(s=e.substring(0,a+1))}if(this.state.top&&(i=this.tokenizer.paragraph(s))){r=n[n.length-1],l&&r.type===\"paragraph\"?(r.raw+=`\n`+i.raw,r.text+=`\n`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):n.push(i),l=s.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length),r=n[n.length-1],r&&r.type===\"text\"?(r.raw+=`\n`+i.raw,r.text+=`\n`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=r.text):n.push(i);continue}if(e){const a=\"Infinite loop on byte: \"+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){let i,r,s,l=e,a,o,c;if(this.tokens.links){const u=Object.keys(this.tokens.links);if(u.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(l))!=null;)u.includes(a[0].slice(a[0].lastIndexOf(\"[\")+1,-1))&&(l=l.slice(0,a.index)+\"[\"+jt(\"a\",a[0].length-2)+\"]\"+l.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(l))!=null;)l=l.slice(0,a.index)+\"[\"+jt(\"a\",a[0].length-2)+\"]\"+l.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.escapedEmSt.exec(l))!=null;)l=l.slice(0,a.index+a[0].length-2)+\"++\"+l.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;e;)if(o||(c=\"\"),o=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(u=>(i=u.call({lexer:this},e,n))?(e=e.substring(i.raw.length),n.push(i),!0):!1))){if(i=this.tokenizer.escape(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.tag(e)){e=e.substring(i.raw.length),r=n[n.length-1],r&&i.type===\"text\"&&r.type===\"text\"?(r.raw+=i.raw,r.text+=i.text):n.push(i);continue}if(i=this.tokenizer.link(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(i.raw.length),r=n[n.length-1],r&&i.type===\"text\"&&r.type===\"text\"?(r.raw+=i.raw,r.text+=i.text):n.push(i);continue}if(i=this.tokenizer.emStrong(e,l,c)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.codespan(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.br(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.del(e)){e=e.substring(i.raw.length),n.push(i);continue}if(i=this.tokenizer.autolink(e,qt)){e=e.substring(i.raw.length),n.push(i);continue}if(!this.state.inLink&&(i=this.tokenizer.url(e,qt))){e=e.substring(i.raw.length),n.push(i);continue}if(s=e,this.options.extensions&&this.options.extensions.startInline){let u=1/0;const d=e.slice(1);let f;this.options.extensions.startInline.forEach(function(h){f=h.call({lexer:this},d),typeof f==\"number\"&&f>=0&&(u=Math.min(u,f))}),u<1/0&&u>=0&&(s=e.substring(0,u+1))}if(i=this.tokenizer.inlineText(s,Vo)){e=e.substring(i.raw.length),i.raw.slice(-1)!==\"_\"&&(c=i.raw.slice(-1)),o=!0,r=n[n.length-1],r&&r.type===\"text\"?(r.raw+=i.raw,r.text+=i.text):n.push(i);continue}if(e){const u=\"Infinite loop on byte: \"+e.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return n}}class He{constructor(e){this.options=e||oe}code(e,n,i){const r=(n||\"\").match(/\\S*/)[0];if(this.options.highlight){const s=this.options.highlight(e,r);s!=null&&s!==e&&(i=!0,e=s)}return e=e.replace(/\\n$/,\"\")+`\n`,r?'<pre><code class=\"'+this.options.langPrefix+I(r)+'\">'+(i?e:I(e,!0))+`</code></pre>\n`:\"<pre><code>\"+(i?e:I(e,!0))+`</code></pre>\n`}blockquote(e){return`<blockquote>\n${e}</blockquote>\n`}html(e){return e}heading(e,n,i,r){if(this.options.headerIds){const s=this.options.headerPrefix+r.slug(i);return`<h${n} id=\"${s}\">${e}</h${n}>\n`}return`<h${n}>${e}</h${n}>\n`}hr(){return this.options.xhtml?`<hr/>\n`:`<hr>\n`}list(e,n,i){const r=n?\"ol\":\"ul\",s=n&&i!==1?' start=\"'+i+'\"':\"\";return\"<\"+r+s+`>\n`+e+\"</\"+r+`>\n`}listitem(e){return`<li>${e}</li>\n`}checkbox(e){return\"<input \"+(e?'checked=\"\" ':\"\")+'disabled=\"\" type=\"checkbox\"'+(this.options.xhtml?\" /\":\"\")+\"> \"}paragraph(e){return`<p>${e}</p>\n`}table(e,n){return n&&(n=`<tbody>${n}</tbody>`),`<table>\n<thead>\n`+e+`</thead>\n`+n+`</table>\n`}tablerow(e){return`<tr>\n${e}</tr>\n`}tablecell(e,n){const i=n.header?\"th\":\"td\";return(n.align?`<${i} align=\"${n.align}\">`:`<${i}>`)+e+`</${i}>\n`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?\"<br/>\":\"<br>\"}del(e){return`<del>${e}</del>`}link(e,n,i){if(e=Rt(this.options.sanitize,this.options.baseUrl,e),e===null)return i;let r='<a href=\"'+e+'\"';return n&&(r+=' title=\"'+n+'\"'),r+=\">\"+i+\"</a>\",r}image(e,n,i){if(e=Rt(this.options.sanitize,this.options.baseUrl,e),e===null)return i;let r=`<img src=\"${e}\" alt=\"${i}\"`;return n&&(r+=` title=\"${n}\"`),r+=this.options.xhtml?\"/>\":\">\",r}text(e){return e}}class Mn{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,n,i){return\"\"+i}image(e,n,i){return\"\"+i}br(){return\"\"}}class Rn{constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\\/a-z].*?>/ig,\"\").replace(/[\\u2000-\\u206F\\u2E00-\\u2E7F\\\\'!\"#$%&()*+,./:;<=>?@[\\]^`{|}~]/g,\"\").replace(/\\s/g,\"-\")}getNextSafeSlug(e,n){let i=e,r=0;if(this.seen.hasOwnProperty(i)){r=this.seen[e];do r++,i=e+\"-\"+r;while(this.seen.hasOwnProperty(i))}return n||(this.seen[e]=r,this.seen[i]=0),i}slug(e,n={}){const i=this.serialize(e);return this.getNextSafeSlug(i,n.dryrun)}}class Y{constructor(e){this.options=e||oe,this.options.renderer=this.options.renderer||new He,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Mn,this.slugger=new Rn}static parse(e,n){return new Y(n).parse(e)}static parseInline(e,n){return new Y(n).parseInline(e)}parse(e,n=!0){let i=\"\",r,s,l,a,o,c,u,d,f,h,g,v,O,x,A,M,w,k,_;const C=e.length;for(r=0;r<C;r++){if(h=e[r],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[h.type]&&(_=this.options.extensions.renderers[h.type].call({parser:this},h),_!==!1||![\"space\",\"hr\",\"heading\",\"code\",\"table\",\"blockquote\",\"list\",\"html\",\"paragraph\",\"text\"].includes(h.type))){i+=_||\"\";continue}switch(h.type){case\"space\":continue;case\"hr\":{i+=this.renderer.hr();continue}case\"heading\":{i+=this.renderer.heading(this.parseInline(h.tokens),h.depth,Nn(this.parseInline(h.tokens,this.textRenderer)),this.slugger);continue}case\"code\":{i+=this.renderer.code(h.text,h.lang,h.escaped);continue}case\"table\":{for(d=\"\",u=\"\",a=h.header.length,s=0;s<a;s++)u+=this.renderer.tablecell(this.parseInline(h.header[s].tokens),{header:!0,align:h.align[s]});for(d+=this.renderer.tablerow(u),f=\"\",a=h.rows.length,s=0;s<a;s++){for(c=h.rows[s],u=\"\",o=c.length,l=0;l<o;l++)u+=this.renderer.tablecell(this.parseInline(c[l].tokens),{header:!1,align:h.align[l]});f+=this.renderer.tablerow(u)}i+=this.renderer.table(d,f);continue}case\"blockquote\":{f=this.parse(h.tokens),i+=this.renderer.blockquote(f);continue}case\"list\":{for(g=h.ordered,v=h.start,O=h.loose,a=h.items.length,f=\"\",s=0;s<a;s++)A=h.items[s],M=A.checked,w=A.task,x=\"\",A.task&&(k=this.renderer.checkbox(M),O?A.tokens.length>0&&A.tokens[0].type===\"paragraph\"?(A.tokens[0].text=k+\" \"+A.tokens[0].text,A.tokens[0].tokens&&A.tokens[0].tokens.length>0&&A.tokens[0].tokens[0].type===\"text\"&&(A.tokens[0].tokens[0].text=k+\" \"+A.tokens[0].tokens[0].text)):A.tokens.unshift({type:\"text\",text:k}):x+=k),x+=this.parse(A.tokens,O),f+=this.renderer.listitem(x,w,M);i+=this.renderer.list(f,g,v);continue}case\"html\":{i+=this.renderer.html(h.text);continue}case\"paragraph\":{i+=this.renderer.paragraph(this.parseInline(h.tokens));continue}case\"text\":{for(f=h.tokens?this.parseInline(h.tokens):h.text;r+1<C&&e[r+1].type===\"text\";)h=e[++r],f+=`\n`+(h.tokens?this.parseInline(h.tokens):h.text);i+=n?this.renderer.paragraph(f):f;continue}default:{const T='Token with \"'+h.type+'\" type was not found.';if(this.options.silent){console.error(T);return}else throw new Error(T)}}}return i}parseInline(e,n){n=n||this.renderer;let i=\"\",r,s,l;const a=e.length;for(r=0;r<a;r++){if(s=e[r],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]&&(l=this.options.extensions.renderers[s.type].call({parser:this},s),l!==!1||![\"escape\",\"html\",\"link\",\"image\",\"strong\",\"em\",\"codespan\",\"br\",\"del\",\"text\"].includes(s.type))){i+=l||\"\";continue}switch(s.type){case\"escape\":{i+=n.text(s.text);break}case\"html\":{i+=n.html(s.text);break}case\"link\":{i+=n.link(s.href,s.title,this.parseInline(s.tokens,n));break}case\"image\":{i+=n.image(s.href,s.title,s.text);break}case\"strong\":{i+=n.strong(this.parseInline(s.tokens,n));break}case\"em\":{i+=n.em(this.parseInline(s.tokens,n));break}case\"codespan\":{i+=n.codespan(s.text);break}case\"br\":{i+=n.br();break}case\"del\":{i+=n.del(this.parseInline(s.tokens,n));break}case\"text\":{i+=n.text(s.text);break}default:{const o='Token with \"'+s.type+'\" type was not found.';if(this.options.silent){console.error(o);return}else throw new Error(o)}}}return i}}class Ne{constructor(e){this.options=e||oe}preprocess(e){return e}postprocess(e){return e}}Z(Ne,\"passThroughHooks\",new Set([\"preprocess\",\"postprocess\"]));function Zo(t,e,n){return i=>{if(i.message+=`\nPlease report this to https://github.com/markedjs/marked.`,t){const r=\"<p>An error occurred:</p><pre>\"+I(i.message+\"\",!0)+\"</pre>\";if(e)return Promise.resolve(r);if(n){n(null,r);return}return r}if(e)return Promise.reject(i);if(n){n(i);return}throw i}}function Dn(t,e){return(n,i,r)=>{typeof i==\"function\"&&(r=i,i=null);const s={...i};i={...b.defaults,...s};const l=Zo(i.silent,i.async,r);if(typeof n>\"u\"||n===null)return l(new Error(\"marked(): input parameter is undefined or null\"));if(typeof n!=\"string\")return l(new Error(\"marked(): input parameter is of type \"+Object.prototype.toString.call(n)+\", string expected\"));if(Bo(i),i.hooks&&(i.hooks.options=i),r){const a=i.highlight;let o;try{i.hooks&&(n=i.hooks.preprocess(n)),o=t(n,i)}catch(d){return l(d)}const c=function(d){let f;if(!d)try{i.walkTokens&&b.walkTokens(o,i.walkTokens),f=e(o,i),i.hooks&&(f=i.hooks.postprocess(f))}catch(h){d=h}return i.highlight=a,d?l(d):r(null,f)};if(!a||a.length<3||(delete i.highlight,!o.length))return c();let u=0;b.walkTokens(o,function(d){d.type===\"code\"&&(u++,setTimeout(()=>{a(d.text,d.lang,function(f,h){if(f)return c(f);h!=null&&h!==d.text&&(d.text=h,d.escaped=!0),u--,u===0&&c()})},0))}),u===0&&c();return}if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(n):n).then(a=>t(a,i)).then(a=>i.walkTokens?Promise.all(b.walkTokens(a,i.walkTokens)).then(()=>a):a).then(a=>e(a,i)).then(a=>i.hooks?i.hooks.postprocess(a):a).catch(l);try{i.hooks&&(n=i.hooks.preprocess(n));const a=t(n,i);i.walkTokens&&b.walkTokens(a,i.walkTokens);let o=e(a,i);return i.hooks&&(o=i.hooks.postprocess(o)),o}catch(a){return l(a)}}}function b(t,e,n){return Dn(K.lex,Y.parse)(t,e,n)}b.options=b.setOptions=function(t){return b.defaults={...b.defaults,...t},Lo(b.defaults),b};b.getDefaults=Pn;b.defaults=oe;b.use=function(...t){const e=b.defaults.extensions||{renderers:{},childTokens:{}};t.forEach(n=>{const i={...n};if(i.async=b.defaults.async||i.async||!1,n.extensions&&(n.extensions.forEach(r=>{if(!r.name)throw new Error(\"extension name required\");if(r.renderer){const s=e.renderers[r.name];s?e.renderers[r.name]=function(...l){let a=r.renderer.apply(this,l);return a===!1&&(a=s.apply(this,l)),a}:e.renderers[r.name]=r.renderer}if(r.tokenizer){if(!r.level||r.level!==\"block\"&&r.level!==\"inline\")throw new Error(\"extension level must be 'block' or 'inline'\");e[r.level]?e[r.level].unshift(r.tokenizer):e[r.level]=[r.tokenizer],r.start&&(r.level===\"block\"?e.startBlock?e.startBlock.push(r.start):e.startBlock=[r.start]:r.level===\"inline\"&&(e.startInline?e.startInline.push(r.start):e.startInline=[r.start]))}r.childTokens&&(e.childTokens[r.name]=r.childTokens)}),i.extensions=e),n.renderer){const r=b.defaults.renderer||new He;for(const s in n.renderer){const l=r[s];r[s]=(...a)=>{let o=n.renderer[s].apply(r,a);return o===!1&&(o=l.apply(r,a)),o}}i.renderer=r}if(n.tokenizer){const r=b.defaults.tokenizer||new kt;for(const s in n.tokenizer){const l=r[s];r[s]=(...a)=>{let o=n.tokenizer[s].apply(r,a);return o===!1&&(o=l.apply(r,a)),o}}i.tokenizer=r}if(n.hooks){const r=b.defaults.hooks||new Ne;for(const s in n.hooks){const l=r[s];Ne.passThroughHooks.has(s)?r[s]=a=>{if(b.defaults.async)return Promise.resolve(n.hooks[s].call(r,a)).then(c=>l.call(r,c));const o=n.hooks[s].call(r,a);return l.call(r,o)}:r[s]=(...a)=>{let o=n.hooks[s].apply(r,a);return o===!1&&(o=l.apply(r,a)),o}}i.hooks=r}if(n.walkTokens){const r=b.defaults.walkTokens;i.walkTokens=function(s){let l=[];return l.push(n.walkTokens.call(this,s)),r&&(l=l.concat(r.call(this,s))),l}}b.setOptions(i)})};b.walkTokens=function(t,e){let n=[];for(const i of t)switch(n=n.concat(e.call(b,i)),i.type){case\"table\":{for(const r of i.header)n=n.concat(b.walkTokens(r.tokens,e));for(const r of i.rows)for(const s of r)n=n.concat(b.walkTokens(s.tokens,e));break}case\"list\":{n=n.concat(b.walkTokens(i.items,e));break}default:b.defaults.extensions&&b.defaults.extensions.childTokens&&b.defaults.extensions.childTokens[i.type]?b.defaults.extensions.childTokens[i.type].forEach(function(r){n=n.concat(b.walkTokens(i[r],e))}):i.tokens&&(n=n.concat(b.walkTokens(i.tokens,e)))}return n};b.parseInline=Dn(K.lexInline,Y.parseInline);b.Parser=Y;b.parser=Y.parse;b.Renderer=He;b.TextRenderer=Mn;b.Lexer=K;b.lexer=K.lex;b.Tokenizer=kt;b.Slugger=Rn;b.Hooks=Ne;b.parse=b;b.options;b.setOptions;b.use;b.walkTokens;b.parseInline;Y.parse;K.lex;const xt=new He;xt.blockquote=t=>`<div class=\"fork\">${t}</div>`;xt.del=t=>`<span class=\"small-caps\">${t}</span>`;function Go(t,e){var i,r;const n=t.substring(1,t.length-1).trim();if(/\\s/.test(n)){const s=(i=n.match(/^[^:,]+/))==null?void 0:i[0];if(!s)return t;const l=e.find(a=>a.match.test(s));if(l){const a=n.replace(s,\"\");if(a[0]===\":\"){const o=new Function(`return {\"${s}\" ${a}}`)(),c=o[s];return delete o[s],l.render(c,o,n)}else if(a[0]===\",\"){const o=new Function(`return {${a.substring(1)}}`)();return l.render(null,o,n)}else if(a===\"\")return l.render(null,{},n)}}else{const s=/(.+)\\[(.+)\\]$/.exec(n);let l;if(s?l=(r=m(s[1]))==null?void 0:r[s[2]]:l=m(n),l!==void 0)return l}return t}function Jo(t,e){let n=\"\",i=0,r=t.indexOf(\"{\");if(r===-1)return t;let s=!1,l;for(let a=r+1;a<t.length;a++)switch(t[a]){case\"{\":r=a,s=!1;break;case'\"':case\"'\":a>0&&t[a-1]!==\"\\\\\"&&(s?s&&l===t[a]&&(s=!1):(s=!0,l=t[a]));break;case\"}\":if(!s){const o=t.substring(r,a+1);let c=\"\";try{c=Go(o,e)}catch(u){console.warn(`An error occurred while rendering \"${o}\": ${u.message}`),c=o}c===void 0&&(c=\"\"),n+=t.substring(i,r)+c,i=a+1,r=t.indexOf(\"{\",i),r===-1&&(a=t.length)}break}return n+t.substring(i)}const{log:G}=F(\"render\"),Xo={renderer:xt,smartypants:!0};function Wo(t,e,n,i=!1){if(!t.vars)throw new Error(\"The renderer was given an object with no vars property.\");if(!t.blocks)throw new Error(\"The renderer was given an object with no blocks property.\");let r=\"\";if(!i){G(`Setting vars (${t.vars.length})`);for(const o of t.vars)o.condition?o.condition()?(G(`Setting var \"${o.name}\" (condition is currently true)`),E(o.name,o.value())):G(`Not setting var \"${o.name}\" (condition is currently false)`):(G(`Setting var \"${o.name}\"`),E(o.name,o.value()))}let s=[];const l=new Map;for(const o of t.blocks)switch(o.type){case\"text\":{const c={text:o.content,startsNewParagraph:!0},u=s.filter(f=>!!f.modifier.processRaw);G(`Running ${u.length} modifiers on raw source block`);for(const{invocation:f,modifier:h}of u){const g=l.get(h);if(!g)throw new Error(\"State for a modifier was unknown, but should have had a value.\");if(!h.processRaw)throw new Error(\"A modifier was added to the raw modifiers list, but it has no processRaw function.\");h.processRaw(c,{state:g,invocation:f})}c.text=Jo(Ws(c.text),e);const d=s.filter(f=>!!f.modifier.process);G(`Running ${d.length} modifiers on source block`);for(const{invocation:f,modifier:h}of d){const g=l.get(h);if(!g)throw new Error(\"State for a modifier was unknown, but should have had a value.\");if(!h.process)throw new Error(\"A modifier was added to the processed modifiers list, but it has no process function.\");h.process(c,{state:g,invocation:f})}G(`Output after modifiers: ${JSON.stringify(c)}`),c.text.trim()!==\"\"&&(r!==\"\"&&(r+=c.startsNewParagraph?`\n\n`:\" \"),r+=c.text),s=[];break}case\"modifier\":{const c=n.filter(u=>u.match.test(o.content));if(c.length===1){const u=c[0];G(`Activated modifier matching [${o.content}]`),l.has(u)||l.set(u,{}),s.push({modifier:u,invocation:o.content})}else c.length===0?r+=`\n\n[${o.content}]\n\n`:(console.warn(`More than one modifier matched \"[${o.content}]\".`),r+=`\n\n[${o.content}]\n\n`);break}default:throw new Error(`Don't know how to render a block with type \"${o.type}\".`)}const a=/^((>|-|\\*).*$)\\n{2,}\\2/gm;for(;a.test(r);)r=r.replace(a,`$1\n$2`);return b.setOptions(Xo),G(`Final Markdown:\n${r}`),b(r)}function ve(t,e=!1){return Wo(To(t),An(),zn(),e)}class Qo extends Ee{constructor(){super(),this.addEventListener(\"click\",()=>{let e=this.getAttribute(\"text\");const n=this.getAttribute(\"passage\");if(n){const i=$e(n);i&&(e=i.source)}if(e){const i=document.createElement(\"div\");i.innerHTML=ve(e).trim();const r=this.closest(\"body-content, marginal-content\");if(!r)throw new Error(\"Couldn't find suitable parent element to do a reveal link transition on.\");r.changeContent(()=>{var l,a;const s=i.children.length;if(s>0&&this.parentNode){const o=document.createElement(\"span\");if(o.innerHTML=((l=i.firstElementChild)==null?void 0:l.innerHTML)??\"\",this.parentNode.insertBefore(o,this),(a=i.firstElementChild)==null||a.remove(),s>1&&this.parentNode.parentNode&&i.lastChild){const c=i.lastChild;for(;i.lastChild;)this.parentNode.parentNode.insertBefore(i.lastChild,this.parentNode.nextSibling);for(;this.nextSibling;)c.insertBefore(this.nextSibling,null)}}this.remove()})}})}}class jn extends P{attributeChangedCallback(){const e=this.getAttribute(\"skippable-delay\");if(!e)return;const n=parseInt(e);if(isFinite(n))if(n===0){this.style.animationDelay=\"\";const i=this.className;this.className=\"\",this.offsetWidth,this.className=i}else this.style.animationDelay=`${n}ms`}}Z(jn,\"observedAttributes\",[\"skippable-delay\"]);class Ko extends P{constructor(){super(),this.delegate(\"change\",\"input, select\",e=>{const n=this.getAttribute(\"name\"),i=e.target;if(n)switch(i.nodeName){case\"INPUT\":E(n,i.value);break;case\"SELECT\":{const r=i.querySelectorAll(\"option\")[i.selectedIndex];E(n,r.dataset.jsonValue?JSON.parse(r.dataset.jsonValue):r.value)}}})}}function Yo(){mt({\"cycling-link\":Zs,\"inline-button\":Ee,\"passage-link\":Gs,\"restart-link\":Js,\"reveal-link\":Qo,\"skippable-animation\":jn,\"variable-binding\":Ko})}function Hn(){Yo()}const ea=Object.freeze(Object.defineProperty({__proto__:null,initTemplate:Hn,inserts:po,modifiers:_o,render:ve},Symbol.toStringTag,{value:\"Module\"})),ta=cn(t=>{if(t.some(e=>e[0])){const e=m(\"trail\");if(!Array.isArray(e))throw new Error(\"The trail variable has been set to a non-array value.\");if(typeof e[e.length-1]!=\"string\")throw new Error(\"The last value in the trail variable is not a string.\");const i=$e(e[e.length-1]);if(!i)throw new Error(`There is no passage named \"${e[e.length-1]}\".`);const r=ve(i.source),s={footer:{center:\"\",left:\"\",right:\"\"},header:{center:\"\",left:\"\",right:\"\"}};for(const l in s)for(const a in s[l])s[l][a]=ve(m(`config.${l}.${a}`).toString());window.dispatchEvent(new CustomEvent(\"display-change\",{detail:{body:r,...s}}))}});function na(){window.addEventListener(\"state-change\",({detail:t})=>{ta(t.name===\"trail\")})}const ia={\"config.body.transition.name\":\"crossfade\",\"config.body.transition.duration\":\"300ms\",\"config.header.left\":\"\",\"config.header.center\":\"\",\"config.header.right\":\"\",\"config.header.transition.name\":\"crossfade\",\"config.header.transition.duration\":\"300ms\",\"config.footer.left\":\"_{story.name}_\",\"config.footer.center\":\"\",\"config.footer.right\":\"{restart link}\",\"config.footer.transition.name\":\"crossfade\",\"config.footer.transition.duration\":\"300ms\"};function ra(){re(ia),Vs(),na()}const{warn:Te}=F(\"extensibility\");function Ft(t){return t.split(\".\").map(window.parseInt)}function sa(){window.engine={extend(t,e){const n=m(\"engine.version\");if(typeof n!=\"string\")throw new Error(`engine.version has been set to a ${typeof n}, not a string.`);const i=Ft(t),r=Ft(n);if(r[0]<i[0]){Te(`The current engine version (${n}) has a lower major version than requested (${t}); skipping`);return}r[0]>i[0]?Te(`The current engine version (${n}) has a higher major version than requested (${t}); running code but you may encounter problems`):(r[1]<i[1]&&Te(`The current engine version (${n}) has a lower minor version than requested (${t}); running code but you may encounter problems`),r[1]===i[1]&&r[2]<i[2]&&Te(`The current engine version (${n}) has a lower patch version than requested (${t}); running code but you may encounter problems`)),e()},log:Jt,state:Gr,story:Jr,template:ea,warn:Xt}}function oa(t,e,n,i){return(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e}function qn(t,e,n){const i=t.volume,r=e-i;let s,l=0;return t.volume===e?Promise.resolve():new Promise(a=>window.requestAnimationFrame(o=>{function c(u){l+=u-s,t.volume=oa(l,i,r,n),l<n?(s=u,window.requestAnimationFrame(c)):a()}s=o,window.requestAnimationFrame(c)}))}const{log:Ge}=F(\"sound\"),$={};function Be(t,e,n){$[t]?($[t].setAttribute(\"src\",e),n?$[t].setAttribute(\"preload\",\"auto\"):$[t].removeAttribute(\"preload\"),Ge(`Updated <audio> element in sound bank for \"${t}\" to use ${e}`)):($[t]=document.createElement(\"audio\"),$[t].setAttribute(\"src\",e),n&&$[t].setAttribute(\"preload\",\"auto\"),Ge(`Added new <audio> element to sound bank for \"${t}\" for ${e}`))}async function Le(t,e=!1,n=0){if(!$[t])throw new Error(`There is no sound loaded named ${t}.`);return Ge(`Playing sound \"${t}\" (looping: ${e})`),n>0&&($[t].volume=0,qn($[t],1,n)),e?($[t].loop=!0,$[t].play()):($[t].loop=!1,new Promise((i,r)=>{try{$[t].addEventListener(\"ended\",function s(){$[t].removeEventListener(\"ended\",s),i()}),$[t].play().catch(s=>r(s))}catch(s){r(s)}}))}function Bt(t,e=0){if(!$[t])throw new Error(`There is no sound loaded named ${t}.`);if(e<=0)$[t].pause(),$[t].currentTime=0;else{const n=$[t].volume;qn($[t],0,e).then(()=>{$[t].pause(),$[t].volume=n,$[t].currentTime=0})}}function Ut(t,e){if(!$[t])throw new Error(`There is no sound loaded named ${t}.`);$[t].muted=e}function Ue(t,e){if(!$[t])throw new Error(`There is no sound loaded named ${t}.`);if(e<0||e>1)throw new Error(\"A sound volume must be between 0 and 1.\");$[t].volume=e}const{warn:Vt}=F(\"sound\");function aa(){re({\"sound.mute\":!1,\"sound.volume\":1,\"sound.transitionDuration\":\"1s\"}),window.addEventListener(\"state-change\",({detail:t})=>{const{name:e,value:n}=t,i=[\"sound\",\"sound.ambient\"].includes(e),r=[\"sound\",\"sound.effect\"].includes(e);if(i){const l=m(\"sound.ambient\");if(typeof l==\"object\"&&l){const a=l;for(const o in a)typeof a[o].url==\"string\"&&Be(o,a[o].url,!1),typeof a[o].volume==\"number\"&&Ue(o,a[o].volume),\"muted\"in a[o]&&Ut(o,!!a[o].muted),a[o].playing===!0&&Le(o,!0).catch(c=>Vt(`Could not resume playing ambient sound \"${o}\" (${c.message})`))}}if(r){const l=m(\"sound.effect\");if(typeof l==\"object\"&&l){const a=l;for(const o in a)typeof a[o].url==\"string\"&&Be(o,a[o].url,!0),typeof a[o].volume==\"number\"&&Ue(o,a[o].volume),\"muted\"in a[o]&&Ut(o,!!a[o].muted),a[o].playing&&Le(o,!1).then(()=>E(`sound.effect.${o}.playing`,!1)).catch(c=>Vt(`Could not resume playing sound effect \"${o}\" (${c.message}`))}}if(i||r)return;const s=/^sound\\.(ambient|effect)\\.(.+?)\\.(.+)$/i.exec(e);if(s)switch(s[3].toLowerCase()){case\"playing\":{let l=\"0s\";typeof m(`${s[2]}.transitionDuration`)==\"string\"&&(l=m(`${s[2]}.transitionDuration`)),typeof m(\"sound.transitionDuration\")==\"string\"&&(l=m(\"sound.transitionDuration\")),n?s[1]===\"ambient\"?Le(s[2],!0,xe(l,\"ms\")):Le(s[2],!1).then(()=>E(e,!1)):s[1]===\"ambient\"?Bt(s[2],xe(l,\"ms\")):Bt(s[2]);break}case\"url\":Be(s[2],n,s[1]===\"effect\");break;case\"volume\":Ue(s[2],n);break}})}function la(){L(\"browser.height\",()=>window.innerHeight),L(\"browser.online\",()=>window.navigator.onLine),L(\"browser.width\",()=>window.innerWidth)}const ca=\"2.0.0\";function ua(){L(\"engine.version\",()=>ca)}function fa(){L(\"now.datestamp\",()=>new Date().toLocaleDateString(navigator.language)),L(\"now.second\",()=>new Date().getSeconds()),L(\"now.minute\",()=>new Date().getMinutes()),L(\"now.hour\",()=>new Date().getHours()),L(\"now.day\",()=>new Date().getDate()),L(\"now.weekday\",()=>new Date().getDay()+1),L(\"now.weekdayName\",()=>new Date().toLocaleString(navigator.language,{weekday:\"long\"})),L(\"now.month\",()=>new Date().getMonth()+1),L(\"now.monthName\",()=>new Date().toLocaleString(navigator.language,{month:\"long\"})),L(\"now.year\",()=>new Date().getFullYear()),L(\"now.timestamp\",()=>new Date().toLocaleString(navigator.language,{hour:\"numeric\",minute:\"numeric\",second:\"numeric\"}))}const{warn:Zt}=F(\"lookups\");function da(){L(\"passage.name\",()=>{const t=m(\"trail\");if(!Array.isArray(t)){Zt(`The trail variable has been set to a ${typeof t}, not an array.`);return}return t[t.length-1]}),L(\"passage.visits\",()=>{const t=m(\"trail\"),e=m(\"passage.name\");return Array.isArray(t)?t.reduce((n,i)=>i===e?n+1:n,0):(Zt(`The trail variable has been set to a ${typeof t}, not an array.`),0)})}var Je={},ha={get exports(){return Je},set exports(t){Je=t}};(function(t){(function(e,n,i){function r(o){var c=this,u=a();c.next=function(){var d=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=d|0)},c.c=1,c.s0=u(\" \"),c.s1=u(\" \"),c.s2=u(\" \"),c.s0-=u(o),c.s0<0&&(c.s0+=1),c.s1-=u(o),c.s1<0&&(c.s1+=1),c.s2-=u(o),c.s2<0&&(c.s2+=1),u=null}function s(o,c){return c.c=o.c,c.s0=o.s0,c.s1=o.s1,c.s2=o.s2,c}function l(o,c){var u=new r(o),d=c&&c.state,f=u.next;return f.int32=function(){return u.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,d&&(typeof d==\"object\"&&s(d,u),f.state=function(){return s(u,{})}),f}function a(){var o=4022871197,c=function(u){u=String(u);for(var d=0;d<u.length;d++){o+=u.charCodeAt(d);var f=.02519603282416938*o;o=f>>>0,f-=o,f*=o,o=f>>>0,f-=o,o+=f*4294967296}return(o>>>0)*23283064365386963e-26};return c}n&&n.exports?n.exports=l:i&&i.amd?i(function(){return l}):this.alea=l})(se,t,!1)})(ha);var Xe={},pa={get exports(){return Xe},set exports(t){Xe=t}};(function(t){(function(e,n,i){function r(a){var o=this,c=\"\";o.x=0,o.y=0,o.z=0,o.w=0,o.next=function(){var d=o.x^o.x<<11;return o.x=o.y,o.y=o.z,o.z=o.w,o.w^=o.w>>>19^d^d>>>8},a===(a|0)?o.x=a:c+=a;for(var u=0;u<c.length+64;u++)o.x^=c.charCodeAt(u)|0,o.next()}function s(a,o){return o.x=a.x,o.y=a.y,o.z=a.z,o.w=a.w,o}function l(a,o){var c=new r(a),u=o&&o.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(f+h)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,u&&(typeof u==\"object\"&&s(u,c),d.state=function(){return s(c,{})}),d}n&&n.exports?n.exports=l:i&&i.amd?i(function(){return l}):this.xor128=l})(se,t,!1)})(pa);var We={},ga={get exports(){return We},set exports(t){We=t}};(function(t){(function(e,n,i){function r(a){var o=this,c=\"\";o.next=function(){var d=o.x^o.x>>>2;return o.x=o.y,o.y=o.z,o.z=o.w,o.w=o.v,(o.d=o.d+362437|0)+(o.v=o.v^o.v<<4^(d^d<<1))|0},o.x=0,o.y=0,o.z=0,o.w=0,o.v=0,a===(a|0)?o.x=a:c+=a;for(var u=0;u<c.length+64;u++)o.x^=c.charCodeAt(u)|0,u==c.length&&(o.d=o.x<<10^o.x>>>4),o.next()}function s(a,o){return o.x=a.x,o.y=a.y,o.z=a.z,o.w=a.w,o.v=a.v,o.d=a.d,o}function l(a,o){var c=new r(a),u=o&&o.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(f+h)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,u&&(typeof u==\"object\"&&s(u,c),d.state=function(){return s(c,{})}),d}n&&n.exports?n.exports=l:i&&i.amd?i(function(){return l}):this.xorwow=l})(se,t,!1)})(ga);var Qe={},ma={get exports(){return Qe},set exports(t){Qe=t}};(function(t){(function(e,n,i){function r(a){var o=this;o.next=function(){var u=o.x,d=o.i,f,h;return f=u[d],f^=f>>>7,h=f^f<<24,f=u[d+1&7],h^=f^f>>>10,f=u[d+3&7],h^=f^f>>>3,f=u[d+4&7],h^=f^f<<7,f=u[d+7&7],f=f^f<<13,h^=f^f<<9,u[d]=h,o.i=d+1&7,h};function c(u,d){var f,h=[];if(d===(d|0))h[0]=d;else for(d=\"\"+d,f=0;f<d.length;++f)h[f&7]=h[f&7]<<15^d.charCodeAt(f)+h[f+1&7]<<13;for(;h.length<8;)h.push(0);for(f=0;f<8&&h[f]===0;++f);for(f==8?h[7]=-1:h[f],u.x=h,u.i=0,f=256;f>0;--f)u.next()}c(o,a)}function s(a,o){return o.x=a.x.slice(),o.i=a.i,o}function l(a,o){a==null&&(a=+new Date);var c=new r(a),u=o&&o.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(f+h)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,u&&(u.x&&s(u,c),d.state=function(){return s(c,{})}),d}n&&n.exports?n.exports=l:i&&i.amd?i(function(){return l}):this.xorshift7=l})(se,t,!1)})(ma);var Ke={},ba={get exports(){return Ke},set exports(t){Ke=t}};(function(t){(function(e,n,i){function r(a){var o=this;o.next=function(){var u=o.w,d=o.X,f=o.i,h,g;return o.w=u=u+1640531527|0,g=d[f+34&127],h=d[f=f+1&127],g^=g<<13,h^=h<<17,g^=g>>>15,h^=h>>>12,g=d[f]=g^h,o.i=f,g+(u^u>>>16)|0};function c(u,d){var f,h,g,v,O,x=[],A=128;for(d===(d|0)?(h=d,d=null):(d=d+\"\\0\",h=0,A=Math.max(A,d.length)),g=0,v=-32;v<A;++v)d&&(h^=d.charCodeAt((v+32)%d.length)),v===0&&(O=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,v>=0&&(O=O+1640531527|0,f=x[v&127]^=h+O,g=f==0?g+1:0);for(g>=128&&(x[(d&&d.length||0)&127]=-1),g=127,v=4*128;v>0;--v)h=x[g+34&127],f=x[g=g+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,x[g]=h^f;u.w=O,u.X=x,u.i=g}c(o,a)}function s(a,o){return o.i=a.i,o.w=a.w,o.X=a.X.slice(),o}function l(a,o){a==null&&(a=+new Date);var c=new r(a),u=o&&o.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(f+h)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,u&&(u.X&&s(u,c),d.state=function(){return s(c,{})}),d}n&&n.exports?n.exports=l:i&&i.amd?i(function(){return l}):this.xor4096=l})(se,t,!1)})(ba);var Ye={},ya={get exports(){return Ye},set exports(t){Ye=t}};(function(t){(function(e,n,i){function r(a){var o=this,c=\"\";o.next=function(){var d=o.b,f=o.c,h=o.d,g=o.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^g,g=g-d|0,o.b=d=d<<20^d>>>12^f,o.c=f=f-h|0,o.d=h<<16^f>>>16^g,o.a=g-d|0},o.a=0,o.b=0,o.c=-1640531527,o.d=1367130551,a===Math.floor(a)?(o.a=a/4294967296|0,o.b=a|0):c+=a;for(var u=0;u<c.length+20;u++)o.b^=c.charCodeAt(u)|0,o.next()}function s(a,o){return o.a=a.a,o.b=a.b,o.c=a.c,o.d=a.d,o}function l(a,o){var c=new r(a),u=o&&o.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var f=c.next()>>>11,h=(c.next()>>>0)/4294967296,g=(f+h)/(1<<21);while(g===0);return g},d.int32=c.next,d.quick=d,u&&(typeof u==\"object\"&&s(u,c),d.state=function(){return s(c,{})}),d}n&&n.exports?n.exports=l:i&&i.amd?i(function(){return l}):this.tychei=l})(se,t,!1)})(ya);var et={},wa={get exports(){return et},set exports(t){et=t}};const ka={},xa=Object.freeze(Object.defineProperty({__proto__:null,default:ka},Symbol.toStringTag,{value:\"Module\"})),va=Es(xa);(function(t){(function(e,n,i){var r=256,s=6,l=52,a=\"random\",o=i.pow(r,s),c=i.pow(2,l),u=c*2,d=r-1,f;function h(w,k,_){var C=[];k=k==!0?{entropy:!0}:k||{};var T=x(O(k.entropy?[w,M(n)]:w??A(),3),C),R=new g(C),H=function(){for(var D=R.g(s),V=o,B=0;D<c;)D=(D+B)*r,V*=r,B=R.g(1);for(;D>=u;)D/=2,V/=2,B>>>=1;return(D+B)/V};return H.int32=function(){return R.g(4)|0},H.quick=function(){return R.g(4)/4294967296},H.double=H,x(M(R.S),n),(k.pass||_||function(D,V,B,J){return J&&(J.S&&v(J,R),D.state=function(){return v(R,{})}),B?(i[a]=D,V):D})(H,T,\"global\"in k?k.global:this==i,k.state)}function g(w){var k,_=w.length,C=this,T=0,R=C.i=C.j=0,H=C.S=[];for(_||(w=[_++]);T<r;)H[T]=T++;for(T=0;T<r;T++)H[T]=H[R=d&R+w[T%_]+(k=H[T])],H[R]=k;(C.g=function(D){for(var V,B=0,J=C.i,_e=C.j,de=C.S;D--;)V=de[J=d&J+1],B=B*r+de[d&(de[J]=de[_e=d&_e+V])+(de[_e]=V)];return C.i=J,C.j=_e,B})(r)}function v(w,k){return k.i=w.i,k.j=w.j,k.S=w.S.slice(),k}function O(w,k){var _=[],C=typeof w,T;if(k&&C==\"object\")for(T in w)try{_.push(O(w[T],k-1))}catch{}return _.length?_:C==\"string\"?w:w+\"\\0\"}function x(w,k){for(var _=w+\"\",C,T=0;T<_.length;)k[d&T]=d&(C^=k[d&T]*19)+_.charCodeAt(T++);return M(k)}function A(){try{var w;return f&&(w=f.randomBytes)?w=w(r):(w=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(w)),M(w)}catch{var k=e.navigator,_=k&&k.plugins;return[+new Date,e,_,e.screen,M(n)]}}function M(w){return String.fromCharCode.apply(0,w)}if(x(i.random(),n),t.exports){t.exports=h;try{f=va}catch{}}else i[\"seed\"+a]=h})(typeof self<\"u\"?self:se,[],Math)})(wa);var $a=Je,Sa=Xe,Ea=We,_a=Qe,Ca=Ke,Aa=Ye,ae=et;ae.alea=$a;ae.xor128=Sa;ae.xorwow=Ea;ae.xorshift7=_a;ae.xor4096=Ca;ae.tychei=Aa;var Fn=ae;const Bn=Date.now().toString();let be=Fn(Bn,{state:!0});const Ve=cn(()=>{E(\"config.random.privateState\",be.state())});function Ta(){re({\"config.random.privateState\":null,\"config.random.seed\":Bn}),window.addEventListener(\"state-change\",({detail:t})=>{t.name===\"config.random.seed\"&&(be=Fn(t.value,{state:!0}))}),L(\"random.coinFlip\",()=>{const t=be();return Ve(),t>.5}),L(\"random.fraction\",()=>{const t=be();return Ve(),t});for(const t of[4,5,6,8,10,12,20,25,50,100,1e3])L(`random.d${t}`,()=>{const e=1+Math.round(be()*(t-1));return Ve(),e})}function La(){L(\"story.name\",ut)}function za(){la(),ua(),fa(),da(),Ta(),La()}function Pa(){const t=document.querySelectorAll(\"tw-storydata\");if(t.length===0){console.warn(\"No <tw-storydata> element was found in HTML.\");return}t.length>1&&console.warn(\"Multiple <tw-storydata> elements were found in HTML. Using the first.\"),on(t[0]),sa(),fn(),Object.assign(window,{go:yn,restart:wn}),Xn(),re(Zn),ra(),Fs(),Hn(),za(),aa(),an(),m(\"config.testing\")?Ss():hn()&&pn()}Pa();\n\n</script><style>\n:root{--font-monospace: ui-monospace, Menlo, Monaco, \"Cascadia Mono\", \"Segoe UI Mono\", \"Roboto Mono\", \"Oxygen Mono\", \"Ubuntu Monospace\", \"Source Code Pro\", \"Fira Mono\", \"Droid Sans Mono\", \"Courier New\", monospace;--font-system: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen-Sans, Ubuntu, Cantarell, \"Helvetica Neue\", sans-serif}*{box-sizing:border-box}body{margin:0;padding:0}code{font-family:var(--font-monospace)}img{max-width:100%;height:auto}input[type=text],select{padding:.25em}noscript{align-items:center;background:black;color:#fff;display:flex;height:100vh;font-family:var(--font-system);justify-content:center;width:100vw}pre{font-family:var(--font-monospace);white-space:pre-wrap}tw-storydata{display:none}body.backstage-visible #backdrop{max-width:67vw}backstage-sidebar{--backstage-grid: 10px;background:var(--oc-gray-3);border-left:1px solid var(--oc-gray-5);bottom:0;color:var(--oc-gray-8);display:block;font-family:var(--font-system);font-size:13px;position:fixed;top:0;right:0;width:33vw}backstage-sidebar .content{overflow:auto;padding:var(--backstage-grid);height:100%;width:100%}backstage-sidebar[collapsed]{width:0}backstage-sidebar button[data-toggle-collapsed]{background:var(--oc-gray-3);border-bottom:1px solid var(--oc-gray-5);border-left:1px solid var(--oc-gray-5);border-right:none;border-top:1px solid var(--oc-gray-5);border-radius:60px 0 0 60px;color:var(--oc-gray-8);font-size:20px;height:60px;min-width:30px;padding:0;position:absolute;top:50%;left:-30px;transform:translateY(-50%);width:30px}backstage-sidebar button[data-toggle-collapsed]:hover{background:var(--oc-gray-4);cursor:pointer}backstage-sidebar button{background:var(--oc-gray-1);border:1px solid var(--oc-gray-5);border-radius:var(--backstage-grid);cursor:pointer;font-size:100%;min-width:40px;padding:calc(var(--backstage-grid) / 2)}backstage-sidebar button:hover{background:white}backstage-sidebar details summary{cursor:pointer;font-size:110%;font-variant:small-caps;padding:calc(var(--backstage-grid) / 2) 0;text-transform:lowercase}backstage-sidebar input,backstage-sidebar textarea{background:var(--oc-gray-1);border:1px solid var(--oc-gray-5);font:100% var(--font-system);padding:calc(var(--backstage-grid) / 2)}backstage-sidebar table{max-width:100%;width:100%}backstage-history-table button{display:block;width:100%}backstage-history-table table{border-collapse:collapse;margin:var(--backstage-grid) 0;table-layout:fixed}backstage-history-table thead{height:1px;left:-10000px;overflow:hidden;position:absolute;top:auto;width:1px}backstage-history-table tr:not(:last-child){border-bottom:1px solid var(--oc-gray-8)}backstage-history-table td{text-overflow:ellipsis;overflow-wrap:break-word;padding:calc(var(--backstage-grid) / 2);vertical-align:top}backstage-history-table td:first-child{border-right:1px solid var(--oc-gray-8);width:45%}backstage-notes label{display:block;margin-top:var(--backstage-grid)}backstage-notes textarea{height:10em;margin:var(--backstage-grid) 0;width:100%}backstage-notes .actions{display:flex;gap:var(--backstage-grid)}backstage-notes .actions button{flex-grow:1}backstage-state-snapshots button[data-add-snapshot]{width:100%}backstage-state-snapshots .snapshot-button{display:flex;margin-bottom:var(--backstage-grid)}backstage-state-snapshots .snapshot-button [data-restore]{flex-grow:1;border-right-color:var(--oc-gray-4);border-bottom-right-radius:0;border-top-right-radius:0}backstage-state-snapshots .snapshot-button [data-remove]{border-left:none;border-bottom-left-radius:0;border-top-left-radius:0}backstage-state-variables .variables{display:flex;flex-direction:column;gap:calc(var(--backstage-grid) / 2);margin:calc(var(--backstage-grid)) 0}backstage-state-variables .variables label{display:grid;gap:var(--backstage-grid);grid-template-columns:15em 1fr}backstage-style-config textarea{height:10em;margin:var(--backstage-grid) 0;width:100%}backstage-tab{border-left:1px solid var(--oc-gray-4);cursor:pointer;flex-grow:1;padding:calc(var(--backstage-grid) / 2);text-align:center}backstage-tab:hover{background:white}backstage-tab:first-child{border-left:none;border-bottom-left-radius:var(--backstage-grid);border-top-left-radius:var(--backstage-grid)}backstage-tab:last-child{border-bottom-right-radius:var(--backstage-grid);border-top-right-radius:var(--backstage-grid)}backstage-tab[aria-selected=true]{background-color:#fff;cursor:default;font-weight:700}backstage-tab-panel{display:block;padding:calc(var(--backstage-grid) / 2) 0}backstage-tab-panel[hidden]{display:none}backstage-tabs{background:var(--oc-gray-1);border:1px solid var(--oc-gray-5);border-radius:var(--backstage-grid);display:flex}backstage-variable-input input{display:inline-block;width:100%}.fade-in{opacity:0;animation:fade-in 1s ease-out forwards}.fade-out{animation:fade-in 1s ease-out reverse forwards}@keyframes fade-in{0%{opacity:0}to{opacity:1}}#backdrop{align-items:center;background-color:var(--backdrop-color);display:flex;justify-content:center;min-height:100vh}#page>marginal-content[type=footer]{background-color:var(--page-footer-background-color);border-top:1px solid black;color:var(--page-footer-color);font-family:var(--page-footer-font-family);font-size:var(--page-footer-font-size);font-style:var(--page-footer-font-style);font-variant:var(--page-footer-font-variant);font-weight:var(--page-footer-font-weight);text-decoration:var(--page-footer-text-decoration);text-decoration-color:var(--page-footer-text-decoration-color);text-transform:var(--page-footer-text-transform)}#page>marginal-content[type=footer] .link{background-color:var(--page-footer-link-background-color);color:var(--page-footer-link-color);font-family:var(--page-footer-link-font-family);font-size:var(--page-footer-link-font-size);font-style:var(--page-footer-link-font-style);font-variant:var(--page-footer-link-font-variant);font-weight:var(--page-footer-link-font-weight);text-decoration:var(--page-footer-link-text-decoration);text-decoration-color:var(--page-footer-link-text-decoration-color);text-transform:var(--page-footer-link-text-transform)}#page>marginal-content[type=footer] .link:hover{background-color:var(--page-footer-link-active-background-color);color:var(--page-footer-link-active-color);font-family:var(--page-footer-link-active-font-family);font-size:var(--page-footer-link-active-font-size);font-style:var(--page-footer-link-active-font-style);font-variant:var(--page-footer-link-active-font-variant);font-weight:var(--page-footer-link-active-font-weight);text-decoration:var(--page-footer-link-active-text-decoration);text-decoration-color:var( --page-footer-link-active-text-decoration-color );text-transform:var(--page-footer-link-active-text-transform)}#page>marginal-content[type=header]{background-color:var(--page-header-background-color);border-bottom:1px solid black;color:var(--page-header-color);font-family:var(--page-header-font-family);font-size:var(--page-header-font-size);font-style:var(--page-header-font-style);font-variant:var(--page-header-font-variant);font-weight:var(--page-header-font-weight);text-decoration:var(--page-header-text-decoration);text-decoration-color:var(--page-header-text-decoration-color);text-transform:var(--page-header-text-transform)}#page>marginal-content[type=header] .link{background-color:var(--page-header-link-background-color);color:var(--page-header-link-color);font-family:var(--page-header-link-font-family);font-size:var(--page-header-link-font-size);font-style:var(--page-header-link-font-style);font-variant:var(--page-header-link-font-variant);font-weight:var(--page-header-link-font-weight);text-decoration:var(--page-header-link-text-decoration);text-decoration-color:var(--page-header-link-text-decoration-color);text-transform:var(--page-header-link-text-transform)}#page>marginal-content[type=header] .link:hover{background-color:var(--page-header-link-active-background-color);color:var(--page-header-link-active-color);font-family:var(--page-header-link-active-font-family);font-size:var(--page-header-link-active-font-size);font-style:var(--page-header-link-active-font-style);font-variant:var(--page-header-link-active-font-variant);font-weight:var(--page-header-link-active-font-weight);text-decoration:var(--page-header-link-active-text-decoration);text-decoration-color:var( --page-header-link-active-text-decoration-color );text-transform:var(--page-header-link-active-text-transform)}#page{background-color:var(--page-background-color);border:var(--page-border);border-radius:3px;box-shadow:var(--page-box-shadow);color:var(--page-color);display:grid;font-family:var(--page-font-family);font-size:var(--page-font-size);font-style:var(--page-font-style);font-variant:var(--page-font-variant);font-weight:var(--page-font-weight);grid-template-areas:\"header\" \"body\" \"footer\";grid-template-rows:min-content 1fr min-content;line-height:150%;margin:1em;max-width:calc(100vw - 2em);min-height:calc(100vh - 2em);padding:2em 4em;position:relative;text-decoration:var(--page-text-decoration);text-transform:var(--page-text-transform);width:40em}#page hr{border:none}#page hr:after{content:\"* \\a0* \\a0*\";display:block;text-align:center}#page page-skip-indicator{position:absolute;bottom:0;right:0}#page .fork p{display:flex;flex-direction:column;width:100%}#page .fork p .link{display:block;flex-grow:1;text-align:center;padding:.5em}#page .fork p .link+.link{border-top:var(--page-fork-divider-size) var(--page-fork-divider-style) var(--page-fork-divider-color)}#page .link{background-color:var(--page-link-background-color);color:var(--page-link-color);cursor:pointer;font-family:var(--page-link-font-family);font-size:var(--page-link-font-size);font-style:var(--page-link-font-style);font-variant:var(--page-link-font-variant);font-weight:var(--page-link-font-weight);text-decoration:var(--page-link-text-decoration);text-decoration-color:var(--page-link-text-decoration-color);text-transform:var(--page-link-text-transform)}#page .link:hover{background-color:var(--page-link-active-background-color);color:var(--page-link-active-color);font-family:var(--page-link-font-family);font-size:var(--page-link-font-size);font-style:var(--page-link-font-style);font-variant:var(--page-link-font-variant);font-weight:var(--page-link-font-weight);text-decoration:var(--page-link-text-decoration);text-decoration-color:var(--page-link-text-decoration-color);text-transform:var(--page-link-text-transform)}#page .small-caps{font-variant:small-caps;text-transform:lowercase}#page>marginal-content[type=footer]{grid-area:footer}#page>marginal-content[type=header]{grid-area:header}#page>body-content{display:flex;flex-direction:column;flex-grow:1;grid-area:body;justify-content:var(--page-current-passage-justify-content)}#page>error-handler{grid-area:body;position:relative;z-index:2}@media screen and (max-width: 768px){#page{margin:0;width:100vw;max-width:100vw;min-height:100vh;padding:1em}}body-content{display:block}error-handler{display:none}error-handler.active{background:var(--oc-red-0);color:var(--oc-red-9);display:block;font-family:var(--font-system);font-size:max(90%,16px);padding:.5em;border-left:4px solid var(--oc-red-3);position:relative;margin:1em 0;overflow:auto}error-handler pre{font-size:90%}error-handler a{color:var(--oc-red-9)}error-handler button{appearance:none;background:none;border:none;color:var(--oc-red-9);cursor:pointer;padding:0}external-fonts{display:none}marginal-content{display:flex;justify-content:space-between}marginal-content[hidden]{display:none}marginal-content .center{text-align:center}marginal-content .right{text-align:right}page-skip{display:block}page-skip-indicator{background-image:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3e%09%3crect width='38' height='72' x='31' y='14' fill='%23fff' rx='4' /%3e%09%3ccircle cx='50' cy='50' r='28' fill='%23fff' /%3e%09%3crect%09%09width='30'%09%09height='64'%09%09x='35'%09%09y='18'%09%09fill='%23fff'%09%09stroke='%23000'%09%09stroke-width='2'%09%09rx='4'%09/%3e%09%3ccircle%09%09cx='50'%09%09cy='50'%09%09r='20'%09%09fill='%23fff'%09%09stroke='%23000'%09%09stroke-width='2'%09/%3e%09%3cpath%09%09stroke='%23000'%09%09stroke-linecap='round'%09%09stroke-width='2'%09%09d='M50 50V37'%09%3e%09%09%3canimateTransform%09%09%09attributeName='transform'%09%09%09begin='0s'%09%09%09dur='20s'%09%09%09from='0 50 50'%09%09%09repeatCount='indefinite'%09%09%09to='360 50 50'%09%09%09type='rotate'%09%09/%3e%09%3c/path%3e%09%3cpath%09%09stroke='%23000'%09%09stroke-linecap='round'%09%09stroke-width='2'%09%09d='M50 50h-8'%09%3e%09%09%3canimateTransform%09%09%09attributeName='transform'%09%09%09begin='0s'%09%09%09dur='120s'%09%09%09from='0 50 50'%09%09%09repeatCount='indefinite'%09%09%09to='360 50 50'%09%09%09type='rotate'%09%09/%3e%09%3c/path%3e%3c/svg%3e\");background-size:contain;display:block;height:50px;opacity:0;pointer-events:none;transition:opacity .3s;width:50px}page-skip-indicator[active]{opacity:1}:root{--oc-white: #ffffff;--oc-white-rgb: 255, 255, 255;--oc-black: #000000;--oc-black-rgb: 0, 0, 0;--oc-gray-0: #f8f9fa;--oc-gray-0-rgb: 248, 249, 250;--oc-gray-1: #f1f3f5;--oc-gray-1-rgb: 241, 243, 245;--oc-gray-2: #e9ecef;--oc-gray-2-rgb: 233, 236, 239;--oc-gray-3: #dee2e6;--oc-gray-3-rgb: 222, 226, 230;--oc-gray-4: #ced4da;--oc-gray-4-rgb: 206, 212, 218;--oc-gray-5: #adb5bd;--oc-gray-5-rgb: 173, 181, 189;--oc-gray-6: #868e96;--oc-gray-6-rgb: 134, 142, 150;--oc-gray-7: #495057;--oc-gray-7-rgb: 73, 80, 87;--oc-gray-8: #343a40;--oc-gray-8-rgb: 52, 58, 64;--oc-gray-9: #212529;--oc-gray-9-rgb: 33, 37, 41;--oc-red-0: #fff5f5;--oc-red-0-rgb: 255, 245, 245;--oc-red-1: #ffe3e3;--oc-red-1-rgb: 255, 227, 227;--oc-red-2: #ffc9c9;--oc-red-2-rgb: 255, 201, 201;--oc-red-3: #ffa8a8;--oc-red-3-rgb: 255, 168, 168;--oc-red-4: #ff8787;--oc-red-4-rgb: 255, 135, 135;--oc-red-5: #ff6b6b;--oc-red-5-rgb: 255, 107, 107;--oc-red-6: #fa5252;--oc-red-6-rgb: 250, 82, 82;--oc-red-7: #f03e3e;--oc-red-7-rgb: 240, 62, 62;--oc-red-8: #e03131;--oc-red-8-rgb: 224, 49, 49;--oc-red-9: #c92a2a;--oc-red-9-rgb: 201, 42, 42;--oc-pink-0: #fff0f6;--oc-pink-0-rgb: 255, 240, 246;--oc-pink-1: #ffdeeb;--oc-pink-1-rgb: 255, 222, 235;--oc-pink-2: #fcc2d7;--oc-pink-2-rgb: 252, 194, 215;--oc-pink-3: #faa2c1;--oc-pink-3-rgb: 250, 162, 193;--oc-pink-4: #f783ac;--oc-pink-4-rgb: 247, 131, 172;--oc-pink-5: #f06595;--oc-pink-5-rgb: 240, 101, 149;--oc-pink-6: #e64980;--oc-pink-6-rgb: 230, 73, 128;--oc-pink-7: #d6336c;--oc-pink-7-rgb: 214, 51, 108;--oc-pink-8: #c2255c;--oc-pink-8-rgb: 194, 37, 92;--oc-pink-9: #a61e4d;--oc-pink-9-rgb: 166, 30, 77;--oc-grape-0: #f8f0fc;--oc-grape-0-rgb: 248, 240, 252;--oc-grape-1: #f3d9fa;--oc-grape-1-rgb: 243, 217, 250;--oc-grape-2: #eebefa;--oc-grape-2-rgb: 238, 190, 250;--oc-grape-3: #e599f7;--oc-grape-3-rgb: 229, 153, 247;--oc-grape-4: #da77f2;--oc-grape-4-rgb: 218, 119, 242;--oc-grape-5: #cc5de8;--oc-grape-5-rgb: 204, 93, 232;--oc-grape-6: #be4bdb;--oc-grape-6-rgb: 190, 75, 219;--oc-grape-7: #ae3ec9;--oc-grape-7-rgb: 174, 62, 201;--oc-grape-8: #9c36b5;--oc-grape-8-rgb: 156, 54, 181;--oc-grape-9: #862e9c;--oc-grape-9-rgb: 134, 46, 156;--oc-violet-0: #f3f0ff;--oc-violet-0-rgb: 243, 240, 255;--oc-violet-1: #e5dbff;--oc-violet-1-rgb: 229, 219, 255;--oc-violet-2: #d0bfff;--oc-violet-2-rgb: 208, 191, 255;--oc-violet-3: #b197fc;--oc-violet-3-rgb: 177, 151, 252;--oc-violet-4: #9775fa;--oc-violet-4-rgb: 151, 117, 250;--oc-violet-5: #845ef7;--oc-violet-5-rgb: 132, 94, 247;--oc-violet-6: #7950f2;--oc-violet-6-rgb: 121, 80, 242;--oc-violet-7: #7048e8;--oc-violet-7-rgb: 112, 72, 232;--oc-violet-8: #6741d9;--oc-violet-8-rgb: 103, 65, 217;--oc-violet-9: #5f3dc4;--oc-violet-9-rgb: 95, 61, 196;--oc-indigo-0: #edf2ff;--oc-indigo-0-rgb: 237, 242, 255;--oc-indigo-1: #dbe4ff;--oc-indigo-1-rgb: 219, 228, 255;--oc-indigo-2: #bac8ff;--oc-indigo-2-rgb: 186, 200, 255;--oc-indigo-3: #91a7ff;--oc-indigo-3-rgb: 145, 167, 255;--oc-indigo-4: #748ffc;--oc-indigo-4-rgb: 116, 143, 252;--oc-indigo-5: #5c7cfa;--oc-indigo-5-rgb: 92, 124, 250;--oc-indigo-6: #4c6ef5;--oc-indigo-6-rgb: 76, 110, 245;--oc-indigo-7: #4263eb;--oc-indigo-7-rgb: 66, 99, 235;--oc-indigo-8: #3b5bdb;--oc-indigo-8-rgb: 59, 91, 219;--oc-indigo-9: #364fc7;--oc-indigo-9-rgb: 54, 79, 199;--oc-blue-0: #e7f5ff;--oc-blue-0-rgb: 231, 245, 255;--oc-blue-1: #d0ebff;--oc-blue-1-rgb: 208, 235, 255;--oc-blue-2: #a5d8ff;--oc-blue-2-rgb: 165, 216, 255;--oc-blue-3: #74c0fc;--oc-blue-3-rgb: 116, 192, 252;--oc-blue-4: #4dabf7;--oc-blue-4-rgb: 77, 171, 247;--oc-blue-5: #339af0;--oc-blue-5-rgb: 51, 154, 240;--oc-blue-6: #228be6;--oc-blue-6-rgb: 34, 139, 230;--oc-blue-7: #1c7ed6;--oc-blue-7-rgb: 28, 126, 214;--oc-blue-8: #1971c2;--oc-blue-8-rgb: 25, 113, 194;--oc-blue-9: #1864ab;--oc-blue-9-rgb: 24, 100, 171;--oc-cyan-0: #e3fafc;--oc-cyan-0-rgb: 227, 250, 252;--oc-cyan-1: #c5f6fa;--oc-cyan-1-rgb: 197, 246, 250;--oc-cyan-2: #99e9f2;--oc-cyan-2-rgb: 153, 233, 242;--oc-cyan-3: #66d9e8;--oc-cyan-3-rgb: 102, 217, 232;--oc-cyan-4: #3bc9db;--oc-cyan-4-rgb: 59, 201, 219;--oc-cyan-5: #22b8cf;--oc-cyan-5-rgb: 34, 184, 207;--oc-cyan-6: #15aabf;--oc-cyan-6-rgb: 21, 170, 191;--oc-cyan-7: #1098ad;--oc-cyan-7-rgb: 16, 152, 173;--oc-cyan-8: #0c8599;--oc-cyan-8-rgb: 12, 133, 153;--oc-cyan-9: #0b7285;--oc-cyan-9-rgb: 11, 114, 133;--oc-teal-0: #e6fcf5;--oc-teal-0-rgb: 230, 252, 245;--oc-teal-1: #c3fae8;--oc-teal-1-rgb: 195, 250, 232;--oc-teal-2: #96f2d7;--oc-teal-2-rgb: 150, 242, 215;--oc-teal-3: #63e6be;--oc-teal-3-rgb: 99, 230, 190;--oc-teal-4: #38d9a9;--oc-teal-4-rgb: 56, 217, 169;--oc-teal-5: #20c997;--oc-teal-5-rgb: 32, 201, 151;--oc-teal-6: #12b886;--oc-teal-6-rgb: 18, 184, 134;--oc-teal-7: #0ca678;--oc-teal-7-rgb: 12, 166, 120;--oc-teal-8: #099268;--oc-teal-8-rgb: 9, 146, 104;--oc-teal-9: #087f5b;--oc-teal-9-rgb: 8, 127, 91;--oc-green-0: #ebfbee;--oc-green-0-rgb: 235, 251, 238;--oc-green-1: #d3f9d8;--oc-green-1-rgb: 211, 249, 216;--oc-green-2: #b2f2bb;--oc-green-2-rgb: 178, 242, 187;--oc-green-3: #8ce99a;--oc-green-3-rgb: 140, 233, 154;--oc-green-4: #69db7c;--oc-green-4-rgb: 105, 219, 124;--oc-green-5: #51cf66;--oc-green-5-rgb: 81, 207, 102;--oc-green-6: #40c057;--oc-green-6-rgb: 64, 192, 87;--oc-green-7: #37b24d;--oc-green-7-rgb: 55, 178, 77;--oc-green-8: #2f9e44;--oc-green-8-rgb: 47, 158, 68;--oc-green-9: #2b8a3e;--oc-green-9-rgb: 43, 138, 62;--oc-lime-0: #f4fce3;--oc-lime-0-rgb: 244, 252, 227;--oc-lime-1: #e9fac8;--oc-lime-1-rgb: 233, 250, 200;--oc-lime-2: #d8f5a2;--oc-lime-2-rgb: 216, 245, 162;--oc-lime-3: #c0eb75;--oc-lime-3-rgb: 192, 235, 117;--oc-lime-4: #a9e34b;--oc-lime-4-rgb: 169, 227, 75;--oc-lime-5: #94d82d;--oc-lime-5-rgb: 148, 216, 45;--oc-lime-6: #82c91e;--oc-lime-6-rgb: 130, 201, 30;--oc-lime-7: #74b816;--oc-lime-7-rgb: 116, 184, 22;--oc-lime-8: #66a80f;--oc-lime-8-rgb: 102, 168, 15;--oc-lime-9: #5c940d;--oc-lime-9-rgb: 92, 148, 13;--oc-yellow-0: #fff9db;--oc-yellow-0-rgb: 255, 249, 219;--oc-yellow-1: #fff3bf;--oc-yellow-1-rgb: 255, 243, 191;--oc-yellow-2: #ffec99;--oc-yellow-2-rgb: 255, 236, 153;--oc-yellow-3: #ffe066;--oc-yellow-3-rgb: 255, 224, 102;--oc-yellow-4: #ffd43b;--oc-yellow-4-rgb: 255, 212, 59;--oc-yellow-5: #fcc419;--oc-yellow-5-rgb: 252, 196, 25;--oc-yellow-6: #fab005;--oc-yellow-6-rgb: 250, 176, 5;--oc-yellow-7: #f59f00;--oc-yellow-7-rgb: 245, 159, 0;--oc-yellow-8: #f08c00;--oc-yellow-8-rgb: 240, 140, 0;--oc-yellow-9: #e67700;--oc-yellow-9-rgb: 230, 119, 0;--oc-orange-0: #fff4e6;--oc-orange-0-rgb: 255, 244, 230;--oc-orange-1: #ffe8cc;--oc-orange-1-rgb: 255, 232, 204;--oc-orange-2: #ffd8a8;--oc-orange-2-rgb: 255, 216, 168;--oc-orange-3: #ffc078;--oc-orange-3-rgb: 255, 192, 120;--oc-orange-4: #ffa94d;--oc-orange-4-rgb: 255, 169, 77;--oc-orange-5: #ff922b;--oc-orange-5-rgb: 255, 146, 43;--oc-orange-6: #fd7e14;--oc-orange-6-rgb: 253, 126, 20;--oc-orange-7: #f76707;--oc-orange-7-rgb: 247, 103, 7;--oc-orange-8: #e8590c;--oc-orange-8-rgb: 232, 89, 12;--oc-orange-9: #d9480f;--oc-orange-9-rgb: 217, 72, 15}warning-list{background:var(--oc-yellow-0);color:var(--oc-yellow-9);display:block;font-family:var(--font-system);padding:.5em}warning-list[hidden]{display:none}warning-list ul{list-style-type:none;margin:0;padding-left:0}inline-button{cursor:pointer}\n\n</style></head><body><state-css-variables><div id=\"backdrop\"><page-skip><div id=\"page\" aria-live=\"polite\"><marginal-content role=\"banner\" type=\"header\"></marginal-content><body-content role=\"main\"></body-content><warning-list></warning-list><marginal-content role=\"contentinfo\" type=\"footer\"></marginal-content><error-handler></error-handler><page-skip-indicator></page-skip-indicator></div></page-skip></div></state-css-variables><external-fonts></external-fonts><noscript>This requires JavaScript.</noscript></body>{{STORY_DATA}}</html>","author":"Chris Klimas","description":"A Twine story format emphasizing ease of authoring, multimedia, and playability on many different types of devices. Visit the <a href=\"https://klembot.github.io/chapbook/guide/\">guide</a> for more information.","hydrate":"(function(l){\"use strict\";function s(){return{startState(){return{inVarsSection:!1}},token(e,n){if(n.hasVarsSection===void 0){for(let t=1,i=e.lookAhead(1);i&&n.hasVarsSection===void 0;i=e.lookAhead(++t))i===\"--\"&&(n.hasVarsSection=!0,n.inVarsSection=!0);n.hasVarsSection===void 0&&(n.hasVarsSection=!1)}return n.hasVarsSection&&n.inVarsSection&&e.sol()?e.match(/^--$/)?(n.inVarsSection=!1,e.skipToEnd(),\"punctuation\"):e.skipTo(\":\")?(e.next(),\"def\"):(e.skipToEnd(),\"text\"):e.sol()&&e.match(/^\\[[^[].*\\]$/)||e.match(/^\\{.+?\\}/)?\"keyword\":e.match(/^\\[\\[[^\\]]+?\\]\\]/)?\"link\":(e.eatWhile(/[^[{]/)||e.skipToEnd(),\"text\")}}}function I(e){return Object.keys(e).reduce((n,t)=>({...n,[t]:i=>{i.replaceSelection(e[t]),i.focus()}}),{})}function d(e){return Object.keys(e).reduce((n,t)=>({...n,[t]:i=>{const{matcher:a,wrapper:y}=e[t];i.replaceSelections(i.getSelections().map(o=>a.test(o)?o.replace(a,\"$1\"):y(o)),\"around\"),i.focus()}}),{})}const c={...d({boldText:{matcher:/^(?:__|\\*\\*)(.+)(?:__|\\*\\*)$/,wrapper:e=>`**${e}**`},italicText:{matcher:/^(?:_|\\*)(.+)(?:_|\\*)$/,wrapper:e=>`*${e}*`},monospacedText:{matcher:/^`(.+)`$/,wrapper:e=>\"`\"+e+\"`\"},smallCapsText:{matcher:/^~~(.+)~~$/,wrapper:e=>`~~${e}~~`}}),...I({insertAfter:`\n[after 1 second]\nText\n\n[continued]`,insertAppend:`\n[append]\n`,insertBlockquote:`\n<blockquote>Text</blockquote>\n`,insertContinue:`\n[continued]\n`,insertBulletedList:`\n- Item\n- Item\n`,insertCss:`\n[CSS]\n.page article {\n  color: green;\n}\n\n[continued]\n`,insertCyclingLink:\"{cycling link for: 'variable name', choices: ['choice', 'choice']}\",insertDropdownMenu:\"{dropdown menu for: 'variable name', choices: ['choice', 'choice']}\",insertEmbedAmbientSound:\"{ambient sound: 'sound name'}\",insertEmbedSoundEffect:\"{sound effect: 'sound name'}\",insertEmbedPassage:\"{embed passage: 'Passage name'}\",insertEmbedYouTubeVideo:\"{embed YouTube video: 'URL'}\",insertImageFlickr:\"{embed Flickr image: 'Flickr embed code'}\",insertImageUrl:\"{embed image: 'URL to image'}\",insertImageUnsplash:\"{embed Unsplash image: }\",insertForkList:`\n> Link\n> Link\n`,insertIf:`\n[if condition]\nText\n\n[continue]\n`,insertIfElse:`\n[if condition]\nText\n\n[else]Text\n\n[continued]\n`,insertJs:`\n[JavaScript]\nwrite('Hello from JavaScript');\n\n[continued]\n`,insertNote:`\n[note]\nNote to self\n\n[continued]\n`,insertNumberedList:`\n1. Item\n2. Item\n`,insertPassageLink:\"{link to: 'Passage name', label: 'Label text'}\",insertRestartLink:\"{restart link, label: 'Label text'}\",insertRevealPassageLink:\"{reveal link: 'Label text', passage: 'Passage name'}\",insertRevealTextLink:\"{restart link: 'Label text', text: 'Displayed text'}\",insertSectionBreak:`\n***\n`,insertTextInput:\"{text input for: 'variable name'}\",insertUnless:`\n[unless condition]\nText\n\n[continued]\n`})},b=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpY29uIGljb24tdGFibGVyIGljb24tdGFibGVyLWJyYWNrZXRzIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj4KICA8cGF0aCBzdHJva2U9Im5vbmUiIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4KICA8cGF0aCBkPSJNOCA0aC0zdjE2aDMiIC8+CiAgPHBhdGggZD0iTTE2IDRoM3YxNmgtMyIgLz4KPC9zdmc+CgoK\",r=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpY29uIGljb24tdGFibGVyIGljb24tdGFibGVyLWJydXNoIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj4KICA8cGF0aCBzdHJva2U9Im5vbmUiIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4KICA8cGF0aCBkPSJNMyAyMXYtNGE0IDQgMCAxIDEgNCA0aC00IiAvPgogIDxwYXRoIGQ9Ik0yMSAzYTE2IDE2IDAgMCAwIC0xMi44IDEwLjIiIC8+CiAgPHBhdGggZD0iTTIxIDNhMTYgMTYgMCAwIDEgLTEwLjIgMTIuOCIgLz4KICA8cGF0aCBkPSJNMTAuNiA5YTkgOSAwIDAgMSA0LjQgNC40IiAvPgo8L3N2Zz4KCgo=\",m=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpY29uIGljb24tdGFibGVyIGljb24tdGFibGVyLWZyYW1lIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj4KICA8cGF0aCBzdHJva2U9Im5vbmUiIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4KICA8cGF0aCBkPSJNNCA3bDE2IDAiIC8+CiAgPHBhdGggZD0iTTQgMTdsMTYgMCIgLz4KICA8cGF0aCBkPSJNNyA0bDAgMTYiIC8+CiAgPHBhdGggZD0iTTE3IDRsMCAxNiIgLz4KPC9zdmc+CgoK\",g=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpY29uIGljb24tdGFibGVyIGljb24tdGFibGVyLWhhbmQtY2xpY2siIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZT0iY3VycmVudENvbG9yIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPgogIDxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgogIDxwYXRoIGQ9Ik04IDEzdi04LjVhMS41IDEuNSAwIDAgMSAzIDB2Ny41IiAvPgogIDxwYXRoIGQ9Ik0xMSAxMS41di0yYTEuNSAxLjUgMCAwIDEgMyAwdjIuNSIgLz4KICA8cGF0aCBkPSJNMTQgMTAuNWExLjUgMS41IDAgMCAxIDMgMHYxLjUiIC8+CiAgPHBhdGggZD0iTTE3IDExLjVhMS41IDEuNSAwIDAgMSAzIDB2NC41YTYgNiAwIDAgMSAtNiA2aC0yaC4yMDhhNiA2IDAgMCAxIC01LjAxMiAtMi43bC0uMTk2IC0uM2MtLjMxMiAtLjQ3OSAtMS40MDcgLTIuMzg4IC0zLjI4NiAtNS43MjhhMS41IDEuNSAwIDAgMSAuNTM2IC0yLjAyMmExLjg2NyAxLjg2NyAwIDAgMSAyLjI4IC4yOGwxLjQ3IDEuNDciIC8+CiAgPHBhdGggZD0iTTUgM2wtMSAtMSIgLz4KICA8cGF0aCBkPSJNNCA3aC0xIiAvPgogIDxwYXRoIGQ9Ik0xNCAzbDEgLTEiIC8+CiAgPHBhdGggZD0iTTE1IDZoMSIgLz4KPC9zdmc+CgoK\",u=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJpY29uIGljb24tdGFibGVyIGljb24tdGFibGVyLWxpbmsiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZT0iY3VycmVudENvbG9yIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPgogIDxwYXRoIHN0cm9rZT0ibm9uZSIgZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgogIDxwYXRoIGQ9Ik05IDE1bDYgLTYiIC8+CiAgPHBhdGggZD0iTTExIDZsLjQ2MyAtLjUzNmE1IDUgMCAwIDEgNy4wNzEgNy4wNzJsLS41MzQgLjQ2NCIgLz4KICA8cGF0aCBkPSJNMTMgMThsLS4zOTcgLjUzNGE1LjA2OCA1LjA2OCAwIDAgMSAtNy4xMjcgMGE0Ljk3MiA0Ljk3MiAwIDAgMSAwIC03LjA3MWwuNTI0IC0uNDYzIiAvPgo8L3N2Zz4KCgo=\";function p(e,n){const t=e.getDoc().somethingSelected();return[{type:\"menu\",icon:r.replace(/currentColor/g,n.foregroundColor),label:\"Style\",items:[{type:\"button\",iconOnly:!0,label:\"Bold\",command:\"boldText\",disabled:!t},{type:\"button\",label:\"Italic\",command:\"italicText\",disabled:!t},{type:\"button\",label:\"Monospaced Text\",command:\"monospacedText\",disabled:!t},{type:\"button\",label:\"Small Caps\",command:\"smallCapsText\",disabled:!t},{type:\"separator\"},{type:\"button\",label:\"Blockquote\",command:\"insertBlockquote\",disabled:t},{type:\"button\",label:\"Bulleted List\",command:\"insertBulletedList\",disabled:t},{type:\"button\",label:\"Fork List\",command:\"insertForkList\",disabled:t},{type:\"button\",label:\"Numbered List\",command:\"insertNumberedList\",disabled:t},{type:\"button\",label:\"Section Break\",command:\"insertSectionBreak\",disabled:t}]},{type:\"menu\",icon:u.replace(/currentColor/g,n.foregroundColor),label:\"Link\",disabled:t,items:[{type:\"button\",label:\"Passage Link\",command:\"insertPassageLink\"},{type:\"button\",label:\"Restart Link\",command:\"insertRestartLink\"},{type:\"button\",label:\"Reveal Passage Link\",command:\"insertRevealPassageLink\"},{type:\"button\",label:\"Reveal Text Link\",command:\"insertRevealTextLink\"}]},{type:\"menu\",icon:b.replace(/currentColor/g,n.foregroundColor),label:\"Modifiers\",disabled:t,items:[{type:\"button\",label:\"If\",command:\"insertIf\"},{type:\"button\",label:\"If and Else\",command:\"insertIfElse\"},{type:\"button\",label:\"Unless\",command:\"insertUnless\"},{type:\"button\",label:\"Continue\",command:\"insertContinue\"},{type:\"separator\"},{type:\"button\",label:\"After Delay\",command:\"insertAfter\"},{type:\"button\",label:\"Append Text\",command:\"insertAppend\"},{type:\"button\",label:\"Note\",command:\"insertNote\"},{type:\"separator\"},{type:\"button\",label:\"JavaScript\",command:\"insertJs\"},{type:\"button\",label:\"CSS\",command:\"insertCss\"}]},{type:\"menu\",icon:m.replace(/currentColor/g,n.foregroundColor),label:\"Embed\",disabled:t,items:[{type:\"button\",label:\"Embed Passage\",command:\"insertEmbedPassage\"},{type:\"button\",label:\"Embed Image from Flickr\",command:\"insertImageFlickr\"},{type:\"button\",label:\"Embed Image from URL\",command:\"insertImageUrl\"},{type:\"button\",label:\"Embed Image from Unsplash\",command:\"insertImageUnsplash\"},{type:\"button\",label:\"Embed Ambient Sound\",command:\"insertEmbedAmbientSound\"},{type:\"button\",label:\"Embed Sound Effect\",command:\"insertEmbedSoundEffect\"},{type:\"button\",label:\"Embed YouTube Video\",command:\"insertEmbedYouTubeVideo\"}]},{type:\"menu\",icon:g.replace(/currentColor/g,n.foregroundColor),label:\"Input\",disabled:t,items:[{type:\"button\",label:\"Cycling Link\",command:\"insertCyclingLink\"},{type:\"button\",label:\"Dropdown Menu\",command:\"insertDropdownMenu\"},{type:\"button\",label:\"Text Input\",command:\"insertTextInput\"}]}]}function C(e){const n=[/\\{embed\\s+passage\\s*:\\s*['\"](.+?)['\"]\\s*}/g,/\\{link\\s+to\\s*:\\s*['\"](.+?)['\"]\\s*\\}/g,/\\{reveal\\s+link.+passage\\s*:\\s*['\"](.+?)['\"].*\\}/g],t=[];for(const i of n){let a;for(;a=i.exec(e);)t.push(a[1])}return t}l.editorExtensions={twine:{\"^2.4.0-beta2\":{codeMirror:{commands:c,mode:s,toolbar:p},references:{parsePassageText:C}}}}})(this);\n","image":"logo.svg","name":"Chapbook","proofing":false,"version":"2.0.0"})